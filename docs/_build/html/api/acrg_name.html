<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>acrg_name package &#8212; acrg  documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="acrg-name-package">
<h1>acrg_name package<a class="headerlink" href="#acrg-name-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-acrg_name.basis_functions">
<span id="acrg-name-basis-functions-module"></span><h2>acrg_name.basis_functions module<a class="headerlink" href="#module-acrg_name.basis_functions" title="Permalink to this headline">¶</a></h2>
<p>Created on Sat Jul 25 15:46:31 2015</p>
<p>&#64;author: ag12733</p>
<p>Creat basis functions for domain</p>
<dl class="function">
<dt id="acrg_name.basis_functions.basis_bc_all_gradients">
<code class="descclassname">acrg_name.basis_functions.</code><code class="descname">basis_bc_all_gradients</code><span class="sig-paren">(</span><em>domain</em>, <em>time</em>, <em>species</em>, <em>units='ppb'</em>, <em>basis_case='horiz-strat-grad'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/basis_functions.html#basis_bc_all_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.basis_functions.basis_bc_all_gradients" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Creates five terms for bc basis regions</dt>
<dd><ol class="first arabic simple">
<li>offset to shift entire field up and down</li>
<li>factor to scale the entire field</li>
<li>scaling of N-S gradient</li>
<li>scaling of E-W gradient</li>
</ol>
<p class="last">(5) scaling of stratospheric gradient
Technically file is species specific as it calculates the stratosphere
based on the vmm but one can assume/hope that the stratosphere doesn&#8217;t
change by species</p>
</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<em>str</em>) &#8211; String of domain area</li>
<li><strong>time</strong> (<em>str</em>) &#8211; Timestamp for basis functions</li>
<li><strong>species</strong> (<em>str</em>) &#8211; Species of interest</li>
<li><strong>units</strong> (<em>str</em><em>, </em><em>optional</em>) &#8211; Units of boundary conditions. Default ppb</li>
<li><strong>basis_case</strong> (<em>str</em><em>, </em><em>optional</em>) &#8211; Name of basis case.
Default &#8216;horiz-strat-grad&#8217;</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None
Writes basis boundary condition gradients to netcdf</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<p>basis_bc_all_gradients(&#8216;SOUTHASIA&#8217;, &#8216;2012-01-01&#8217;, &#8216;ch4&#8217;, units=&#8217;ppb&#8217;, basis_case=&#8217;horiz-strat-grad&#8217;)</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.basis_functions.basis_bc_blocks">
<code class="descclassname">acrg_name.basis_functions.</code><code class="descname">basis_bc_blocks</code><span class="sig-paren">(</span><em>domain</em>, <em>basis_case</em>, <em>time</em>, <em>vertical=1</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/basis_functions.html#basis_bc_blocks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.basis_functions.basis_bc_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates uniform blocks for boundary conditions in each direction (NESW).
Each direction is split into vertical slabs with number specified by input &#8216;vertical&#8217;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<em>str</em>) &#8211; String of domain area</li>
<li><strong>basis_case</strong> (<em>str</em>) &#8211; Labelling for basis case.</li>
<li><strong>time</strong> (<em>str</em>) &#8211; Timestamp for basis functions</li>
<li><strong>vertical</strong> (<em>int</em><em>, </em><em>optioanl</em>) &#8211; Number of vertical slabs to split boundary conditions into
Default = 1</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None
Writes basis boundary condition blocks to netcdf</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<p>basis_bc_blocks(domain=&#8217;SOUTHASIA&#8217;, basis_case=&#8217;NESW&#8217;, time=&#8216;2012-01-01&#8217;, vertical = 4)</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.basis_functions.basis_bc_pca">
<code class="descclassname">acrg_name.basis_functions.</code><code class="descname">basis_bc_pca</code><span class="sig-paren">(</span><em>domain</em>, <em>time</em>, <em>species</em>, <em>units='ppb'</em>, <em>basis_case='pca'</em>, <em>numregions=4</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/basis_functions.html#basis_bc_pca"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.basis_functions.basis_bc_pca" title="Permalink to this definition">¶</a></dt>
<dd><p>breaks the MOZART VMR into the first &#8216;numregions&#8217; principal components and scales each PC</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<em>str</em>) &#8211; String of domain area</li>
<li><strong>time</strong> (<em>str</em>) &#8211; Timestamp for basis functions</li>
<li><strong>species</strong> (<em>str</em>) &#8211; Species of interest</li>
<li><strong>units</strong> (<em>str</em><em>, </em><em>optional</em>) &#8211; Units of species. Default is &#8216;ppb&#8217;</li>
<li><strong>basis_case</strong> (<em>str</em>) &#8211; Labelling for basis case. Default is &#8216;pca&#8217;</li>
<li><strong>numregions</strong> (<em>int</em>) &#8211; Number of PCs</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None
Writes PCA basis boundary condition to netcdf</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<p>basis_bc_pca(&#8220;SOUTHASIA&#8221;, &#8220;2012-01-15&#8221;, &#8216;ch4&#8217;, units=&#8217;ppb&#8217;, basis_case=&#8217;pca&#8217;, numregions = 4)</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.basis_functions.basis_bc_uniform">
<code class="descclassname">acrg_name.basis_functions.</code><code class="descname">basis_bc_uniform</code><span class="sig-paren">(</span><em>domain</em>, <em>basis_case</em>, <em>time</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/basis_functions.html#basis_bc_uniform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.basis_functions.basis_bc_uniform" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates creates one uniform scaling for boundary conditions for all directions</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<em>str</em>) &#8211; String of domain area</li>
<li><strong>basis_case</strong> (<em>str</em>) &#8211; Labelling for basis case.</li>
<li><strong>time</strong> (<em>str</em>) &#8211; Timestamp for basis functions</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None
Writes uniform basis boundary condition to netcdf</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<p>basis_bc_uniform(domain=&#8217;SOUTHASIA&#8217;, basis_case=&#8217;uniform&#8217;, time=&#8216;2012-01-01&#8217;)</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.basis_functions.basis_blocks">
<code class="descclassname">acrg_name.basis_functions.</code><code class="descname">basis_blocks</code><span class="sig-paren">(</span><em>domain</em>, <em>time</em>, <em>blocksize</em>, <em>basis_case=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/basis_functions.html#basis_blocks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.basis_functions.basis_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates basis functions in square blocks (e.g., 5x5 grid cells per region)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<em>str</em>) &#8211; String of domain area</li>
<li><strong>time</strong> (<em>str</em>) &#8211; Timestamp for basis functions</li>
<li><strong>blocksize</strong> (<em>int</em>) &#8211; Number of grid cells to split into (i.e. blocksize x blocksize)</li>
<li><strong>basis_case</strong> (<em>str</em><em>, </em><em>optional</em>) &#8211; Labelling for basis case.
Default is e.g. &#8216;5x5&#8217; for blocksize of 5</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None
Writes blocked basis functions to netcdf</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<p>basis_blocks(domain = &#8220;SOUTHASIA&#8221;, time = &#8220;2012-01-01&#8221;, blocksize=25)</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.basis_functions.basis_transd">
<code class="descclassname">acrg_name.basis_functions.</code><code class="descname">basis_transd</code><span class="sig-paren">(</span><em>domain</em>, <em>time</em>, <em>basis_case='transd'</em>, <em>sub_lon_min=None</em>, <em>sub_lon_max=None</em>, <em>sub_lat_min=None</em>, <em>sub_lat_max=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/basis_functions.html#basis_transd"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.basis_functions.basis_transd" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates basis regions for the &#8220;transdimensional inversion&#8221;.
Creates variable central block based on sub_lat and sub_lon domain
and four fixed regions surrounding the central box.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<em>str</em>) &#8211; String of domain area</li>
<li><strong>time</strong> (<em>str</em>) &#8211; Timestamp for basis functions</li>
<li><strong>basis_case</strong> (<em>str</em><em>, </em><em>optional</em>) &#8211; Labelling for basis case.
Default is &#8220;transd&#8221; for transdimensional</li>
<li><strong>sub_lon_min</strong> (<em>float</em>) &#8211; Minimum longitude of sub domain</li>
<li><strong>sub_lon_max</strong> (<em>float</em>) &#8211; Maximum longitude of sub domain</li>
<li><strong>sub_lat_min</strong> (<em>float</em>) &#8211; Minimum latitude of sub domain</li>
<li><strong>sub_lat_max</strong> (<em>float</em>) &#8211; Maximum latitude of sub domain</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None
Writes basis regions to netcdf</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<dl class="docutils">
<dt>basis_transd(domain = &#8220;SOUTHASIA&#8221;, time = &#8220;2012-01-01&#8221;, basis_case = &#8220;transd&#8221;,</dt>
<dd>sub_lon_min = 65, sub_lon_max = 100, sub_lat_min = 5, sub_lat_max = 40)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="acrg_name.basis_functions.cut_array2d">
<code class="descclassname">acrg_name.basis_functions.</code><code class="descname">cut_array2d</code><span class="sig-paren">(</span><em>array</em>, <em>shape</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/basis_functions.html#cut_array2d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.basis_functions.cut_array2d" title="Permalink to this definition">¶</a></dt>
<dd><p>Needs a description for what it does</p>
</dd></dl>

</div>
<div class="section" id="module-acrg_name.flux">
<span id="acrg-name-flux-module"></span><h2>acrg_name.flux module<a class="headerlink" href="#module-acrg_name.flux" title="Permalink to this headline">¶</a></h2>
<p>Created on Thu Nov 26 18:13:48 2015</p>
<p>&#64;author: chxmr</p>
<dl class="class">
<dt id="acrg_name.flux.EDGARread">
<em class="property">class </em><code class="descclassname">acrg_name.flux.</code><code class="descname">EDGARread</code><span class="sig-paren">(</span><em>filename_of_EDGAR_emissions</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/flux.html#EDGARread"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.flux.EDGARread" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="acrg_name.flux.write">
<code class="descclassname">acrg_name.flux.</code><code class="descname">write</code><span class="sig-paren">(</span><em>lat</em>, <em>lon</em>, <em>time</em>, <em>flux</em>, <em>species</em>, <em>domain</em>, <em>source</em>, <em>title</em>, <em>prior_info_dict</em>, <em>regridder_used='acrg_grid.regrid.regrid_3D'</em>, <em>copy_from_year=None</em>, <em>climatology=False</em>, <em>flux_comments=None</em>, <em>output_directory='/data/shared/NAME/emissions/'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/flux.html#write"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.flux.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a flux file for emissions</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lat</strong> (<em>arr</em>) &#8211; 1D array of latitudes</li>
<li><strong>lon</strong> (<em>arr</em>) &#8211; 1D array of longitudes</li>
<li><strong>time</strong> (<em>numpy.datetime64</em>) &#8211; Either an array (format from xarray) or a datetime index (format from pandas).
See &#8216;Creating datetime64 data&#8217; : <a class="reference external" href="http://xarray.pydata.org/en/stable/time-series.html">http://xarray.pydata.org/en/stable/time-series.html</a></li>
<li><strong>flux</strong> (<em>array</em>) &#8211; 2D array of size [lat x lon]. Should be in mol/m2/s.</li>
<li><strong>species</strong> (<em>str</em>) &#8211; Species of interest.</li>
<li><strong>domain</strong> (<em>str</em>) &#8211; String of domain area</li>
<li><strong>source</strong> (<em>str</em>) &#8211; Sources in file. E.g. &#8216;ff&#8217; (fossil fuel), &#8216;agriculture&#8217;.
source = None if the file contains all sources of a species.
If multiple sources: -source- is a chain of sources: &#8216;waste-and-agriculture&#8217; (with hyphens between words).</li>
<li><strong>title</strong> (<em>str</em>) &#8211; Gives more information about what is in the file, e.g. Fossil Fuel CO2.</li>
<li><strong>prior_info_dict</strong> (<em>dict</em>) &#8211; {&#8216;NAME_OF_PRIOR&#8217; : [&#8216;VERSION&#8217;,&#8217;RAW RESOLUTION&#8217;, &#8216;REFERENCE&#8217;]}</li>
<li><strong>regridder_used</strong> (<em>str</em><em>, </em><em>optional</em>) &#8211; regrid function used. Default is &#8216;acrg_grid.regrid.regrid_3D&#8217;.</li>
<li><strong>copy_from_year</strong> (<em>str</em><em>, </em><em>optional</em>) &#8211; If the data is the same as another year but with a different timestamp give the original year here as a string
Default is None</li>
<li><strong>climatology</strong> (<em>bool</em><em>, </em><em>optional</em>) &#8211; If the data is a climatology set this to True and give detail using flux_comments.
Default is False</li>
<li><strong>flux_comments</strong> (<em>str</em><em>, </em><em>optional</em>) &#8211; Extra comments. Default is None.</li>
<li><strong>output_directory</strong> (<em>str</em><em>, </em><em>optional</em>) &#8211; Output directory. Default is &#8216;/data/shared/NAME/emissions/&#8217;.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None
Writes flux file to netcdf</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<dl class="docutils">
<dt>flux.write(lat, lon, time, flux, &#8216;ch4&#8217;, &#8216;EUROPE&#8217;, &#8216;2012&#8217;,</dt>
<dd>comments = comments, title=&#8221;2012_CH4_emissions_EUROPE&#8221;)</dd>
</dl>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Add some error checking (e.g. check that domain is correct)</p>
</div>
</dd></dl>

</div>
<div class="section" id="module-acrg_name.name">
<span id="acrg-name-name-module"></span><h2>acrg_name.name module<a class="headerlink" href="#module-acrg_name.name" title="Permalink to this headline">¶</a></h2>
<p>Created on Mon Nov 10 10:45:51 2014</p>
<dl class="function">
<dt id="acrg_name.name.animate">
<code class="descclassname">acrg_name.name.</code><code class="descname">animate</code><span class="sig-paren">(</span><em>fp_data, output_directory, lon_range=None, lat_range=None, zoom=False, log_range=[5.0, 9.0], overwrite=True, file_label='fp', framerate=10, delete_png=False, video_os='mac', ffmpeg_only=False, plot_function='plot', time_regular='1H', frame_range=None, dpi=150, interpolate=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#animate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.animate" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div>The time_unique function creates one set of time entries within fp_data (dictionary of datasets)</div></blockquote>
<p>merging across multiple sites if necessary.
Time can also be reindexed to be evenly spaced between the minimum and maximum values if time_regular
if specified.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fp_data</strong> &#8211; Output from footprints_data_merge(). Dictionary of datasets.</li>
<li><strong>time_regular</strong> &#8211; Frequency between minumum and maximum to set the time values within fp_data.
Set at False to not apply this step (Default = False).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Time values extracted for this first site within fp_data</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">xarray.Dataset</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.basis">
<code class="descclassname">acrg_name.name.</code><code class="descname">basis</code><span class="sig-paren">(</span><em>domain</em>, <em>basis_case</em>, <em>basis_directory='/data/shared/NAME/basis_functions/'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#basis"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.basis" title="Permalink to this definition">¶</a></dt>
<dd><p>The basis function reads in the all matching files for the basis case and domain as an xarray Dataset.</p>
<dl class="docutils">
<dt>Expect filenames of the form:</dt>
<dd>[basis_directory]/domain/&#8221;basis_case&#8221;_&#8221;domain&#8221;<a href="#id1"><span class="problematic" id="id2">*</span></a>.nc
e.g. [/data/shared/NAME/basis_functions]/EUROPE/sub_transd_EUROPE_2014.nc</dd>
</dl>
<p>TODO: More info on options for basis functions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<em>str</em>) &#8211; Domain name. The basis files should be sub-categorised by the domain.</li>
<li><strong>basis_case</strong> (<em>str</em>) &#8211; Basis case to read in. Examples of basis cases are &#8220;voroni&#8221;,&#8221;sub-transd&#8221;,
&#8220;sub-country_mask&#8221;,&#8221;INTEM&#8221;.</li>
<li><strong>bc_directory</strong> (<em>str</em>) &#8211; bc_directory can be specified if files are not in
the default directory. Must point to a directory
which contains subfolders organized by domain. (optional)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">combined dataset of matching basis functions</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">xarray.Dataset</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.basis_boundary_conditions">
<code class="descclassname">acrg_name.name.</code><code class="descname">basis_boundary_conditions</code><span class="sig-paren">(</span><em>domain</em>, <em>basis_case</em>, <em>bc_basis_directory='/data/shared/NAME/bc_basis_functions/'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#basis_boundary_conditions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.basis_boundary_conditions" title="Permalink to this definition">¶</a></dt>
<dd><p>The basis_boundary_conditions function reads in all matching files for the boundary conditions
basis case and domain as an xarray Dataset.</p>
<dl class="docutils">
<dt>Expect filesnames of the form:</dt>
<dd>[bc_basis_directory]/domain/&#8221;basis_case&#8221;_&#8221;domain&#8221;<a href="#id3"><span class="problematic" id="id4">*</span></a>.nc
e.g. [/data/shared/NAME/bc_basis_directory]/EUROPE/NESW_EUROPE_2013.nc</dd>
</dl>
<p>TODO: More info on options for basis functions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<em>str</em>) &#8211; Domain name. The basis files should be sub-categorised by the domain.</li>
<li><strong>basis_case</strong> (<em>str</em>) &#8211; Basis case to read in. Examples of basis cases are &#8220;NESW&#8221;,&#8221;stratgrad&#8221;.</li>
<li><strong>bc_basis_directory</strong> (<em>str</em>) &#8211; bc_basis_directory can be specified if files are not in
the default directory. Must point to a directory
which contains subfolders organized by domain. (optional)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">combined dataset of matching basis functions</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">xarray.Datset</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.bc_sensitivity">
<code class="descclassname">acrg_name.name.</code><code class="descname">bc_sensitivity</code><span class="sig-paren">(</span><em>fp_and_data</em>, <em>domain</em>, <em>basis_case</em>, <em>bc_basis_directory='/data/shared/NAME/bc_basis_functions/'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#bc_sensitivity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.bc_sensitivity" title="Permalink to this definition">¶</a></dt>
<dd><p>The bc_sensitivity adds H_bc to the sensitivity matrix, to each site xray dataframe in fp_and_data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fp_and_data</strong> (<em>dict</em>) &#8211; Output from footprints_data_merge() function. Dictionary of datasets.</li>
<li><strong>domain</strong> (<em>str</em>) &#8211; Domain name. The footprint files should be sub-categorised by the domain.</li>
<li><strong>basis_case</strong> (<em>str</em>) &#8211; Basis case to read in. Examples of basis cases are &#8220;NESW&#8221;,&#8221;stratgrad&#8221;.</li>
<li><strong>bc_basis_directory</strong> (<em>str</em>) &#8211; bc_basis_directory can be specified if files are not in the default
directory. Must point to a directory which contains subfolders organized
by domain. (optional)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Same format as fp_and_data with sensitivity matrix added.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict (xarray.Dataset)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.boundary_conditions">
<code class="descclassname">acrg_name.name.</code><code class="descname">boundary_conditions</code><span class="sig-paren">(</span><em>domain</em>, <em>species</em>, <em>bc_directory='/data/shared/NAME/bc/'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#boundary_conditions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.boundary_conditions" title="Permalink to this definition">¶</a></dt>
<dd><p>The boundary_conditions function reads in the files with the global model vmrs at the domain edges
to give the boundary conditions as an xarray Dataset.</p>
<dl class="docutils">
<dt>Expect filenames of the form:</dt>
<dd>[bc_directory]/domain/species.lower()_*.nc
e.g. [/data/shared/NAME/bc]/EUROPE/ch4_EUROPE_201301.nc</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<em>str</em>) &#8211; Domain name. The boundary condition files should be sub-categorised by the
domain.</li>
<li><strong>species</strong> (<em>str</em>) &#8211; Species name. All species names are defined acrg_species_info.json.</li>
<li><strong>bc_directory</strong> (<em>str</em>) &#8211; bc_directory can be specified if files are not in
the default directory. Must point to a directory
which contains subfolders organized by domain. (optional)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">combined dataset of matching boundary conditions files</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">xarray.Dataset</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.combine_datasets">
<code class="descclassname">acrg_name.name.</code><code class="descname">combine_datasets</code><span class="sig-paren">(</span><em>dsa</em>, <em>dsb</em>, <em>method='ffill'</em>, <em>tolerance=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#combine_datasets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.combine_datasets" title="Permalink to this definition">¶</a></dt>
<dd><p>The combine_datasets function merges two datasets and re-indexes to the FIRST dataset.
If &#8220;fp&#8221; variable is found within the combined dataset, the &#8220;time&#8221; values where the &#8220;lat&#8221;,&#8221;lon&#8221;
dimensions didn&#8217;t match are removed.</p>
<p class="rubric">Example</p>
<p>ds = combine_datasets(dsa, dsb)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>dsa</strong> (<em>xarray.Dataset</em>) &#8211; First dataset to merge</li>
<li><strong>dsb</strong> (<em>xarray.Dataset</em>) &#8211; Second dataset to merge</li>
<li><strong>method</strong> (<em>str</em>) &#8211; One of {None, ‘nearest’, ‘pad’/’ffill’, ‘backfill’/’bfill’}
See xarray.DataArray.reindex_like for list of options and meaning.</li>
<li><strong>tolerance</strong> &#8211; Maximum allowed tolerance between matches.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">combined dataset indexed to dsa</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">xarray.Dataset</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.filenames">
<code class="descclassname">acrg_name.name.</code><code class="descname">filenames</code><span class="sig-paren">(</span><em>site</em>, <em>domain</em>, <em>start</em>, <em>end</em>, <em>height</em>, <em>fp_directory</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#filenames"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.filenames" title="Permalink to this definition">¶</a></dt>
<dd><p>The filenames function outputs a list of available footprint file names,
for given site, domain, directory and date range.</p>
<dl class="docutils">
<dt>Expect filenames of the form:</dt>
<dd>[fp_directory]/domain/site*-height*domain*yearmonth*.nc
e.g. [/data/shared/NAME/fp]/EUROPE/MHD-10magl_EUROPE_201401.nc</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>site</strong> (<em>str</em>) &#8211; Site name. Full list of site names should be
defined within acrg_site_info.json</li>
<li><strong>domain</strong> (<em>str</em>) &#8211; Domain name. The footprint files should be
sub-categorised by the NAME domain name.</li>
<li><strong>start</strong> (<em>str</em>) &#8211; Start date in format &#8220;YYYY-MM-DD&#8221; for range of files
to find.</li>
<li><strong>end</strong> (<em>str</em>) &#8211; End date in same format as start for range of files
to find.</li>
<li><strong>height</strong> (<em>str</em>) &#8211; Height related to input data.</li>
<li><strong>fp_directory</strong> (<em>str</em>) &#8211; fp_directory can be specified if files are not in
the default directory must point to a directory
which contains subfolders organized by domain.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">matched filenames</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list (str)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.filtering">
<code class="descclassname">acrg_name.name.</code><code class="descname">filtering</code><span class="sig-paren">(</span><em>datasets_in</em>, <em>filters</em>, <em>keep_missing=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#filtering"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.filtering" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies filtering (in time dimension) to entire dataset.
Filters supplied in a list and then applied in order. For example if you wanted a daily, daytime
average, you could do this:</p>
<blockquote>
<div><dl class="docutils">
<dt>datasets_dictionary = filtering(datasets_dictionary,</dt>
<dd>[&#8220;daytime&#8221;, &#8220;daily_median&#8221;])</dd>
</dl>
</div></blockquote>
<p>The order of the filters reflects the order they are applied, so for
instance when applying the &#8220;daily_median&#8221; filter if you only wanted
to look at daytime values the filters list should be
[&#8220;daytime&#8221;,&#8221;daily_median&#8221;]</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>datasets_in</strong> &#8211; Output from footprints_data_merge(). Dictionary of datasets.</li>
<li><strong>filters</strong> (<em>list</em>) &#8211; <p>Which filters to apply to the datasets.
All options are:</p>
<blockquote>
<div>&#8220;daytime&#8221;           : selects data between 1000 and 1500 UTC
&#8220;nighttime&#8221;         : Only b/w 23:00 - 03:00 inclusive
&#8220;noon&#8221;              : Only 12:00 fp and obs used
&#8220;daily_median&#8221;      : calculates the daily median
&#8220;pblh_gt_threshold&#8221; :
&#8220;local_influence&#8221;   : Only keep times when localness is low
&#8220;six_hr_mean&#8221;       :
&#8220;local_lapse&#8221;       :</div></blockquote>
</li>
<li><strong>keep_missing</strong> (<em>bool</em>) &#8211; Whether to reindex to retain missing data.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Datasets with filters applied.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">Same format as datasets_in</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.flux">
<code class="descclassname">acrg_name.name.</code><code class="descname">flux</code><span class="sig-paren">(</span><em>domain</em>, <em>species</em>, <em>flux_directory='/data/shared/NAME/emissions/'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#flux"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.flux" title="Permalink to this definition">¶</a></dt>
<dd><p>The flux function reads in all flux files for the domain and species as an xarray Dataset.
Note that at present ALL flux data is read in per species per domain or by emissions name.
To be consistent with the footprints, fluxes should be in mol/m2/s.</p>
<dl class="docutils">
<dt>Expect filenames of the form:</dt>
<dd>[flux_directory]/domain/species.lower()_*.nc
e.g. [/data/shared/NAME/emissions]/EUROPE/ch4_EUROPE_2013.nc</dd>
</dl>
<p>TODO: This may get slow for very large flux datasets, and we may want to subset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> (<em>str</em>) &#8211; Domain name. The flux files should be sub-categorised by the domain.</li>
<li><strong>species</strong> (<em>str</em>) &#8211; Species name. All species names are defined acrg_species_info.json.</li>
<li><strong>flux_directory</strong> (<em>str</em>) &#8211; flux_directory can be specified if files are not in
the default directory. Must point to a directory
which contains subfolders organized by domain. (optional)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">combined dataset of all matching flux files</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">xarray.Dataset</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.footprints">
<code class="descclassname">acrg_name.name.</code><code class="descname">footprints</code><span class="sig-paren">(</span><em>sitecode_or_filename</em>, <em>fp_directory={'integrated': '/data/shared/NAME/fp/'</em>, <em>'HiTRes': '/data/shared/NAME/fp_high_time_res/'}</em>, <em>flux_directory='/data/shared/NAME/emissions/'</em>, <em>bc_directory='/data/shared/NAME/bc/'</em>, <em>start=None</em>, <em>end=None</em>, <em>domain=None</em>, <em>height=None</em>, <em>species=None</em>, <em>emissions_name=None</em>, <em>HiTRes=False</em>, <em>interp_vmr_freq=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#footprints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.footprints" title="Permalink to this definition">¶</a></dt>
<dd><p>The footprints function loads a NAME footprint netCDF files into an xarray Dataset.
Flux and boundary conditions are also loaded if species or emissions_name is specified.</p>
<dl class="docutils">
<dt>Either specify:</dt>
<dd><ol class="first last loweralpha simple">
<li><dl class="first docutils">
<dt>A file name:</dt>
<dd>fp = footprints(filename)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>A site code, domain, and date range:</dt>
<dd><dl class="first last docutils">
<dt>fp = footprints(&#8220;MHD&#8221;,</dt>
<dd>start = &#8220;2014-01-01&#8221;, end = &#8220;2014-01-01&#8221;,
domain = &#8220;EUROPE&#8221;)</dd>
</dl>
</dd>
</dl>
</li>
</ol>
</dd>
</dl>
<p>See filenames() function for expected format of files.
Note: fp_directory, flux_directory and bc_directory can point to specified directories
but if not specified, default directories will be used (set at the top of file).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sitecode_or_filename</strong> &#8211; Site (e.g. &#8216;MHD&#8217;) or a netCDF filename (<a href="#id5"><span class="problematic" id="id6">*</span></a>.nc) (str)</li>
<li><strong>fp_directory</strong> (<em>str</em>) &#8211; fp_directory can be specified if files are not in
the default directory. Must point to a directory
which contains subfolders organized by domain. (optional)</li>
<li><strong>flux_directory</strong> (<em>str</em>) &#8211; Same sytax as fp_directory (optional)</li>
<li><strong>bc_directory</strong> (<em>str</em>) &#8211; Same sytax as bc_directory (optional)</li>
<li><strong>start</strong> (<em>str</em>) &#8211; Start date in format &#8220;YYYY-MM-DD&#8221; for range of files to find.</li>
<li><strong>end</strong> (<em>str</em>) &#8211; End date in same format as start for range of files to find.</li>
<li><strong>domain</strong> (<em>str</em>) &#8211; Domain name. The footprint files should be sub-categorised by the domain.</li>
<li><strong>height</strong> (<em>str</em>) &#8211; Height related to NAME. If the HEIGHT keyword is not specified, the default
height from the acrg_site_info.json file is assumed.</li>
<li><strong>species</strong> (<em>str</em>) &#8211; Species name. All species names are defined acrg_species_info.json.</li>
<li><strong>emissions_name</strong> (<em>str</em>) &#8211; Allows emissions files such as co2nee_EUROPE_2012.nc to be read in.
In this case EMISSIONS_NAME would be &#8216;co2nee&#8217;</li>
<li><strong>HiTRes</strong> (<em>bool</em>) &#8211; Whether to include high time resolution footprints.</li>
<li><strong>interp_vmr_freq</strong> &#8211; Frequency to interpolate vmr time. (float/int)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">combined footprint files</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">xarray.Dataset</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.footprints_data_merge">
<code class="descclassname">acrg_name.name.</code><code class="descname">footprints_data_merge</code><span class="sig-paren">(</span><em>data</em>, <em>domain</em>, <em>load_flux=True</em>, <em>calc_timeseries=True</em>, <em>calc_bc=True</em>, <em>HiTRes=False</em>, <em>average=None</em>, <em>site_modifier={}</em>, <em>height=None</em>, <em>emissions_name=None</em>, <em>interp_vmr_freq=None</em>, <em>fp_directory={'integrated': '/data/shared/NAME/fp/'</em>, <em>'HiTRes': '/data/shared/NAME/fp_high_time_res/'}</em>, <em>flux_directory='/data/shared/NAME/emissions/'</em>, <em>bc_directory='/data/shared/NAME/bc/'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#footprints_data_merge"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.footprints_data_merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Output a dictionary of xray footprint datasets, that correspond to a given
dictionary of Pandas dataframes, containing mole fraction time series.</p>
<p>TODO: Add details of load_flux, calc_timeseries, calc_bc, HiTRes options into description and affect
on outputs</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<em>dict</em>) &#8211; Input dictionary of dataframes with the sites as the keys.
Should match output from acrg_agage.get_obs() function. For example:
data = {&#8220;MHD&#8221;: MHD_dataframe, &#8220;TAC&#8221;: TAC_dataframe}</li>
<li><strong>domain</strong> (<em>str</em>) &#8211; Domain name. The footprint files should be sub-categorised by the domain.</li>
<li><strong>load_flux</strong> (<em>bool</em>) &#8211; </li>
<li><strong>calc_timeseries</strong> (<em>bool</em>) &#8211; </li>
<li><strong>calc_bc</strong> (<em>bool</em>) &#8211; </li>
<li><strong>HiTRes</strong> (<em>bool</em>) &#8211; </li>
<li><strong>average</strong> (<em>list</em>) &#8211; Averaging period for each dataset (for each site). Number of values for
average must match number of sites within data dictionary.
Each value should be a string of the form e.g. &#8220;2H&#8221;, &#8220;30min&#8221; (should match
pandas offset aliases format).</li>
<li><strong>site_modifier</strong> &#8211; An optional site modifier dictionary is used that maps the site name in the
obs file to the site name in the footprint file, if they are different. This
is useful for example if the same site FPs are run with a different met and
they are named slightly differently from the obs file. E.g.
site_modifier = {&#8220;DJI&#8221;:&#8221;DJI-SAM&#8221;} - station called DJI, FPs called DJI-SAM</li>
<li><strong>height</strong> (<em>str</em>) &#8211; Height related to input data. Can be found from acrg_sites_info.json</li>
<li><strong>emissions_name</strong> &#8211; Allows emissions files such as co2nee_EUROPE_2012.nc to be read in.
In this case EMISSIONS_NAME would be &#8216;co2nee&#8217;</li>
<li><strong>interp_vmr_freq</strong> &#8211; Frequency to interpolate vmr time. (float/int)</li>
<li><strong>fp_directory</strong> &#8211; <p>fp_directory must be a dictionary of the form
fp_directory = {&#8220;integrated&#8221;:PATH_TO_INTEGRATED_FP,</p>
<blockquote>
<div>&#8220;HiTRes&#8221;:PATH_TO_HIGHTRES_FP}</div></blockquote>
<p>if the high time resolution footprints are used (HiTRes = True)
otherwise can be a single string if only integrated FPs are used and
non-default.</p>
</li>
<li><strong>flux_directory</strong> (<em>str</em>) &#8211; flux_directory can be specified if files are not in the default directory.
Must point to a directory which contains subfolders organized by domain.
(optional)</li>
<li><strong>bc_directory</strong> (<em>str</em>) &#8211; Same sytax as flux_directory (optional)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><dl class="docutils">
<dt>MHD_xray_dataset, &#8220;TAC&#8221;: TAC_xray_dataset}:</dt>
<dd><p class="first last">combined dataset for each site</p>
</dd>
</dl>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">Dictionary of the form {&#8220;MHD&#8221;</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.fp_sensitivity">
<code class="descclassname">acrg_name.name.</code><code class="descname">fp_sensitivity</code><span class="sig-paren">(</span><em>fp_and_data</em>, <em>domain</em>, <em>basis_case</em>, <em>basis_directory='/data/shared/NAME/basis_functions/'</em>, <em>HiTRes_flux_name=None</em>, <em>Resid_flux_name=None</em>, <em>flux_directory='/data/shared/NAME/emissions/'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#fp_sensitivity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.fp_sensitivity" title="Permalink to this definition">¶</a></dt>
<dd><p>The fp_sensitivity function adds a sensitivity matrix, H, to each site xray dataframe in fp_and_data.</p>
<p>Basis function data in an array: lat, lon, no. regions. In each &#8216;region&#8217;
element of array there is a lt lon grid with 1 in region and 0 outside region.</p>
<p>Region numbering must start from 1</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fp_and_data</strong> (<em>dict</em>) &#8211; Output from footprints_data_merge() function. Dictionary of datasets.</li>
<li><strong>domain</strong> (<em>str</em>) &#8211; Domain name. The footprint files should be sub-categorised by the domain.</li>
<li><strong>basis_case</strong> (<em>str</em>) &#8211; Basis case to read in. Examples of basis cases are &#8220;NESW&#8221;,&#8221;stratgrad&#8221;.</li>
<li><strong>basis_directory</strong> (<em>str</em>) &#8211; basis_directory can be specified if files are not in the default
directory. Must point to a directory which contains subfolders organized
by domain. (optional)</li>
<li><strong>HiTRes_flux_name</strong> &#8211; </li>
<li><strong>Resid_flux_name</strong> &#8211; </li>
<li><strong>flux_directory</strong> (<em>str</em>) &#8211; Same format as basis_directory.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Same format as fp_and_data with sensitivity matrix added.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict (xarray.Dataset)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="acrg_name.name.get_country">
<em class="property">class </em><code class="descclassname">acrg_name.name.</code><code class="descname">get_country</code><span class="sig-paren">(</span><em>domain</em>, <em>ocean=False</em>, <em>ukmo=False</em>, <em>uk_split=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#get_country"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.get_country" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="acrg_name.name.interp_time">
<code class="descclassname">acrg_name.name.</code><code class="descname">interp_time</code><span class="sig-paren">(</span><em>bc_ds</em>, <em>vmr_var_names</em>, <em>new_times</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#interp_time"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.interp_time" title="Permalink to this definition">¶</a></dt>
<dd><p>The interp_time function interpolates the times of the VMR variable
&#8216;vmr_var_name&#8217; in the xarray.Dataset &#8216;bc_ds&#8217; to the times specified in
&#8216;interp_times&#8217;. The variable must have dimensions (height, lat_or_lon, time)
in that order.
Note: This function was created to convert MOZART monthly averages into
same frequency as NAME footprints.</p>
<p>TODO: Add details for vmr_var_names and new_times</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>bc_ds</strong> (<em>xarray.Dataset</em>) &#8211; Output from boundary_conditions() function</li>
<li><strong>vmr_var_names</strong> (<em>iterable</em>) &#8211; <p>???</p>
</li>
<li><strong>new_times</strong> &#8211; <p>???</p>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">new dataset with the VMRs recalculated at interpolated times.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">xarray.Dataset</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.merge_sensitivity">
<code class="descclassname">acrg_name.name.</code><code class="descname">merge_sensitivity</code><span class="sig-paren">(</span><em>fp_data_H</em>, <em>out_filename=None</em>, <em>remove_nan=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#merge_sensitivity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.merge_sensitivity" title="Permalink to this definition">¶</a></dt>
<dd><p>The merge_sensitivity function outputs y, y_site, y_time in a single array for all sites
(as opposed to a dictionary) and H and H_bc if present in dataset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fp_data_H</strong> (<em>dict</em>) &#8211; Output from footprints_data_merge() function. Dictionary of datasets.</li>
<li><strong>out_filename</strong> (<em>str</em>) &#8211; If specified the output will be writen to this filename. Otherwise values are
returned.</li>
<li><strong>remove_nan</strong> (<em>bool</em>) &#8211; Whether to remove NaN values in y. Default = True.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>each variable as an array (y, y_error, y_site, y_time [...])</p>
<p>H, H_bc are also returned if present otherwise None is returned in their place.
e.g.</p>
<blockquote>
<div><p>(y, y_error, y_site, y_time, H, H_bc)
(y, y_error, y_site, y_time, None, H_bc)</p>
</div></blockquote>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.plot">
<code class="descclassname">acrg_name.name.</code><code class="descname">plot</code><span class="sig-paren">(</span><em>fp_data, date, out_filename=None, lon_range=None, lat_range=None, log_range=[5.0, 9.0], map_data=None, zoom=False, colormap=&lt;matplotlib.colors.LinearSegmentedColormap object&gt;, tolerance=None, interpolate=False, dpi=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot footprint using pcolormesh.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>fp_data</strong> &#8211; Dictionary of xray datasets containing footprints
and other variables</li>
<li><strong>date</strong> &#8211; Almost any time format should work (datetime object, string, etc).
Footprints from all sites in dictionary that have time indices at that time
will be plotted.</li>
<li><strong>lon_range</strong> &#8211; list of min and max longitudes [min, max]</li>
<li><strong>lat_range</strong> &#8211; list of min and max latitudes [min, max]</li>
<li><strong>log_range</strong> &#8211; list of min and max LOG10(footprints) for
color scale</li>
<li><strong>map_data</strong> &#8211; contains plot_map_setup class (useful if animating,
so that entire map does not need to be re-calculated each time)</li>
<li><strong>zoom</strong> &#8211; shortcut to zoom in to subset of domain (needs work)</li>
<li><strong>map_resolution</strong> &#8211; resolution of map</li>
<li><strong>map_background</strong> &#8211; choice of &#8220;countryborders&#8221;, &#8220;shadedrelief&#8221;</li>
<li><strong>colormap</strong> &#8211; color map to use for contours</li>
<li><strong>tolerance</strong> &#8211; Xray doc &#8220;Maximum distance between original and new
labels for inexact matches.&#8221;</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Returns</dt>
<dd><p class="first">None</p>
<dl class="last docutils">
<dt>If out_filename == None:</dt>
<dd>produces as interactive plot</dd>
<dt>Else:</dt>
<dd>saves plot to file</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.plot3d">
<code class="descclassname">acrg_name.name.</code><code class="descname">plot3d</code><span class="sig-paren">(</span><em>fp_data, date, out_filename=None, tolerance=None, log_range=[5.0, 9.0], particle_clevs=[0.0, 0.009, 0.001], particle_direction='nw'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#plot3d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.plot3d" title="Permalink to this definition">¶</a></dt>
<dd><p>date as string &#8220;d/m/y H:M&#8221; or datetime object
datetime.datetime(yyyy,mm,dd,hh,mm)</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.read_netcdfs">
<code class="descclassname">acrg_name.name.</code><code class="descname">read_netcdfs</code><span class="sig-paren">(</span><em>files</em>, <em>dim='time'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#read_netcdfs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.read_netcdfs" title="Permalink to this definition">¶</a></dt>
<dd><p>The read_netcdfs function uses xarray to open sequential netCDF files and
and concatenates them along the specified dimension.
Note: this function makes sure that file is closed after open_dataset call.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>files</strong> (<em>list</em>) &#8211; List of netCDF filenames.</li>
<li><strong>dim</strong> (<em>str</em>) &#8211; Dimension of netCDF to use for concatenating the files.
Default= &#8220;time&#8221;.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">all files open as one concatenated xarray.Dataset object</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">xarray.Dataset</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.timeseries">
<code class="descclassname">acrg_name.name.</code><code class="descname">timeseries</code><span class="sig-paren">(</span><em>ds</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#timeseries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.timeseries" title="Permalink to this definition">¶</a></dt>
<dd><p>The timeseries function compute flux * footprint time series.</p>
<p class="rubric">Example</p>
<p>ts = timeseries(dataset)</p>
<p>TODO: There are almost certainly much more efficient ways of doing this.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ds</strong> (<em>xarray.Dataset</em>) &#8211; Dataset with both the flux and footprint fields present</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">xarray.Dataset</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.timeseries_HiTRes">
<code class="descclassname">acrg_name.name.</code><code class="descname">timeseries_HiTRes</code><span class="sig-paren">(</span><em>fp_HiTRes_ds</em>, <em>domain</em>, <em>HiTRes_flux_name</em>, <em>Resid_flux_name</em>, <em>output_TS=True</em>, <em>output_fpXflux=True</em>, <em>flux_directory='/data/shared/NAME/emissions/'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#timeseries_HiTRes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.timeseries_HiTRes" title="Permalink to this definition">¶</a></dt>
<dd><p>The timeseries_HiTRes function computes flux * HiTRes footprints.</p>
<p>HiTRes footprints record the footprint at each 2 hour period back in time for the first 24 hours.
Need a high time resolution (HiTRes) flux to multiply the first 24 hours back of footprints.
Need a residual (Resid) flux to multiply the residual integrated footprint for the remainder of the 20
day period.
Can output the timeseries (output_TS = True) and/or the sensitivity map (output_fpXflux = True)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fp_HiTRes_ds</strong> (<em>xarray.Dataset</em>) &#8211; Dataset of High Time resolution footprint. HiTRes footprints
record the footprint at each 2 hour period back in time for the
first 24 hours.</li>
<li><strong>domain</strong> (<em>str</em>) &#8211; Domain name. The footprint files should be sub-categorised by the
domain.</li>
<li><strong>HiTRes_flux_name</strong> &#8211; </li>
<li><strong>Resid_flux_name</strong> &#8211; </li>
<li><strong>output_TS</strong> &#8211; </li>
<li><strong>output_fpXflux</strong> &#8211; </li>
<li><strong>flux_directory</strong> (<em>str</em>) &#8211; flux_directory can be specified if files are not in the default
directory. Must point to a directory which contains subfolders
organized by domain. (optional)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>xarray.Dataset / tuple(xarray.Dataset,xarray.Dataset)</p>
<dl class="docutils">
<dt>If output_TS is True:</dt>
<dd><p class="first last">Outputs the timeseries</p>
</dd>
<dt>If output_fpXflux is True:</dt>
<dd><p class="first last">Outputs the sensitivity map</p>
</dd>
</dl>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.name.timeseries_boundary_conditions">
<code class="descclassname">acrg_name.name.</code><code class="descname">timeseries_boundary_conditions</code><span class="sig-paren">(</span><em>ds</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/name.html#timeseries_boundary_conditions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.name.timeseries_boundary_conditions" title="Permalink to this definition">¶</a></dt>
<dd><p>The timeseries_boundary_conditions function compute particle location * global model edges time series.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ds</strong> (<em>xarray.Dataset</em>) &#8211; Dataset with both the particle locations and vmr at domain edge fields
present.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">xarray.Dataset</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-acrg_name.process">
<span id="acrg-name-process-module"></span><h2>acrg_name.process module<a class="headerlink" href="#module-acrg_name.process" title="Permalink to this headline">¶</a></h2>
<p>Created on Thu May  7 10:34:25 2015</p>
<p>To use this script, you will need to have a directory, labeled as:
DOMAIN_SITE_HEIGHT (e.g. EUROPE_MHD_10magl), with the following structure:</p>
<p>Met/
Fields_files/
Particle_files/
Processed_Fields_files/
Observations/ (satellite/column footprints only)</p>
<p>Each file in Fields_files/ and Particle_files/ must end with a date string
(format YYYYMMDD) which must be present in both folders
e.g. fields_file_YYYYMMDD.txt.gz.</p>
<p>To process all files in a folder run:</p>
<p>process_all(&#8220;DOMAIN&#8221;, &#8220;SITE&#8221;)</p>
<p>Output netCDF files are created one file per month, per domain, per site
in the Processed_Fields_files directory.</p>
<p>&#64;author: chxmr</p>
<dl class="function">
<dt id="acrg_name.process.copy_processed">
<code class="descclassname">acrg_name.process.</code><code class="descname">copy_processed</code><span class="sig-paren">(</span><em>domain</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#copy_processed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.copy_processed" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Routine to copy files from:</dt>
<dd>/dagage2/agage/metoffice/NAME_output/DOMAIN_SITE_HEIGHT/Processed_Fields_files
to:
air.chm:/data/shared/NAME/fp_netcdf/DOMAIN/</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.define_grid">
<code class="descclassname">acrg_name.process.</code><code class="descname">define_grid</code><span class="sig-paren">(</span><em>header</em>, <em>column_headings</em>, <em>satellite=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#define_grid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.define_grid" title="Permalink to this definition">¶</a></dt>
<dd><p>Largely taken from Met Office Python code.</p>
<p>Define output grid using file header information.</p>
<p>For satellite instructions, see satellite_vertical_profile.</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.extract_file_lines">
<code class="descclassname">acrg_name.process.</code><code class="descname">extract_file_lines</code><span class="sig-paren">(</span><em>fname</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#extract_file_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.extract_file_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine whether file is zipped or not, and then extract text into
file_lines variable.</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.footprint_array">
<code class="descclassname">acrg_name.process.</code><code class="descname">footprint_array</code><span class="sig-paren">(</span><em>fields_file</em>, <em>particle_file=None</em>, <em>met=None</em>, <em>satellite=False</em>, <em>time_step=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#footprint_array"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.footprint_array" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert text output from a given file files into arrays in an
xray dataset.</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.footprint_concatenate">
<code class="descclassname">acrg_name.process.</code><code class="descname">footprint_concatenate</code><span class="sig-paren">(</span><em>fields_prefix</em>, <em>particle_prefix=None</em>, <em>datestr='*'</em>, <em>met=None</em>, <em>satellite=False</em>, <em>time_step=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#footprint_concatenate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.footprint_concatenate" title="Permalink to this definition">¶</a></dt>
<dd><p>For a given file search string (fields_prefix), find all fields and particle
files, read them and concatenate the output arrays.</p>
<p>Returns an xray dataset.</p>
<p>Example:</p>
<p>fp_dataset = footprint_concatenate(&#8220;/dagage2/agage/metoffice/NAME_output/MY_FOOTPRINTS_FOLDER/Fields_Files/filename_prefix&#8221;)</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.load_NAME">
<code class="descclassname">acrg_name.process.</code><code class="descname">load_NAME</code><span class="sig-paren">(</span><em>file_lines</em>, <em>namever</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#load_NAME"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.load_NAME" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads the Met Office&#8217;s NAME III grid output files returning
headers, column definitions and data arrays as 3 separate lists.</p>
<p>For a technical specification see
<a class="reference external" href="http://www-hc.metoffice.com/~apdg/nameiii/ModelDocumentation/md2_4_v2%28Output%29.pdf">http://www-hc.metoffice.com/~apdg/nameiii/ModelDocumentation/md2_4_v2%28Output%29.pdf</a></p>
<p>Inputs to this routine are a list of file text lines (extracted using
the extract_file_lines routine), and the NAME version.</p>
<p>Where I&#8217;ve modified the original Met Office routine to accept file_lines,
rather than the file itself, I&#8217;ve put the initials MLR</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.met_empty">
<code class="descclassname">acrg_name.process.</code><code class="descname">met_empty</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#met_empty"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.met_empty" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an empty Met dictionary. Not recommended.</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.particle_locations">
<code class="descclassname">acrg_name.process.</code><code class="descname">particle_locations</code><span class="sig-paren">(</span><em>particle_file</em>, <em>time</em>, <em>lats</em>, <em>lons</em>, <em>levs</em>, <em>heights</em>, <em>id_is_lev=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#particle_locations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.particle_locations" title="Permalink to this definition">¶</a></dt>
<dd><p>Read and process a particle location file.</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.process">
<code class="descclassname">acrg_name.process.</code><code class="descname">process</code><span class="sig-paren">(</span><em>domain</em>, <em>site</em>, <em>height</em>, <em>year</em>, <em>month</em>, <em>base_dir='/dagage2/agage/metoffice/NAME_output/'</em>, <em>fields_folder='Fields_files'</em>, <em>particles_folder='Particle_files'</em>, <em>met_folder='Met'</em>, <em>force_met_empty=False</em>, <em>processed_folder='Processed_Fields_files'</em>, <em>satellite=False</em>, <em>max_level=None</em>, <em>force_update=False</em>, <em>perturbed_folder=None</em>, <em>vertical_profile=False</em>, <em>transport_model='NAME'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#process"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a single month of footprints for a given domain, site, height,
year, month. If you want to process all files for a given domain + site
use process_all.</p>
<p>This routine finds all fields files and particle location files which match
the timestamp in the file name. The date strings are stored in the datestr
variable, and these strings must match exactly for the fields and the particle
locations.</p>
<p>At the moment, the entire Met folder is read each time.</p>
<p>Options:
force_update: By default, any existing netCDF files are NOT overwritten.</p>
<blockquote>
<div>To explicitly over-write a file, set force_update = True</div></blockquote>
<dl class="docutils">
<dt>satellite: Read a &#8220;column&#8221; of footprints. There are very particular rules</dt>
<dd>about how the met, footprints and particle location files are stored
and named. See extra instructions in satellite_vertical_profile.</dd>
<dt>perturbed_folder: Process a subfolder which has all of the required folders</dt>
<dd><p class="first">(Fields_files, etc). This is for perturbed parameter ensembles for
a particular site. E.g. for EUROPE_BSD_110magl/Perturbed/PARAMETERNAME_VALUE
you&#8217;d set:</p>
<blockquote class="last">
<div>perturbed_folder = &#8220;Perturbed/PARAMETERNAME_VALUE&#8221;</div></blockquote>
</dd>
<dt>max_level: specified only for satellite data and indicates the max level to</dt>
<dd>process the foorprints. levels above are replaced by the prior profile</dd>
<dt>vertical_profile: If set to true will look for vertical potential temperature met file</dt>
<dd>and incorporate into footprint file.
NB. This is a separate file from the normal met file, and is not mandatory.</dd>
<dt>transport_model: Defaults to &#8220;NAME&#8221;. If &#8220;STILT&#8221;, reads footprints in the</dt>
<dd>ncdf format created by the STILT model. Other values are invalid. Not
set up to read satellite column footprints from STILT format.</dd>
</dl>
<p>Outputs:
This routine outputs a copy of the xray dataset that is written to file.</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.process_all">
<code class="descclassname">acrg_name.process.</code><code class="descname">process_all</code><span class="sig-paren">(</span><em>domain</em>, <em>site</em>, <em>heights=None</em>, <em>years_in=None</em>, <em>months_in=None</em>, <em>base_dir='/dagage2/agage/metoffice/NAME_output/'</em>, <em>force_update=False</em>, <em>satellite=False</em>, <em>perturbed_folder=None</em>, <em>max_level=None</em>, <em>force_met_empty=False</em>, <em>vertical_profile=False</em>, <em>transport_model='NAME'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#process_all"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.process_all" title="Permalink to this definition">¶</a></dt>
<dd><p>For a given domain and site, process all available fields files (including
multiple heights).
If you want to specify a subset of years/months to process, use the years_in
or months_in kewords.</p>
<p>Keywords:
heights: If you only want to process a subset of heights, OR IF THE HEIGHT</p>
<blockquote>
<div>INFORMATION IS NOT CONTAINED IN acrg_site_info.json, specify a list of
height strings here.</div></blockquote>
<p>years_in: If you only want to process a subset of years, specify here.
months_in: Ditto for months
force_update: By default, this routine will not overwrite existing netcdf</p>
<blockquote>
<div>files. Set force_update = True to reprocess an existing file</div></blockquote>
<dl class="docutils">
<dt>satellite: If a column of footprints needs to be processed, set to true.</dt>
<dd>See extra instructions in satellite_vertical_profile.</dd>
<dt>perturbed_folder: Process a subfolder which has all of the required folders</dt>
<dd><p class="first">(Fields_files, etc). This is for perturbed parameter ensembles for
a particular site. E.g. for EUROPE_BSD_110magl/Perturbed/PARAMETERNAME_VALUE
you&#8217;d set:</p>
<blockquote class="last">
<div>perturbed_folder = &#8220;Perturbed/PARAMETERNAME_VALUE&#8221;</div></blockquote>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.process_basic">
<code class="descclassname">acrg_name.process.</code><code class="descname">process_basic</code><span class="sig-paren">(</span><em>fields_folder</em>, <em>outfile</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#process_basic"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.process_basic" title="Permalink to this definition">¶</a></dt>
<dd><p>Basic processing with no meteorology or particle files
NOT recommended, but helpful for a quick check</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.process_vertical_profile">
<code class="descclassname">acrg_name.process.</code><code class="descname">process_vertical_profile</code><span class="sig-paren">(</span><em>vp_fname</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#process_vertical_profile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.process_vertical_profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to process the site specific vertical pressure and temperature gradients.
Relies on the process_met function
In order to fit into this function the header information needs to be edited
in the output files NAME generates.
Required structure given in vp_met_dict</p>
<dl class="docutils">
<dt>Outputs: xarray dataset containing:</dt>
<dd>theta_slope - the potential temperature gradient at each time point
slope_error - the error in this calculated gradient</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.read_file">
<code class="descclassname">acrg_name.process.</code><code class="descname">read_file</code><span class="sig-paren">(</span><em>fname</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#read_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.read_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a given fields file and break into header, column_headings and data_arrays</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.read_met">
<code class="descclassname">acrg_name.process.</code><code class="descname">read_met</code><span class="sig-paren">(</span><em>fnames</em>, <em>met_def_dict=None</em>, <em>vertical_profile=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#read_met"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.read_met" title="Permalink to this definition">¶</a></dt>
<dd><p>For a given list of filenames, extract site meteorology and concatenate
into a Pandas dataframe.</p>
<p>A dictionary of output column names and met file header search strings
is given in the met_default dictionary at the top of this file.</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.release_point">
<code class="descclassname">acrg_name.process.</code><code class="descname">release_point</code><span class="sig-paren">(</span><em>nc</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#release_point"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.release_point" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the time and location of release from STILT output based on the
identifier string. nc should be a netCDF4.Dataset in STILT format.</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.satellite_vertical_profile">
<code class="descclassname">acrg_name.process.</code><code class="descname">satellite_vertical_profile</code><span class="sig-paren">(</span><em>fp</em>, <em>satellite_obs_file</em>, <em>max_level</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#satellite_vertical_profile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.satellite_vertical_profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Do weighted average by satellite averaging kernel and
pressure weight. One time point only. Expects xray.dataset
with one time point and N vertical levels.</p>
<dl class="docutils">
<dt>fp = footprint for ONE time point. N levels in lev dimension</dt>
<dd>with footprints and particle locations defined at each level</dd>
<dt>satellite_obs_file = NetCDF-format satellite observation file,</dt>
<dd>one per time step</dd>
<dt>max_level = the maximum vertical level of the retrieval that is included.</dt>
<dd>(maximum for GOSAT to include all levels from model is 20).
The remaining levels are set equal to the a priori value.</dd>
</dl>
<p>Requirements for running processing satellite footprints</p>
<dl class="docutils">
<dt>General file naming: Files/folders need to have a date string of the form</dt>
<dd>YYYYMMDD-II at the end of the file/folder name,
where II is a two-digit index corresponding to the
sequence of footprints throughout the day. This modifies the usual
naming convention for surface sites, which are only YYYYMMDD.</dd>
<dt>Met: The Met/ folder MUST contain a set of subfolders which are labeled</dt>
<dd>with the YYYYMMDD-II time stamp. Each of these subfolders should then
contain nLev Met output files, where nLev are the number of vertical
levels in the NAME output. This is required so that we know
what pressure/temperature each NAME footprint for each vertical level
corresponds to. The files can be named in any way, but the file names
must be in ascending order when sorted (i.e. blah_01.txt.gz, blah_02.txt.gz).</dd>
<dt>Fields files:</dt>
<dd>There must be ONE fields file per time stamp, labeled at the end
of the file string with YYYYMMDD-II (e.g. blah_YYYYMMDD-II.txt.gz).
The fields file must contain exactly nLev columns, one for each vertical
level, in ascending order, left to right.</dd>
<dt>Particle location files:</dt>
<dd>There must be ONE fields file per time stamp, labeled at the end
of the file string with YYYYMMDD-II (e.g. blah_YYYYMMDD-II.txt.gz).
The ID column in this file must contain nLev values in ascending order
specifying the vertical level that each particle belongs to.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.status_log">
<code class="descclassname">acrg_name.process.</code><code class="descname">status_log</code><span class="sig-paren">(</span><em>message</em>, <em>directory=None</em>, <em>error_or_warning='status'</em>, <em>print_to_screen=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#status_log"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.status_log" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a log of an error or a warning to file. Will append to a file</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.stilt_part">
<code class="descclassname">acrg_name.process.</code><code class="descname">stilt_part</code><span class="sig-paren">(</span><em>nc</em>, <em>Id</em>, <em>domain_N</em>, <em>domain_S</em>, <em>domain_E</em>, <em>domain_W</em>, <em>exitfile</em>, <em>append</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#stilt_part"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.stilt_part" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract particle data from STILT output and assign it the given Id.
nc should be a netCDF4.Dataset in STILT format; Id should be an integer.</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.stiltfoot_array">
<code class="descclassname">acrg_name.process.</code><code class="descname">stiltfoot_array</code><span class="sig-paren">(</span><em>prefix</em>, <em>exitfile=None</em>, <em>met=None</em>, <em>satellite=False</em>, <em>time_step=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#stiltfoot_array"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.stiltfoot_array" title="Permalink to this definition">¶</a></dt>
<dd><p>Read data from STILT netcdf output files into arrays in an xray dataset.
The corresponding function for NAME output is footprint_array.
This function reads multiple files at once because STILT output is stored
as a separate file for each release time. To read a month of output, give
a prefix like stilt2016x07x.
:param prefix: file pattern prefix (including path) for output files to read
:param exitfile: file in which to temporarily store particle data
:param met: not used to interpret STILT footprints, which are already given</p>
<blockquote>
<div>in ppm/(mol/m^2/s), but can be included if available.</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>satellite</strong> &#8211; not implemented; will produce error if True</li>
<li><strong>time_step</strong> &#8211; ignored; not needed to interpret STILT footprints.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">an xray dataset as from footprint_concatenate</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">fp</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process.test_processed_met">
<code class="descclassname">acrg_name.process.</code><code class="descname">test_processed_met</code><span class="sig-paren">(</span><em>domain</em>, <em>site</em>, <em>height</em>, <em>base_dir='/dagage2/agage/metoffice/NAME_output/'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#test_processed_met"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.test_processed_met" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="acrg_name.process.write_netcdf">
<code class="descclassname">acrg_name.process.</code><code class="descname">write_netcdf</code><span class="sig-paren">(</span><em>fp</em>, <em>lons</em>, <em>lats</em>, <em>levs</em>, <em>time</em>, <em>outfile</em>, <em>temperature=None</em>, <em>pressure=None</em>, <em>wind_speed=None</em>, <em>wind_direction=None</em>, <em>PBLH=None</em>, <em>varname='fp'</em>, <em>release_lon=None</em>, <em>release_lat=None</em>, <em>particle_locations=None</em>, <em>particle_heights=None</em>, <em>global_attributes={}</em>, <em>lapse_rate=None</em>, <em>lapse_error=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process.html#write_netcdf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process.write_netcdf" title="Permalink to this definition">¶</a></dt>
<dd><p>This routine writes a netCDF file with footprints, particle locations
meteorology, and release locations.</p>
<p>NOTE that netCDF4 is required, as we make use of compression.</p>
</dd></dl>

</div>
<div class="section" id="module-acrg_name.process_HiTRes">
<span id="acrg-name-process-hitres-module"></span><h2>acrg_name.process_HiTRes module<a class="headerlink" href="#module-acrg_name.process_HiTRes" title="Permalink to this headline">¶</a></h2>
<p>Created on Mon Feb 19 11:09:53 2018</p>
<p>&#64;author: ew14860</p>
<dl class="function">
<dt id="acrg_name.process_HiTRes.process_HiTRes">
<code class="descclassname">acrg_name.process_HiTRes.</code><code class="descname">process_HiTRes</code><span class="sig-paren">(</span><em>domain</em>, <em>site</em>, <em>height</em>, <em>year</em>, <em>month</em>, <em>user_max_hour_back</em>, <em>base_dir='/dagage2/agage/metoffice/NAME_output/'</em>, <em>HiTRes_fields_folder='24HrBk_Fields_files'</em>, <em>met_folder='Met'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process_HiTRes.html#process_HiTRes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process_HiTRes.process_HiTRes" title="Permalink to this definition">¶</a></dt>
<dd><p>domain: string - &#8216;EUROPE&#8217;
site: string - &#8216;MHD&#8217;
height: string in magl - &#8216;10&#8217;
year: string - &#8216;2014&#8217;
month: string - &#8216;06&#8217;
user_max_hour_back: int - 24
base_dir: string, directory where [domain]_[site]_[height]magl folder is containing HiTRes footprints
HiTRes_fields_folder: string, name of HiTRes fields folder - &#8216;24HrBk_Fields_files&#8217;
met_folder: string, name of met folder - &#8216;Met&#8217;</p>
</dd></dl>

<dl class="function">
<dt id="acrg_name.process_HiTRes.process_HiTRes_all">
<code class="descclassname">acrg_name.process_HiTRes.</code><code class="descname">process_HiTRes_all</code><span class="sig-paren">(</span><em>domain</em>, <em>site_height_dict</em>, <em>start_date</em>, <em>end_date</em>, <em>user_max_hour_back</em>, <em>base_dir='/dagage2/agage/metoffice/NAME_output/'</em>, <em>HiTRes_fields_folder='24HrBk_Fields_files'</em>, <em>met_folder='Met'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process_HiTRes.html#process_HiTRes_all"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process_HiTRes.process_HiTRes_all" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="acrg_name.process_HiTRes.update_release_time">
<code class="descclassname">acrg_name.process_HiTRes.</code><code class="descname">update_release_time</code><span class="sig-paren">(</span><em>fname</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_name/process_HiTRes.html#update_release_time"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_name.process_HiTRes.update_release_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the time of release in the HiTRes output files to be start and end
of the release at that timestep rather than the start and end of the release
for the first timestep of that day.</p>
<p>fname: path to file to be updated</p>
</dd></dl>

</div>
<div class="section" id="module-acrg_name">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-acrg_name" title="Permalink to this headline">¶</a></h2>
<p>Created on Thu Nov 26 17:45:56 2015</p>
<p>&#64;author: chxmr</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">acrg_name package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-acrg_name.basis_functions">acrg_name.basis_functions module</a></li>
<li><a class="reference internal" href="#module-acrg_name.flux">acrg_name.flux module</a></li>
<li><a class="reference internal" href="#module-acrg_name.name">acrg_name.name module</a></li>
<li><a class="reference internal" href="#module-acrg_name.process">acrg_name.process module</a></li>
<li><a class="reference internal" href="#module-acrg_name.process_HiTRes">acrg_name.process_HiTRes module</a></li>
<li><a class="reference internal" href="#module-acrg_name">Module contents</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/acrg_name.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, mrghg.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/api/acrg_name.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>