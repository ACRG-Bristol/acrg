<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>acrg_tdmcmc package &#8212; acrg  documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="acrg-tdmcmc-package">
<h1>acrg_tdmcmc package<a class="headerlink" href="#acrg-tdmcmc-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="acrg-tdmcmc-post-process-template-module">
<h2>acrg_tdmcmc.post_process_template module<a class="headerlink" href="#acrg-tdmcmc-post-process-template-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-acrg_tdmcmc.run_tdmcmc">
<span id="acrg-tdmcmc-run-tdmcmc-module"></span><h2>acrg_tdmcmc.run_tdmcmc module<a class="headerlink" href="#module-acrg_tdmcmc.run_tdmcmc" title="Permalink to this headline">¶</a></h2>
<p>Created on Fri Feb  5 09:44:30 2016</p>
<p>&#64;author: ml12574</p>
<p>Template script for running uncorrelated trans-dimensional inversion</p>
<p>Uses acrg_hbtdmcmc_uncorr.f90</p>
<p>Please note: The default is not to perform parallel tempering and the rjmcmc
is performed using a single chain on a single processor. If you think parallel
tempering is required this is easily changed. Speak to me (ML).</p>
<p>After the function definition at the top of the script the next section
is the inputs. This contains all the basic stuff you will probably want and
have to change or tune.</p>
<p>Further changes to stepsizes and parameter uncertainties can be applied
further down the script once the dimensions have been set. You will almost
certainly need to tune your stepsizes appropriately for different parameter
types (i.e. baseline and emissions). You will also want to adjust the
uncertainties differently (emissions uncertainty &gt; baseline uncertainty).</p>
<p>&#64;author: ml12574</p>
<dl class="function">
<dt id="acrg_tdmcmc.run_tdmcmc.add_local_ratio">
<code class="descclassname">acrg_tdmcmc.run_tdmcmc.</code><code class="descname">add_local_ratio</code><span class="sig-paren">(</span><em>fp_data_H</em>, <em>return_release=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/run_tdmcmc.html#add_local_ratio"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.run_tdmcmc.add_local_ratio" title="Permalink to this definition">¶</a></dt>
<dd><p>The add_local_ratio function adds an additional &#8220;local_ratio&#8221; parameter to all xarray.Dataset objects
within fp_data_H dictionary.</p>
<p>Note: footprints_data_merge() function creates a dictionary of xarray.Dataset objects with one for each
site. fp_sensivity() takes the output from footprints_data_merge() and adds sensivity matrix to each
dataset in the dictionary.
Each dataset should contain the following data variables:</p>
<blockquote>
<div>&#8220;mf&#8221;
&#8220;fp&#8221;
&#8220;release_lon&#8221;
&#8220;release_lat&#8221;
&#8220;sub_fp&#8221; (additional &#8220;sub_lon&#8221;, &#8220;sub_lat&#8221; coords associated with this data variable)</div></blockquote>
<p>WARNING: Changes input object in place</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fp_data_H</strong> (<em>dict</em>) &#8211; xarray.Dataset. Expects output from name.fp_sensitivity() function.</li>
<li><strong>return_release</strong> (<em>bool</em>) &#8211; Whether or not to also return the release_lats and release_lons
arrays.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><blockquote>
<div><dl class="docutils">
<dt>tuple(dict (xarray Datasets and identifiers), np.array, np.array) :</dt>
<dd><p class="first last">fp_data_H with &#8220;local_ratio&#8221; data variable added, release_lons, release_lats</p>
</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>else:</dt>
<dd><p class="first last">dict (xarray Datasets and identifiers) : fp_data_H with &#8220;local_ratio&#8221; data variable added</p>
</dd>
</dl>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">if return_release</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.run_tdmcmc.average_period">
<code class="descclassname">acrg_tdmcmc.run_tdmcmc.</code><code class="descname">average_period</code><span class="sig-paren">(</span><em>ds</em>, <em>av_period</em>, <em>dim='time'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/run_tdmcmc.html#average_period"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.run_tdmcmc.average_period" title="Permalink to this definition">¶</a></dt>
<dd><p>The average_period function resamples the input dataset along the specified dimension to the average
period.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ds</strong> (<em>xarray.Dataset</em>) &#8211; Dataset contaiing time series dimension.</li>
<li><strong>av_period</strong> (<em>str</em>) &#8211; Averaging period to apply to timeseries dimension of dataset.
E.g. &#8220;2H&#8221; (2 hours), &#8220;30min&#8221; or &#8220;30T&#8221; (30 minutes)
See <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#offset-aliases">http://pandas.pydata.org/pandas-docs/stable/timeseries.html#offset-aliases</a>
for list of all frequencies available.</li>
<li><strong>dim</strong> &#8211; Timeseries dimension within Dataset. Default = &#8220;time&#8221;.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">original dataset averaged along the specified dimension</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">xarray.Dataset</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.run_tdmcmc.average_period_fp">
<code class="descclassname">acrg_tdmcmc.run_tdmcmc.</code><code class="descname">average_period_fp</code><span class="sig-paren">(</span><em>fp_data_H</em>, <em>av_period_site</em>, <em>dim='time'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/run_tdmcmc.html#average_period_fp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.run_tdmcmc.average_period_fp" title="Permalink to this definition">¶</a></dt>
<dd><p>The average_period_fp function resamples all datasets within a footprints_data_merge() dictionary over
the averaging periods.
Note: av_period_site should contain the same number of entries as there are sites in fp_data_H</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fp_data_H</strong> (<em>dict</em>) &#8211; output from footprints_data_merge() function.</li>
<li><strong>av_period</strong> (<em>list</em>) &#8211; Averaging periods (str objects), one for each site.
E.g. &#8220;2H&#8221; (2 hours), &#8220;30min&#8221; or &#8220;30T&#8221; (30 minutes)</li>
<li><strong>dim</strong> &#8211; Timeseries dimension within Dataset. Default = &#8220;time&#8221;.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">fp_data_H with datasets averaged along the specified dimension</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="acrg_tdmcmc.run_tdmcmc.closest_grid">
<code class="descclassname">acrg_tdmcmc.run_tdmcmc.</code><code class="descname">closest_grid</code><a class="reference internal" href="../_modules/acrg_tdmcmc/run_tdmcmc.html#closest_grid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.run_tdmcmc.closest_grid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.run_tdmcmc.get_nsigma_y">
<code class="descclassname">acrg_tdmcmc.run_tdmcmc.</code><code class="descname">get_nsigma_y</code><span class="sig-paren">(</span><em>fp_data_H</em>, <em>start_date</em>, <em>end_date</em>, <em>sites</em>, <em>nmeasure</em>, <em>sigma_values</em>, <em>bl_period=10</em>, <em>bl_split=False</em>, <em>levels=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/run_tdmcmc.html#get_nsigma_y"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.run_tdmcmc.get_nsigma_y" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the indices of the measurement vector which are described by different
uncertainty hyperparameters (sigma_model)
By default all sigma_models are split by site and time.
Alternative option for subdivision by site and boundary layer depth. Can be set
when calling the function.
E.g.
To split by 10 day periods:</p>
<blockquote>
<div>R_indices, ydim1,ydim2, sigma_model0 = get_nsigma_y(fp_data_H,start_date, end_date,
sites, nmeasure, bl_split = False, bl_period=10,
sigma_values=50.)</div></blockquote>
<dl class="docutils">
<dt>To split by BL depth:</dt>
<dd>R_indices, ydim1,ydim2, sigma_model0 = get_nsigma_y(fp_data_H,start_date, end_date,
sites, nmeasure, bl_split = True, bl_period=None,
sigma_values=50.)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.run_tdmcmc.run_tdmcmc">
<code class="descclassname">acrg_tdmcmc.run_tdmcmc.</code><code class="descname">run_tdmcmc</code><span class="sig-paren">(</span><em>sites</em>, <em>meas_period</em>, <em>av_period</em>, <em>species</em>, <em>start_date</em>, <em>end_date</em>, <em>domain</em>, <em>network</em>, <em>fp_basis_case</em>, <em>bc_basis_case</em>, <em>rjmcmc</em>, <em>para_temp</em>, <em>bl_period</em>, <em>kmin</em>, <em>kmax</em>, <em>k_ap</em>, <em>nIt</em>, <em>burn_in</em>, <em>nsub</em>, <em>nbeta</em>, <em>beta</em>, <em>sigma_model_pdf</em>, <em>sigma_model_ap</em>, <em>sigma_model_hparams</em>, <em>stepsize_sigma_y</em>, <em>stepsize_clon</em>, <em>stepsize_clat</em>, <em>stepsize_bd</em>, <em>stepsize_all</em>, <em>stepsize_pdf_p1_all</em>, <em>stepsize_pdf_p2_all</em>, <em>pdf_param1</em>, <em>pdf_param2</em>, <em>pdf_p1_hparam1</em>, <em>pdf_p1_hparam2</em>, <em>pdf_p2_hparam1</em>, <em>pdf_p2_hparam2</em>, <em>x_pdf</em>, <em>pdf_param1_pdf</em>, <em>pdf_param2_pdf</em>, <em>inv_type</em>, <em>output_dir</em>, <em>tau_ap=None</em>, <em>tau_hparams=None</em>, <em>stepsize_tau=None</em>, <em>tau_pdf=None</em>, <em>bl_split=False</em>, <em>bl_levels=None</em>, <em>filters=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/run_tdmcmc.html#run_tdmcmc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.run_tdmcmc.run_tdmcmc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-acrg_tdmcmc.tdmcmc_config">
<span id="acrg-tdmcmc-tdmcmc-config-module"></span><h2>acrg_tdmcmc.tdmcmc_config module<a class="headerlink" href="#module-acrg_tdmcmc.tdmcmc_config" title="Permalink to this headline">¶</a></h2>
<p>Created on Mon Mar 26 12:41:21 2018</p>
<p>This module describes the specific configuration set up for the running the tdmcmc code.
This builds on the more general functionality of configuration file functions acrg_config.config module.
Please refer to this module for further details.</p>
<div class="section" id="mcmc">
<h3>MCMC<a class="headerlink" href="#mcmc" title="Permalink to this headline">¶</a></h3>
<p>For the MCMC inputs an input parameter dictionary is pre-defined (mcmc_param_type()) and separates the parameters by classifications.
This dictionary allows us to define which inputs we expect and the associated types.
Unless specified as optional parameters an error is returned if those parameters aren&#8217;t present.</p>
<dl class="docutils">
<dt>By default this includes three classifications:</dt>
<dd><ul class="first last simple">
<li>MEASUREMENTS - defines expected parameters from [MEASUREMENTS] section</li>
<li>MCMC         - defines expected parameters from all [MCMC.***] sections collected together</li>
<li>TDMCMC       - defines expected parameters from all [TDMCMC.***] sections collected together</li>
</ul>
</dd>
</dl>
<p>See mcmc_param_type() function for full list of pre-defined parameters and types</p>
<p>Extracted parameters are returned as an OrderedDict object (from collections module).</p>
</div>
<div class="section" id="how-to-run">
<h3>How to run<a class="headerlink" href="#how-to-run" title="Permalink to this headline">¶</a></h3>
<p>The main function to use for reading in parameters from a config file are:</p>
<blockquote>
<div><ul class="simple">
<li>all_mcmc_param(config_file,...) - Extract MCMC parameters specifically based on a pre-defined param_type</li>
</ul>
<p>dictionary (see above)</p>
</div></blockquote>
<p>Note: At present the param_type dict specified by the gosat_param_dict() function is created from an in-built
nested dictionary. However, this can be modified to rely on a template configuration file instead. See
acrg_config.generate_param_dict() function for more details.</p>
<p>&#64;author: rt17603</p>
<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_config.add_defaults">
<code class="descclassname">acrg_tdmcmc.tdmcmc_config.</code><code class="descname">add_defaults</code><span class="sig-paren">(</span><em>param</em>, <em>section_group=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_config.html#add_defaults"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_config.add_defaults" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_config.all_mcmc_param">
<code class="descclassname">acrg_tdmcmc.tdmcmc_config.</code><code class="descname">all_mcmc_param</code><span class="sig-paren">(</span><em>config_file</em>, <em>optional_param=[]</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_config.html#all_mcmc_param"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_config.all_mcmc_param" title="Permalink to this definition">¶</a></dt>
<dd><p>The all_mcmc_param function extracts all parameters related to running the tdmcmc code as defined in mcmc_param_type()</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>config_file</strong> &#8211; filename for input configuration file</li>
<li><strong>optional_param</strong> &#8211; parameters which are optional. If the param cannot be found in input file, value will be set to None</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>parameter names and values</p>
<dl class="docutils">
<dt>If any parameter defined in mcmc_param_type() cannot be found (not specified as an optional param):</dt>
<dd><p class="first last">Exception raised and program exited</p>
</dd>
</dl>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">OrderedDict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_config.mcmc_param">
<code class="descclassname">acrg_tdmcmc.tdmcmc_config.</code><code class="descname">mcmc_param</code><span class="sig-paren">(</span><em>config_file</em>, <em>optional_param=[]</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_config.html#mcmc_param"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_config.mcmc_param" title="Permalink to this definition">¶</a></dt>
<dd><p>The mcmc_param function extracts all parameters for the MCMC run (see mcmc_param_type for full list)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>config_file</strong> (<em>str</em>) &#8211; filename for input configuration file</li>
<li><strong>optional_param</strong> (<em>list</em>) &#8211; parameters which are optional. If the param cannot be found value will be set to None</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>parameter names and values</p>
<dl class="docutils">
<dt>If any MCMC parameter cannot be found (not specified as an optional param):</dt>
<dd><p class="first last">Exception raised and program exited</p>
</dd>
</dl>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">OrderedDict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_config.mcmc_param_type">
<code class="descclassname">acrg_tdmcmc.tdmcmc_config.</code><code class="descname">mcmc_param_type</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_config.html#mcmc_param_type"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_config.mcmc_param_type" title="Permalink to this definition">¶</a></dt>
<dd><p>The mcmc_param_type function specifies the names of expected input parameters from the config file and the required Python object types.
This includes three section groups for the input parameter:</p>
<blockquote>
<div>&#8216;MEASUREMENTS&#8217; - details related to the measurements made
&#8216;MCMC&#8217;         - parameters for running the mcmc model
&#8216;TDMCMC&#8217;       - parameters for running the tdmcmc model (in addition to mcmc parameters needed)</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Each section group contains a OrderedDict of parameter names and associated type:
&#8216;MEASUREMENTS&#8217; (&#8216;sites&#8217;,list),(&#8216;species&#8217;,str),(&#8216;start_date&#8217;,str),(&#8216;end_date&#8217;,str),(&#8216;domain&#8217;,str),<blockquote>
<div>(&#8216;network&#8217;,str)</div></blockquote>
<dl class="docutils">
<dt>&#8216;MCMC&#8217;         (&#8216;meas_period&#8217;,list),(&#8216;av_period&#8217;,list),(&#8216;nIt&#8217;,int),(&#8216;burn_in&#8217;,int),</dt>
<dd>(&#8216;nsub&#8217;,int),(&#8216;fp_basis_case&#8217;,str),(&#8216;bc_basis_case&#8217;,str),(&#8216;x_pdf0&#8217;,int),
(&#8216;pdf_param1_pdf0&#8217;,int),(&#8216;pdf_param2_pdf0&#8217;,int),(&#8216;sigma_model_pdf&#8217;,int),
(&#8216;pdf_param10&#8217;,float),(&#8216;pdf_param20&#8217;,float),(&#8216;pdf_p1_hparam10&#8217;,float),
(&#8216;pdf_p1_hparam20&#8217;,float),(&#8216;pdf_p2_hparam10&#8217;,float),(&#8216;pdf_p2_hparam20&#8217;,float),
(&#8216;sigma_model_ap&#8217;,float),(&#8216;sigma_model_hparams&#8217;,list),(&#8216;bl_period&#8217;,int),
(&#8216;bl_split&#8217;,bool),(&#8216;levels&#8217;,int),(&#8216;stepsize&#8217;,float),(&#8216;stepsize_pdf_p1&#8217;,float),
(&#8216;stepsize_pdf_p2&#8217;,float),(&#8216;stepsize_sigma_y&#8217;,float),(&#8216;stepsize_clon&#8217;,float),
(&#8216;stepsize_clat&#8217;,float),(&#8216;stepsize_bd&#8217;,int),(&#8216;inv_type&#8217;,str),(&#8216;tau_ap&#8217;,float),
(&#8216;tau_hparams&#8217;,list),(&#8216;tau_pdf&#8217;,int),(&#8216;stepsize_tau&#8217;,float), (&#8216;filters&#8217;,list),
(&#8216;parallel_tempering&#8217;,bool),(&#8216;nbeta&#8217;,int),(&#8216;output_dir&#8217;,str),(&#8216;unique_copy&#8217;,boolean)</dd>
</dl>
<p>&#8216;TDMCMC&#8217;       (&#8216;reversible_jump&#8217;,bool),(&#8216;kmin&#8217;,int),(&#8216;kmax&#8217;,int),(&#8216;k_ap&#8217;,int)</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">OrderedDict of section groups</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_config.measurements_param">
<code class="descclassname">acrg_tdmcmc.tdmcmc_config.</code><code class="descname">measurements_param</code><span class="sig-paren">(</span><em>config_file</em>, <em>optional_param=[]</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_config.html#measurements_param"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_config.measurements_param" title="Permalink to this definition">¶</a></dt>
<dd><p>The measurements_param function extracts all parameters relevant to measurement details (see mcmc_param_type for full list)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>config_file</strong> (<em>str</em>) &#8211; filename for input configuration file</li>
<li><strong>optional_param</strong> (<em>list</em>) &#8211; parameters which are optional. If the param cannot be found value will be set to None.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>parameter names and values</p>
<dl class="docutils">
<dt>If any measurement parameter cannot be found (not specified as an optional param):</dt>
<dd><p class="first last">Exception raised and program exited</p>
</dd>
</dl>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">OrderedDict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_config.optional_parameters">
<code class="descclassname">acrg_tdmcmc.tdmcmc_config.</code><code class="descname">optional_parameters</code><span class="sig-paren">(</span><em>section_group=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_config.html#optional_parameters"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_config.optional_parameters" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_config.tdmcmc_param">
<code class="descclassname">acrg_tdmcmc.tdmcmc_config.</code><code class="descname">tdmcmc_param</code><span class="sig-paren">(</span><em>config_file</em>, <em>optional_param=[]</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_config.html#tdmcmc_param"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_config.tdmcmc_param" title="Permalink to this definition">¶</a></dt>
<dd><p>The tdmcmc_param function extracts all parameters for the MCMC run (see mcmc_param_type for full list)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>config_file</strong> (<em>str</em>) &#8211; filename for input configuration file</li>
<li><strong>optional_param</strong> (<em>list</em>) &#8211; parameters which are optional. If the param cannot be found value will be set to None</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>parameter names and values</p>
<dl class="docutils">
<dt>If any MCMC parameter cannot be found (not specified as an optional param):</dt>
<dd><p class="first last">Exception raised and program exited</p>
</dd>
</dl>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">OrderedDict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="acrg-tdmcmc-tdmcmc-inputs-module">
<h2>acrg_tdmcmc.tdmcmc_inputs module<a class="headerlink" href="#acrg-tdmcmc-tdmcmc-inputs-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-acrg_tdmcmc.tdmcmc_post_process">
<span id="acrg-tdmcmc-tdmcmc-post-process-module"></span><h2>acrg_tdmcmc.tdmcmc_post_process module<a class="headerlink" href="#module-acrg_tdmcmc.tdmcmc_post_process" title="Permalink to this headline">¶</a></h2>
<p>Created on Tue Aug  4 08:57:53 2015</p>
<p>Script to process Transdimensional MCMC output</p>
<p>Includes:
Write netcdf and append netcdf to write output to nc file</p>
<p>plot_scaling - plot posterior scaling map</p>
<p>regions_histogram - plot histogram of number of regions</p>
<dl class="docutils">
<dt>country_emissions - calculate emissions from given list of countries</dt>
<dd>Currently hard-wired for methane</dd>
</dl>
<p>&#64;author: ml12574</p>
<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.append_netcdf">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">append_netcdf</code><span class="sig-paren">(</span><em>flux_mean</em>, <em>flux_percentile</em>, <em>flux_it</em>, <em>country_mean</em>, <em>country_percentile</em>, <em>k_mean</em>, <em>k_percentile</em>, <em>lon</em>, <em>lat</em>, <em>time</em>, <em>country</em>, <em>percentile</em>, <em>nIt</em>, <em>experiment</em>, <em>outfile</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#append_netcdf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.append_netcdf" title="Permalink to this definition">¶</a></dt>
<dd><p>Function for appending flux and country output to file</p>
<p>Only use this function once file has already been created
Create file first using write_netcdf function below</p>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.country_emissions">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">country_emissions</code><span class="sig-paren">(</span><em>ds_mcmc</em>, <em>x_post_vit</em>, <em>q_ap_abs_v</em>, <em>countries</em>, <em>species</em>, <em>units=None</em>, <em>ocean=True</em>, <em>domain='EUROPE'</em>, <em>uk_split=False</em>, <em>fixed_map=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#country_emissions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.country_emissions" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates national totals for a given list of countries
Requires:
ds_mcmc - post_mcmc xray dataset
countries - list of countries (see data_path/countries files for names)</p>
<blockquote>
<div>In general names are all capitalized</div></blockquote>
<p>species - CH4, CO2 etc.</p>
<p>Optional:
units - Need to specify to get something sensible out, otherwise returns in g/yr</p>
<blockquote>
<div>Options are Pg/yr, Tg/yr,Gg/yr Mg/yr</div></blockquote>
<p>ocean - Default is true, If false only include emissions from land surface
uk_split - Break UK into devolved administrations</p>
<blockquote>
<div>Country names then have to be [&#8216;Eng&#8217;, &#8216;Sco&#8217;, &#8216;Wales&#8217;,
NIre&#8217;, &#8216;IRELAND&#8217;, &#8216;BENELUX&#8217;]. Horribly inconsistent I know!</div></blockquote>
<p>Returns: mean, 5th,16th,median,84th,95th percentiles and prior for each country</p>
<p>Output in Tg/yr</p>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.open_ds">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">open_ds</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#open_ds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.open_ds" title="Permalink to this definition">¶</a></dt>
<dd><p>Function efficiently opens xray datasets.</p>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.plot_nuclei_density">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">plot_nuclei_density</code><span class="sig-paren">(</span><em>ds</em>, <em>out_filename=None</em>, <em>fignum=3</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#plot_nuclei_density"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.plot_nuclei_density" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot a 2D histogram/density plot of where nuclei are located in inversion domain</p>
<p>Requires x_ray dataset of outputs
Currently in rainbow colour scheme - Eurgh! #endrainbow</p>
<p>Specify an out_filename to write to disk</p>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.plot_scaling">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">plot_scaling</code><span class="sig-paren">(</span><em>data</em>, <em>lon</em>, <em>lat</em>, <em>clevels=None</em>, <em>cmap=&lt;matplotlib.colors.LinearSegmentedColormap object&gt;</em>, <em>label=None</em>, <em>smooth=False</em>, <em>out_filename=None</em>, <em>stations=None</em>, <em>fignum=None</em>, <em>title=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#plot_scaling"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.plot_scaling" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot 2d scaling map of posterior x
i.e. degree of scaling applied to prior emissions</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> &#8211; 2D (lat,lon) array of whatever you want</li>
<li><strong>clevels</strong> &#8211; Contour levels; defaults to np.arange(-2., 2.1, 0.1)</li>
<li><strong>cmap</strong> &#8211; Colormap - defaults to Red Blue reverse</li>
<li><strong>label</strong> &#8211; String - to appear at bottom</li>
<li><strong>smooth</strong> &#8211; If true plot smooth contours, otherwise use pcolormesh</li>
<li><strong>stations</strong> &#8211; Default is None. If specified needs to be a dictionary containing:
sites: &#8216;MHD&#8217;, &#8216;TAC&#8217;
MHD_lon: -9.02
MHHD_lat: 55.2
TAC_lon: etc...</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>None</p>
<dl class="docutils">
<dt>If out_filename is None:</dt>
<dd><p class="first last">Created plot is saved to file</p>
</dd>
<dt>Else:</dt>
<dd><p class="first last">Plot is displayed interactively</p>
</dd>
</dl>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.plot_timeseries">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">plot_timeseries</code><span class="sig-paren">(</span><em>ds</em>, <em>fig_text=None</em>, <em>ylim=None</em>, <em>out_filename=None</em>, <em>doplot=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#plot_timeseries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.plot_timeseries" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot measurement timeseries of posterior and observed measurements
Requires post_mcmc xray dataset
For future: incorporate model &amp; measurement uncertainty
Plots separate subplots for each of the measurement sites - hopefully!</p>
<p>ds = dataset output from run_tdmcmc script
fig_text = String e.g. &#8220;CH$_{4}$ mole fraction (ppb)&#8221;
ylim = array [ymin,ymax]</p>
<p>Specify an out_filename to write to disk</p>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.post_bl">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">post_bl</code><span class="sig-paren">(</span><em>ds</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#post_bl"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.post_bl" title="Permalink to this definition">¶</a></dt>
<dd><p>The post_bl function calculates the y posterior baseline iterations and mean</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ds</strong> (<em>xarray.Dataset</em>) &#8211; output from the run_tdmcmc function</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">y posterior baseline iterations, y posterior baseline mean</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">(np.array,np.array)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.post_mf">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">post_mf</code><span class="sig-paren">(</span><em>ds</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#post_mf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.post_mf" title="Permalink to this definition">¶</a></dt>
<dd><p>The post_mf function calculates the y posterior mole fraction ierations and mean</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ds</strong> (<em>xarray.Dataset</em>) &#8211; output from the run_tdmcmc function</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">y posterior mole fraction iterations, y posterior mole fraction mean</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">(np.array,np.array)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.prior_mf">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">prior_mf</code><span class="sig-paren">(</span><em>ds</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#prior_mf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.prior_mf" title="Permalink to this definition">¶</a></dt>
<dd><p>The prior_mf function calculates the y prior mole fraction</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ds</strong> (<em>xarray.Dataset</em>) &#8211; output from the run_tdmcmc function</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">y prior mole fraction</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">np.array</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.regions_histogram">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">regions_histogram</code><span class="sig-paren">(</span><em>k_it</em>, <em>out_filename=None</em>, <em>fignum=2</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#regions_histogram"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.regions_histogram" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot a histogram of the number of regions in trandimensional inversion</p>
<p>Use this as a check for whether kmax should be larger</p>
</dd></dl>

<dl class="function">
<dt id="acrg_tdmcmc.tdmcmc_post_process.write_netcdf">
<code class="descclassname">acrg_tdmcmc.tdmcmc_post_process.</code><code class="descname">write_netcdf</code><span class="sig-paren">(</span><em>flux_mean</em>, <em>flux_percentile</em>, <em>flux_it</em>, <em>flux_prior</em>, <em>flux_ap_percentile</em>, <em>country_mean</em>, <em>country_percentile</em>, <em>country_prior</em>, <em>country_ap_percentile</em>, <em>country_index</em>, <em>k_mean</em>, <em>k_percentile</em>, <em>lon</em>, <em>lat</em>, <em>time</em>, <em>country</em>, <em>percentile</em>, <em>nIt</em>, <em>experiment</em>, <em>outfile</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/acrg_tdmcmc/tdmcmc_post_process.html#write_netcdf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#acrg_tdmcmc.tdmcmc_post_process.write_netcdf" title="Permalink to this definition">¶</a></dt>
<dd><p>Function for writing all flux and country output to file</p>
<p>Only use this function for first set of variables
Once file has been created, use append_netcdf function above</p>
</dd></dl>

</div>
<div class="section" id="acrg-tdmcmc-tdmcmc-time-module">
<h2>acrg_tdmcmc.tdmcmc_time module<a class="headerlink" href="#acrg-tdmcmc-tdmcmc-time-module" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-acrg_tdmcmc">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-acrg_tdmcmc" title="Permalink to this headline">¶</a></h2>
<p>Created on Tue Sep 15 12:46:19 2015</p>
<p>&#64;author: ml12574</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">acrg_tdmcmc package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#acrg-tdmcmc-post-process-template-module">acrg_tdmcmc.post_process_template module</a></li>
<li><a class="reference internal" href="#module-acrg_tdmcmc.run_tdmcmc">acrg_tdmcmc.run_tdmcmc module</a></li>
<li><a class="reference internal" href="#module-acrg_tdmcmc.tdmcmc_config">acrg_tdmcmc.tdmcmc_config module</a><ul>
<li><a class="reference internal" href="#mcmc">MCMC</a></li>
<li><a class="reference internal" href="#how-to-run">How to run</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acrg-tdmcmc-tdmcmc-inputs-module">acrg_tdmcmc.tdmcmc_inputs module</a></li>
<li><a class="reference internal" href="#module-acrg_tdmcmc.tdmcmc_post_process">acrg_tdmcmc.tdmcmc_post_process module</a></li>
<li><a class="reference internal" href="#acrg-tdmcmc-tdmcmc-time-module">acrg_tdmcmc.tdmcmc_time module</a></li>
<li><a class="reference internal" href="#module-acrg_tdmcmc">Module contents</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/acrg_tdmcmc.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, mrghg.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/api/acrg_tdmcmc.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>