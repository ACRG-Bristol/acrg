<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>acrg_MOZART &#8212; acrg  documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for acrg_MOZART</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="sd">File to read in standard MOZART output file</span>
<span class="sd">Output will contain the timestamp, lat, lon, surface emissions and concentrations</span>
<span class="sd">If you want any other fields then you&#39;ll need to add them in</span>
<span class="sd">    import acrg_MOZART as mozart    </span>
<span class="sd">    data=mozart.read(&#39;filename&#39;)</span>
<span class="sd">    print data.time</span>
<span class="sd">    </span>
<span class="sd">Can also extract data for sites given lats and lons</span>
<span class="sd">sitefile = a text file with the site acronym, lat and then lon separated by spaces or tabs</span>
<span class="sd">    import acrg_MOZART as mozart</span>
<span class="sd">    data=mozart.filter(&#39;filename&#39;, &#39;sitefile&#39;)</span>

<span class="sd">    </span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">from</span> <span class="nn">acrg_grid.hybridcoords</span> <span class="k">import</span> <span class="n">hybridcoords</span> <span class="k">as</span> <span class="n">hybrid_coords</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">bisect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="k">import</span> <span class="n">Basemap</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">ticker</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">dateutil.relativedelta</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1"># ___________________________________________________________________________________________________________________</span>
<span class="c1"># CODE TO READ THE DIFFERENT DATA TYPES</span>
<span class="c1"># ___________________________________________________________________________________________________________________</span>

 <span class="c1"># Class to read in the MOZART output data</span>
 
 <span class="c1"># Filename: the full name and file path of the file you want to read in</span>
 <span class="c1"># conc_tag: the suffix of the variable of interest that you want to read in.</span>
 <span class="c1"># e.g for the variable CO2_VMR_avrg the suffix is &#39;_VMR_avrg&#39; </span>
 
 <span class="c1"># Please not this DOES NOT read in all the variables.</span>
 <span class="c1"># If you want a variable that it doesn&#39;t read in then add it!</span>
<div class="viewcode-block" id="read"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.read">[docs]</a><span class="k">class</span> <span class="nc">read</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">conc_tag</span> <span class="o">=</span> <span class="s1">&#39;_VMR_avrg&#39;</span><span class="p">):</span>
    
        <span class="nb">print</span> <span class="s1">&#39;Reading file : &#39;</span> <span class="o">+</span> <span class="n">filename</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">data</span><span class="o">=</span><span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        

        <span class="c1"># Might be multiple tracers</span>
        <span class="n">conc_varname</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">conc_tag</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>      

        <span class="c1"># Check that the conc_tag is actually in the list of variables</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conc_varname</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;The concentration tag you gave was not found in the given file&#39;</span>
            <span class="nb">print</span> <span class="s1">&#39;Please retry using one of the below variables:&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="nb">print</span> <span class="n">i</span>
        
        <span class="k">else</span><span class="p">:</span>

            <span class="n">conc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">conc_units</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">conc_varname</span><span class="p">:</span>     
                <span class="n">conc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">][:])</span> 
                <span class="n">conc_units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">))</span>
            
            
            <span class="k">if</span> <span class="s1">&#39;h0&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                <span class="c1"># Might be multiple tracers</span>
                <span class="n">emis_varname</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_SRF_EMIS_avrg&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>      
        
                <span class="n">emis</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">emis_units</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">emis_varname</span><span class="p">:</span>        
                    <span class="n">emis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">][:])</span> 
                    <span class="n">emis_units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">))</span>
                
                
            <span class="n">date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][:]</span> <span class="c1"># Date YYYYMMDD</span>
            <span class="n">secs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;datesec&#39;</span><span class="p">][:]</span> <span class="c1"># Seconds to be added to above date to make date-time variable</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">lev</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lev&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
            <span class="n">PS</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;PS&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">P0</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P0&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">hyai</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;hyai&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">hybi</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;hybi&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                    
            <span class="c1"># Split up the date using datetime.strptime</span>
            <span class="n">dt_time</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="p">(</span><span class="n">secs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">))]</span>
            <span class="n">dt_date</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">))]</span>
            
            <span class="n">time_t</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt_time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt_date</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">))]</span>
            
            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">hyai</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lon</span><span class="p">)))</span>
    
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">)):</span>         
                <span class="n">P_i</span> <span class="o">=</span> <span class="n">hybrid_coords</span><span class="p">(</span><span class="n">hyai</span><span class="p">,</span> <span class="n">PS</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:],</span>  <span class="n">B</span><span class="o">=</span><span class="n">hybi</span><span class="p">,</span> <span class="n">P0</span><span class="o">=</span><span class="n">P0</span><span class="p">,</span> <span class="n">half</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:,:]</span> <span class="o">=</span> <span class="n">P_i</span>
                <span class="nb">print</span> <span class="s1">&#39;date &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; processed&#39;</span>
             
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time_t</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">conc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lev</span> <span class="o">=</span> <span class="n">lev</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">P0</span> <span class="o">=</span><span class="n">P0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PS</span> <span class="o">=</span><span class="n">PS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hyai</span><span class="o">=</span><span class="n">hyai</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hybi</span><span class="o">=</span><span class="n">hybi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">P</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>     
            
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">concunits</span> <span class="o">=</span> <span class="n">conc_units</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressureunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">concnames</span> <span class="o">=</span> <span class="n">conc_varname</span>
            
            <span class="k">if</span> <span class="s1">&#39;h0&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emis</span> <span class="o">=</span> <span class="n">emis</span>             
                <span class="bp">self</span><span class="o">.</span><span class="n">emissunits</span> <span class="o">=</span> <span class="n">emis_units</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emisnames</span> <span class="o">=</span> <span class="n">emis_varname</span>
            
            <span class="k">if</span> <span class="s1">&#39;h2&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1">#if &#39;h0&#39; in filename:</span>
            
                <span class="n">start_date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;nbdate&#39;</span><span class="p">][:]</span>
                <span class="n">dt_start_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="p">),</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1">#            start_date = data.variables[&#39;date&#39;][:]</span>
    <span class="c1">#            dt_start_date = dt.datetime.strptime(str(start_date[0]),&#39;%Y%m%d&#39;)\</span>
    <span class="c1">#            - dateutil.relativedelta.relativedelta(months=1)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">dt_start_date</span>
            <span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
        
<span class="c1"># Class to read in the data</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">format</span>
<span class="sd">dimensions:</span>
<span class="sd">	lon = 144 ;</span>
<span class="sd">	lat = 96 ;</span>
<span class="sd">	time = UNLIMITED ; // (24 currently)</span>
<span class="sd">variables:</span>
<span class="sd">	double lon(lon) ;</span>
<span class="sd">		lon:long_name = &quot;longitude&quot; ;</span>
<span class="sd">		lon:units = &quot;degrees_east&quot; ;</span>
<span class="sd">	double lat(lat) ;</span>
<span class="sd">		lat:long_name = &quot;latitude&quot; ;</span>
<span class="sd">		lat:units = &quot;degrees_north&quot; ;</span>
<span class="sd">	int date(time) ;</span>
<span class="sd">		date:long_name = &quot;Date&quot; ;</span>
<span class="sd">		date:units = &quot;YYYYMMDD&quot; ;</span>
<span class="sd">	double time(time) ;</span>
<span class="sd">		time:long_name = &quot;Time&quot; ;</span>
<span class="sd">		time:units = &quot;days since 0000-01-01 00:00:00&quot; ;</span>
<span class="sd">	double ch4emissions(time, lat, lon) ;</span>
<span class="sd">		ch4emissions:long_name = &quot;CH4 emission rate&quot; ;</span>
<span class="sd">		ch4emissions:units = &quot;molecules/cm2/s&quot; ;</span>

<span class="sd">// global attributes:</span>
<span class="sd">		:Title = &quot;CH4_emissions&quot; ;</span>
<span class="sd">		:Author = &quot;Ann Stavert&quot; ;</span>
<span class="sd">		:Created = &quot;Sun Apr 27 15:22:18 2014&quot; ;</span>
<span class="sd">&quot;&quot;&quot;</span>
 <span class="c1"># Class to read in the MOZART input emissions data file</span>
 
 <span class="c1"># Filename: the full name and file path of the file you want to read in</span>
 <span class="c1"># emissions_tag: the suffix of the emissions variable</span>
 <span class="c1"># time_tag: the name of the time variable</span>
 <span class="c1"># emiss_varname: name of the gas of interest e.g. CO2 or CH4 (optional)</span>
     
 <span class="c1"># Please not this DOES NOT read in all the variables.</span>
 <span class="c1"># If you want a variable that it doesn&#39;t read in then add it!</span>
<div class="viewcode-block" id="read_flux"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.read_flux">[docs]</a><span class="k">class</span> <span class="nc">read_flux</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">emissions_tag_ncdf</span> <span class="o">=</span> <span class="s1">&#39;emissions&#39;</span><span class="p">,</span> <span class="n">time_tag</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">emiss_varname</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    
        <span class="nb">print</span> <span class="s1">&#39;Reading file : &#39;</span> <span class="o">+</span> <span class="n">filename</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">data</span><span class="o">=</span><span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">emiss_varname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">emiss_varname</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">)))</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="c1"># convert from upper to lowercase</span>
        <span class="n">name_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;CO2&#39;</span> <span class="p">:</span> <span class="s1">&#39;co2&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;CH4&#39;</span> <span class="p">:</span><span class="s1">&#39;ch4&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;N2O&#39;</span> <span class="p">:</span> <span class="s1">&#39;n2o&#39;</span><span class="p">}</span>
        <span class="n">emiss_varname</span> <span class="o">=</span> <span class="n">name_dict</span><span class="p">[</span><span class="n">emiss_varname</span><span class="p">]</span>
        
        <span class="n">emiss</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">emissions_tag_ncdf</span><span class="p">][:]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][:]</span> <span class="c1"># Date YYYYMMDD</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">time_tag</span><span class="p">][:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        
        <span class="c1"># Split up the date based on position        </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">):</span>
            <span class="c1"># we&#39;re dealing with a climatology </span>
            <span class="nb">print</span> <span class="s1">&#39;This appears to be a climatology. Using 2000 as a default year.&#39;</span>
            <span class="n">year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">year</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">2000</span>
            <span class="n">month</span> <span class="o">=</span> <span class="n">date</span>
            <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">day</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">15</span>
            
            <span class="n">dt_date</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">month</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">day</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">))]</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">int</span><span class="p">(((</span><span class="n">date</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">))[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">))])</span>
            <span class="n">month</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">int</span><span class="p">(((</span><span class="n">date</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">))[</span><span class="n">i</span><span class="p">])[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">))])</span>
            <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">int</span><span class="p">(((</span><span class="n">date</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">))[</span><span class="n">i</span><span class="p">])[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">))])</span>
            
            <span class="n">dt_date</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">month</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">day</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">))]</span>
        
        
        <span class="c1"># Calculate monthly means use xray</span>
        <span class="kn">import</span> <span class="nn">xray</span>
        
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">xray</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">emiss</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">dt_date</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">lat</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">lon</span><span class="p">)])</span>
        <span class="n">monthly_means</span> <span class="o">=</span> <span class="n">x_data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;MS&#39;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
        
        <span class="c1"># Convert the xray datetime to a normal datetime        </span>
        <span class="n">dt_monthly</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">monthly_means</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_units</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">time_tag</span><span class="p">]</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt_date</span> <span class="o">=</span> <span class="n">dt_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monthly_time</span> <span class="o">=</span> <span class="n">dt_monthly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monthly_means</span> <span class="o">=</span> <span class="n">monthly_means</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">emiss_varname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emis_units</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">emissions_tag_ncdf</span><span class="p">]</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>     </div>
        
                 
             



 <span class="c1"># Class to read in the netcdf site file written by matt listing the fixed sites </span>

<span class="c1"># sitefile: full name and file path of the file you want to read in</span>
<span class="c1"># species: the gas species of interest.</span>
<span class="c1"># dir: file path to file of interest</span>

<div class="viewcode-block" id="read_fixed_sitefile_nc"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.read_fixed_sitefile_nc">[docs]</a><span class="k">class</span> <span class="nc">read_fixed_sitefile_nc</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sitefile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="s1">&#39;CH4&#39;</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">=</span> <span class="s1">&#39;/shared_data/snowy/shared/GAUGE/&#39;</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">sitefile</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sitefile</span> <span class="o">=</span> <span class="nb">dir</span> <span class="o">+</span> <span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/global_obs_stationary.nc&#39;</span>
            <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CH4&#39;</span><span class="p">,</span><span class="s1">&#39;ch4&#39;</span><span class="p">]:</span>
                <span class="n">sitefile</span> <span class="o">=</span> <span class="nb">dir</span> <span class="o">+</span> <span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/global_obs_stationary_ch4.nc&#39;</span>
            
        <span class="nb">print</span> <span class="s1">&#39;Using site file : &#39;</span> <span class="o">+</span> <span class="n">sitefile</span>
        
        <span class="n">data</span><span class="o">=</span><span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">sitefile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

        
        <span class="c1"># Extract the data    </span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span> <span class="c1"># &quot;seconds since 2004-01-01 00:00:00&quot; ;</span>
        <span class="n">site</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">][:]</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">][:]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][:]</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">][:]</span>
        <span class="n">alt</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;altitude&#39;</span><span class="p">]</span> <span class="c1"># &quot;m  above 1.9x2.5 MOZART surface level (m)&quot; ;</span>
        <span class="n">conc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="n">repeatability</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_repeatability&#39;</span><span class="p">]</span>
	      
        <span class="c1"># Create the time variable</span>
        <span class="n">dateunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
        <span class="n">sincedate</span> <span class="o">=</span> <span class="n">dateunits</span><span class="p">[</span><span class="n">dateunits</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;seconds since &#39;</span><span class="p">)</span> <span class="o">+</span><span class="mi">14</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># seconds since 2014-01-01 00:00:00</span>
                
        <span class="n">time_dt</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">sincedate</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time</span><span class="p">]</span>
        <span class="c1">#time_dt = [dt.datetime(2009,1,1,0,0,0) + dt.timedelta(seconds=(i).astype(&#39;int&#39;)) for i in time]</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time_dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="n">alt</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt_units</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_lc</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">conc</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeatability</span> <span class="o">=</span> <span class="n">repeatability</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">conc</span><span class="o">.</span><span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">sitefile</span></div>


 <span class="c1"># Class to read in the netcdf site file written by matt listing the column sites (satelite + TCON)  </span>
 
 <span class="c1"># sitefile: full name and file path of the file you want to read in</span>
 <span class="c1"># species: the gas species of interest.</span>
 <span class="c1"># dir: file path to file of interest</span>
 <span class="c1"># month: the number month file you want to read in e.g. for Jan set = 1</span>
 <span class="c1"># year: the year you want to read in </span>
<div class="viewcode-block" id="read_column_sitefile_nc"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.read_column_sitefile_nc">[docs]</a><span class="k">class</span> <span class="nc">read_column_sitefile_nc</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sitefile</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="s1">&#39;CH4&#39;</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">=</span> <span class="s1">&#39;/shared_data/snowy/shared/GAUGE/&#39;</span><span class="p">,</span> <span class="n">month</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="mi">2009</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sitefile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="c1">#sitefile = dir + species + &#39;/global_obs_column_CH4&#39; + str(month).zfill(2) +str(year)+ &#39;.nc&#39;</span>
            <span class="n">sitefile</span> <span class="o">=</span> <span class="nb">dir</span> <span class="o">+</span> <span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/global_obs_column_&#39;</span><span class="o">+</span> <span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span><span class="s1">&#39;/global_obs_column_&#39;</span><span class="o">+</span><span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;.nc&#39;</span>
        
        <span class="n">data</span><span class="o">=</span><span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">sitefile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        
        <span class="c1"># Extract the data    </span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span> <span class="c1"># &quot;seconds since 2004-01-01 00:00:00&quot; ;</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">][:]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][:]</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">][:]</span>
        <span class="n">gas_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="n">gas_repeatability</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_repeatability&#39;</span><span class="p">]</span>
        <span class="n">averaging_kernel</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;averaging_kernel&#39;</span><span class="p">][:]</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span>
       
        <span class="c1"># Create the time variable</span>
        <span class="n">dateunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
        <span class="n">sincedate</span> <span class="o">=</span> <span class="n">dateunits</span><span class="p">[</span><span class="n">dateunits</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;seconds since &#39;</span><span class="p">)</span> <span class="o">+</span><span class="mi">14</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># seconds since 2009-01-01 00:00:00</span>
                
        <span class="n">time_dt</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">sincedate</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time</span><span class="p">]</span>
        <span class="c1">#time_dt = [dt.datetime(2009,1,1,0,0,0) + dt.timedelta(seconds=(i).astype(&#39;int&#39;)) for i in time]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time_dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_secs</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_lev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">pressure</span><span class="p">[:])[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gasname</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">gas_data</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeatability</span> <span class="o">=</span> <span class="n">gas_repeatability</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">gas_data</span><span class="o">.</span><span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">averaging_kernel</span> <span class="o">=</span> <span class="n">averaging_kernel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure_units</span> <span class="o">=</span> <span class="n">pressure</span><span class="o">.</span><span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">sitefile</span></div>
 

<span class="c1"># Class to read in the netcdf site file written by matt listing the mobile GAUGE sites (ferry and aircraft)  </span>

 <span class="c1"># sitefile: full name and file path of the file you want to read in</span>
 <span class="c1"># species: the gas species of interest.</span>
 <span class="c1"># dir: file path to file of interest</span>
 <span class="c1"># month: the number month file you want to read in e.g. for Jan set = 1</span>
 <span class="c1"># year: the year you want to read in </span>
<div class="viewcode-block" id="read_mobile_sitefile_nc"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.read_mobile_sitefile_nc">[docs]</a><span class="k">class</span> <span class="nc">read_mobile_sitefile_nc</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sitefile</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="s1">&#39;CH4&#39;</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">=</span> <span class="s1">&#39;/shared_data/snowy/shared/GAUGE/&#39;</span><span class="p">,</span> <span class="n">month</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="mi">2003</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">sitefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">species</span> <span class="o">==</span> <span class="s1">&#39;CH4&#39;</span><span class="p">:</span>
                <span class="n">sitefile</span> <span class="o">=</span> <span class="nb">dir</span> <span class="o">+</span> <span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/global_obs_mobile_&#39;</span> <span class="o">+</span><span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;/global_obs_mobile_&#39;</span> <span class="o">+</span><span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.nc&#39;</span>
        
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sitefile</span> <span class="o">=</span> <span class="nb">dir</span> <span class="o">+</span> <span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/global_obs_mobile/global_obs_mobile_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.nc&#39;</span>

        <span class="c1"># Check if the site file exists</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">sitefile</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">exists</span> <span class="p">:</span>
            
            <span class="nb">print</span> <span class="s1">&#39;Site file being read:&#39;</span>
            <span class="nb">print</span> <span class="n">sitefile</span>
            
            <span class="n">data</span><span class="o">=</span><span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">sitefile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            
            <span class="c1"># Extract the data    </span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span> <span class="c1"># &quot;seconds since 2004-01-01 00:00:00&quot; ;</span>
            <span class="n">site</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">][:]</span>
            <span class="n">network</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">][:]</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">][:]</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][:]</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">][:]</span>
            <span class="n">alt</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;altitude&#39;</span><span class="p">]</span>
            <span class="n">gas_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
            <span class="n">gas_repeatability</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_repeatability&#39;</span><span class="p">]</span>
            <span class="n">pressure</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span>
            
            <span class="c1"># Create the time variable</span>
            <span class="n">dateunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
            <span class="n">sincedate</span> <span class="o">=</span> <span class="n">dateunits</span><span class="p">[</span><span class="n">dateunits</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;seconds since &#39;</span><span class="p">)</span> <span class="o">+</span><span class="mi">14</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># seconds since 2014-01-01 00:00:00</span>
                    
            <span class="n">time_dt</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">sincedate</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time</span><span class="p">]</span>
            <span class="c1">#time_dt = [dt.datetime(2009,1,1,0,0,0) + dt.timedelta(seconds=(i).astype(&#39;int&#39;)) for i in time]</span>
    
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time_dt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_secs</span> <span class="o">=</span> <span class="n">time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="n">alt</span><span class="p">[:]</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">alt_units</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">units</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">gasname</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">gas_data</span><span class="p">[:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repeatability</span> <span class="o">=</span> <span class="n">gas_repeatability</span><span class="p">[:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">gas_data</span><span class="o">.</span><span class="n">units</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">[:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressure_units</span> <span class="o">=</span> <span class="n">pressure</span><span class="o">.</span><span class="n">units</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">network</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">sitefile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileexists</span> <span class="o">=</span> <span class="n">exists</span>
    
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;Sitefile &#39;</span> <span class="o">+</span> <span class="n">sitefile</span> <span class="o">+</span> <span class="s1">&#39; does not exist&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileexists</span> <span class="o">=</span> <span class="n">exists</span></div>




<span class="c1"># ___________________________________________________________________________________________________________________</span>
<span class="c1"># CODE TO DO USEFUL STUFF</span>
<span class="c1"># ___________________________________________________________________________________________________________________</span>
        
 <span class="c1"># Class to estimate the pressure levels from a given altitude</span>
 <span class="c1"># This uses the scale height and a simple atmospheric model</span>
 <span class="c1"># P = P0 * e^(-Z/H)</span>
 <span class="c1"># Where P = Pressure</span>
 <span class="c1"># P0 = surface pressure in Pa</span>
 <span class="c1"># -Z = altitude (km)</span>
 <span class="c1"># H = scale height (km) this is hard coded to be 7.64km which is the global mean</span>
 <span class="c1"># This assumes that the altitude is in m unless other units are given</span>
<div class="viewcode-block" id="calc_pressure"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.calc_pressure">[docs]</a><span class="k">class</span> <span class="nc">calc_pressure</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">altitude</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">exp</span>
        
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">altitude</span> <span class="o">=</span> <span class="n">altitude</span><span class="o">/</span><span class="mf">1000.0</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span><span class="s1">&#39;metres&#39;</span><span class="p">:</span>
            <span class="n">altitude</span> <span class="o">=</span> <span class="n">altitude</span><span class="o">/</span><span class="mf">1000.0</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span><span class="s1">&#39;km&#39;</span><span class="p">:</span>
            <span class="n">altitude</span> <span class="o">=</span> <span class="n">altitude</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span><span class="s1">&#39;miles&#39;</span><span class="p">:</span>
            <span class="n">altitude</span> <span class="o">=</span> <span class="n">altitude</span><span class="o">*</span><span class="mf">1.609344</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">units</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;km&#39;</span><span class="p">,</span><span class="s1">&#39;miles&#39;</span><span class="p">})</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;the units you have given are not a listed option&#39;</span>
            <span class="nb">print</span> <span class="s1">&#39;please give the altitude in m, km or miles&#39;</span>
        
        <span class="n">pressure</span> <span class="o">=</span> <span class="n">P0</span><span class="o">*</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">altitude</span><span class="p">)</span><span class="o">/</span><span class="mf">7.64</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">pressure</span></div>
 
 <span class="c1"># Calculates altitude from pressures using the standard scale height 7.64 km.</span>
 <span class="c1"># Pressure in Pa.       </span>
 <span class="c1"># P0 = surface pressure in Pa</span>
 <span class="c1"># P =  pressure in Pa</span>
<div class="viewcode-block" id="calc_altitude"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.calc_altitude">[docs]</a><span class="k">def</span> <span class="nf">calc_altitude</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">h0</span><span class="o">=</span><span class="mf">7.64e3</span><span class="p">):</span>
    <span class="n">alt</span> <span class="o">=</span> <span class="o">-</span><span class="n">h0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">alt</span></div>

 <span class="c1"># Class to read in the site file txt version</span>
<div class="viewcode-block" id="read_sitefile_txt"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.read_sitefile_txt">[docs]</a><span class="k">class</span> <span class="nc">read_sitefile_txt</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sitefile</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sitefile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">sitedata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">sitefile</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sitefile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">sitedata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">sitefile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">sitenames</span> <span class="o">=</span> <span class="n">sitedata</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">sitedata</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">sitedata</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">alt</span> <span class="o">=</span> <span class="n">sitedata</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sitenames</span> <span class="o">=</span> <span class="n">sitenames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">sitefile</span></div>
        
 <span class="c1"># Class to extract the lat lon for the correct site from the text site files  </span>
<div class="viewcode-block" id="extract_site_info"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.extract_site_info">[docs]</a><span class="k">class</span> <span class="nc">extract_site_info</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sitefile</span><span class="p">,</span> <span class="n">sitename</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">sitefile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;acf&#39;</span><span class="p">),</span> <span class="n">sitefile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ferry&#39;</span><span class="p">)])</span>  <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">sitedata</span><span class="o">=</span><span class="n">read_sitefile_txt</span><span class="p">(</span><span class="n">sitefile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sitedata</span><span class="o">=</span><span class="n">read_sitefile_GONZI_nc</span><span class="p">(</span><span class="n">sitefile</span><span class="p">)</span>
            
        <span class="n">site_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sitedata</span><span class="o">.</span><span class="n">sitenames</span><span class="o">==</span><span class="n">sitename</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>      
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sitename</span> <span class="o">=</span> <span class="n">sitedata</span><span class="o">.</span><span class="n">sitenames</span><span class="p">[</span><span class="n">site_i</span><span class="p">]</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">sitedata</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">site_i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">sitedata</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">site_i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="n">sitedata</span><span class="o">.</span><span class="n">alt</span><span class="p">[</span><span class="n">site_i</span><span class="p">]</span></div>

<span class="c1"># Class to match a point to the closest lat/lon in an array of lat/lons using bisect</span>

<span class="c1"># lat: the latitude in degrees of your point of interest</span>
<span class="c1"># lon: the longitude in degrees of your point of interest</span>
<span class="c1"># lat_array: 2D array of latitudes in degress</span>
<span class="c1"># lon_array: 2D array of longitudes in degress</span>

<div class="viewcode-block" id="match_latlon"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.match_latlon">[docs]</a><span class="k">class</span> <span class="nc">match_latlon</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat_array</span><span class="p">,</span> <span class="n">lon_array</span><span class="p">):</span>
        
        <span class="c1"># NB: Assuming evenly spaced grid</span>
        <span class="n">lat_spacing</span> <span class="o">=</span> <span class="n">lat_array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lon_spacing</span> <span class="o">=</span> <span class="n">lon_array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lon_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        
        <span class="c1"># If the lon array is from 0 to 360</span>
        <span class="c1"># then need to check if the lon point is &lt; 0</span>
        <span class="c1"># if it&#39;s &lt; 0 then convert it</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">lon_array</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="mi">360</span>
        
        <span class="c1"># If the lon array is from -180 to 180</span>
        <span class="c1"># then need to check that the lon point is &gt; 180</span>
        <span class="c1"># if it&#39;s &gt; 180 then convert it</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">lon_array</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">lon</span>
        
        
        <span class="n">lat_index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="n">lat_array</span><span class="o">+</span><span class="p">(</span><span class="n">lat_spacing</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">lat</span><span class="p">)</span> <span class="c1"># nb: the adjustment shifts the grid so that it returns the closest point</span>
        <span class="n">lon_index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="n">lon_array</span><span class="o">+</span><span class="p">(</span><span class="n">lon_spacing</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">lon</span><span class="p">)</span> <span class="c1"># nb: the adjustment shifts the grid so that it returns the closest point</span>


        <span class="c1"># Check the edges of the lon grid</span>
        <span class="k">if</span> <span class="n">lon_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lon_array</span><span class="p">):</span>
            <span class="n">lon_index</span> <span class="o">=</span> <span class="mi">0</span>
            
        
        <span class="bp">self</span><span class="o">.</span><span class="n">inputlocation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat_array</span> <span class="o">=</span> <span class="n">lat_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon_array</span> <span class="o">=</span> <span class="n">lon_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closestpoint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">lat_array</span><span class="p">[</span><span class="n">lat_index</span><span class="p">],</span> <span class="n">lon_array</span><span class="p">[</span><span class="n">lon_index</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closestindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">lat_index</span><span class="p">,</span> <span class="n">lon_index</span><span class="p">))</span></div>
        








<span class="c1"># ___________________________________________________________________________________________________________________</span>
<span class="c1"># CODE TO MATCH THE DIFFERENT DATA TYPES</span>
<span class="c1"># ___________________________________________________________________________________________________________________</span>

        
<span class="c1"># Class to filter the data for fixed locations</span>
<span class="c1"># e.g. towers NOT mobile locations</span>
<span class="c1"># This uses an individual MOZART history file</span>
<span class="c1"># and matt&#39;s netcdf site file which contains the lat, lon and alt for fixed sites</span>

<span class="c1"># mzfile: full name and path for the MOZART file of interest</span>
<span class="c1"># conc_tag: the suffix of the variable of interest that you want to read in.</span>
<span class="c1"># e.g for the variable CO2_VMR_avrg the suffix is &#39;_VMR_avrg&#39; </span>
<span class="c1"># sitefile: file listing the fixed sites</span>
<span class="c1"># Ave: set if you want to take the average of the bottom 7 levels rather than try and match the height to the pressure levels</span>

<span class="c1"># NB: returns a 3D array (3x3x3) where the central point is the closest to the given fixed location</span>
<div class="viewcode-block" id="data_filter_fixed"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.data_filter_fixed">[docs]</a><span class="k">class</span> <span class="nc">data_filter_fixed</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mzfile</span><span class="p">,</span> <span class="n">conc_tag</span> <span class="o">=</span> <span class="s1">&#39;_VMR_avrg&#39;</span><span class="p">,</span> <span class="n">sitefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ave</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        
        <span class="c1"># Read MOZART file name</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">mzfile</span><span class="p">,</span> <span class="n">conc_tag</span><span class="o">=</span><span class="n">conc_tag</span><span class="p">)</span>
        
        <span class="c1"># Read site info file</span>
        <span class="c1"># siteinfo = read_sitefile_txt(sitefile)</span>
        <span class="n">species</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span>
        <span class="n">siteinfo</span> <span class="o">=</span> <span class="n">read_fixed_sitefile_nc</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="n">sitefile</span><span class="o">=</span><span class="n">sitefile</span><span class="p">)</span>    
         
        <span class="c1"># create parameters to store output</span>
        <span class="c1"># initialise to nans</span>
        <span class="n">pressures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>  

        <span class="c1"># need to determine how many tracers there are in the file</span>
        <span class="n">conc_no</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">concnames</span><span class="p">)</span>    
        
        <span class="n">concs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">conc_no</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 
        <span class="n">concs_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">conc_no</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 
        
        <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 
        
        <span class="n">emissions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">conc_no</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 
        
        <span class="n">matched_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 
        <span class="n">matched_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 
        <span class="n">matched_levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 
        
        <span class="n">site_pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>         
        
        <span class="c1">#Convert to an array for ease of access</span>
        <span class="n">allconcs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">conc</span><span class="p">)</span>
        <span class="n">allemis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">emis</span><span class="p">)</span>

        
        <span class="c1"># loop through each lat/lon in the siteinfo</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">lat</span><span class="p">)):</span>
            
            
            <span class="c1"># use the match_latlot code which is based on bisect rather than calculating the exact distance</span>
            <span class="n">latlon_index</span> <span class="o">=</span> <span class="n">match_latlon</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>      
            
            <span class="c1"># As it&#39;s tall tower then we&#39;ll want the data for all time stamps</span>
            <span class="c1"># Extract column pressure at the correct lat/lon for all timestamps</span>
            <span class="c1"># This should be a time by lev array</span>
            <span class="c1"># column_P = np.squeeze(data.pressure[:,[np.arange(len(data.hyai)-1)],haversine.mindist_index[0], haversine.mindist_index[1]])        </span>

            <span class="c1"># Changed 16/1/2015 to extract</span>
            <span class="c1"># the closest match and then a cube surrounding that point, </span>
            <span class="c1"># - north, south, east, west, above and below</span>

            <span class="c1"># find the lat and lon range</span>
            <span class="nb">print</span> <span class="s1">&#39;site: &#39;</span> <span class="o">+</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> 
            <span class="nb">print</span> <span class="s1">&#39;site postion: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
              
            
            <span class="c1"># Adjustments for hitting the edge of the grid</span>
            <span class="c1"># lat index = 0 i.e. south pole</span>
            <span class="k">if</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lat_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">([</span><span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">matched_lats</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">lat_range</span><span class="p">]</span>
                
                
            <span class="c1"># lat index  = 95 i.e. north pole</span>
            <span class="k">elif</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">95</span><span class="p">:</span>
                <span class="n">lat_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">([</span><span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">matched_lats</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">lat_range</span><span class="p">]</span>
                
            <span class="k">else</span><span class="p">:</span>            
                <span class="n">lat_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">([</span><span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">matched_lats</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">lat_range</span><span class="p">]</span>
                

            
            <span class="c1"># Adjustments for hitting the edge of the grid</span>
            <span class="c1"># lon index = 0 i.e. western edge</span>
            <span class="k">if</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lon_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">143</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># lon index  = 143 i.e. eastern edge</span>
            <span class="k">elif</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">143</span><span class="p">:</span>
                <span class="n">lon_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">142</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                
            <span class="k">else</span><span class="p">:</span>            
                <span class="n">lon_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">([</span><span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="n">matched_lons</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">lon_range</span><span class="p">]</span>
            
            
            <span class="nb">print</span> <span class="s1">&#39;model lats: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matched_lats</span><span class="p">[</span><span class="n">j</span><span class="p">,:])</span>
            <span class="nb">print</span> <span class="s1">&#39;model lons: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matched_lons</span><span class="p">[</span><span class="n">j</span><span class="p">,:])</span>

            

            
            <span class="c1"># Extract the column pressure at each time point for the matching (central) point of the cube</span>
            <span class="c1"># Pressure is time x lev x lat x lon</span>
            <span class="n">column_P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pressure</span><span class="p">[:,:,</span><span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>        
            
            
            <span class="k">if</span> <span class="n">Ave</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Just take the average of the bottom 7 levels that&#39;s all the data roughly &lt; 1 km</span>
    
                <span class="c1"># Put data for each lat/lon (i.e. j value) into output arrays </span>
                <span class="c1"># I want the lowest 7 levels which are actually the LAST 7 not the first</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
                <span class="n">index</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">hyai</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">pressures</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">column_P</span><span class="p">[:,[</span><span class="n">index</span><span class="p">]]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c1"># Extract the corresponding concentrations and emissions</span>
                <span class="n">conc_j</span> <span class="o">=</span> <span class="n">allconcs</span><span class="p">[:,:,</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">concs</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">conc_j</span><span class="p">[:,:,[</span><span class="n">index</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">concs_sd</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">conc_j</span><span class="p">[:,:,[</span><span class="n">index</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                
    
            <span class="k">else</span><span class="p">:</span>
                
                
                
                <span class="c1"># Convert the altitude to a pressure using P0 from the model</span>
                <span class="n">site_pressure</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">calc_pressure</span><span class="p">(</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">alt</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">P0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">siteinfo</span><span class="o">.</span><span class="n">alt_units</span><span class="p">))</span><span class="o">.</span><span class="n">pressure</span>             
                <span class="nb">print</span> <span class="s1">&#39;site pressure: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">site_pressure</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>               
                
                <span class="c1"># Loop through each time step and match site pressure to column level</span>
                <span class="c1"># Extract the cube of data</span>
                <span class="c1"># Store the positions</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">)):</span>
                    <span class="c1"># Find the index of the closest level based on pressure</span>
                    <span class="c1"># column_P is time x lev</span>
                    <span class="n">lev_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">column_P</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">site_pressure</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">column_P</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">site_pressure</span><span class="p">[</span><span class="n">j</span><span class="p">])))[</span><span class="mi">0</span><span class="p">]</span>
                    
                    <span class="c1"># As I&#39;m using &quot;fancy&#39; indexing rather than slicing I need to do each dimension separately </span>
                    <span class="c1"># Extract data for time = i</span>
                    <span class="n">pressures_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pressure</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:,:])</span>
                    <span class="n">concs_i</span> <span class="o">=</span> <span class="n">allconcs</span><span class="p">[:,</span><span class="n">i</span><span class="p">,:,:,:]</span>
                    <span class="n">emissions_i</span> <span class="o">=</span> <span class="n">allemis</span><span class="p">[:,</span><span class="n">i</span><span class="p">,:,:]</span>
                    
                    <span class="c1"># Extract data for lat range</span>
                    <span class="n">pressures_lat</span> <span class="o">=</span> <span class="n">pressures_i</span><span class="p">[:,</span><span class="n">lat_range</span><span class="p">,:]</span>
                    <span class="n">concs_lat</span> <span class="o">=</span> <span class="n">concs_i</span><span class="p">[:,:,</span><span class="n">lat_range</span><span class="p">,:]</span>
                    <span class="n">emissions_lat</span> <span class="o">=</span> <span class="n">emissions_i</span><span class="p">[:,</span><span class="n">lat_range</span><span class="p">,:]</span>
                    
                    <span class="c1"># Extract data for lon range  </span>
                    <span class="n">pressures_lon</span> <span class="o">=</span> <span class="n">pressures_lat</span><span class="p">[:,:,</span><span class="n">lon_range</span><span class="p">]</span>
                    <span class="n">concs_lon</span> <span class="o">=</span> <span class="n">concs_lat</span><span class="p">[:,:,:,</span><span class="n">lon_range</span><span class="p">]</span>
                    <span class="n">emissions_lon</span> <span class="o">=</span> <span class="n">emissions_lat</span><span class="p">[:,:,</span><span class="n">lon_range</span><span class="p">]</span>
                    
                    <span class="c1">#pdb.set_trace()</span>
                    
                    <span class="c1"># Define the range of the height of the cube</span>
                    <span class="c1"># NB: the levels are 1 based while the levels are 1 based</span>
                    <span class="c1"># if using the bottom level</span>
                    <span class="k">if</span> <span class="n">lev_index</span> <span class="o">==</span> <span class="mi">55</span><span class="p">:</span>
                        <span class="n">lev_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">([</span><span class="mi">54</span><span class="p">,</span><span class="mi">55</span><span class="p">])</span>
                                                
                        <span class="c1"># store the level numbers used                    </span>
                        <span class="n">levs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">55</span><span class="p">,</span> <span class="mi">56</span><span class="p">]</span>                  
                        
                        <span class="c1">#print &#39;lev_i: &#39; + str(lev_i)                        </span>
                        
                        <span class="c1"># extract and store the pressure levels used and corresponding concs</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat_range</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">pressures</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">pressures_lon</span><span class="p">[</span><span class="n">lev_i</span><span class="p">,:,:]</span>
                            <span class="n">concs</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">concs_lon</span><span class="p">[:,</span><span class="n">lev_i</span><span class="p">,:,:]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pressures</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">pressures_lon</span><span class="p">[</span><span class="n">lev_i</span><span class="p">,:,:]</span>
                            <span class="n">concs</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">concs_lon</span><span class="p">[:,</span><span class="n">lev_i</span><span class="p">,:,:]</span>
                    
                        
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lev_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">([</span><span class="n">lev_index</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_index</span><span class="p">,</span> <span class="n">lev_index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                    
                        
                        <span class="c1"># store the level numbers used  </span>
                        <span class="c1"># NB: levels are 1 based while the index is 0 based</span>
                        <span class="n">levs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span>  <span class="p">[</span><span class="n">lev_index</span><span class="p">,</span> <span class="n">lev_index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_index</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>                    
                        
                        <span class="c1">#print &#39;lev_i: &#39; + str(lev_i)</span>
                        
                        <span class="c1"># extract and store the pressure levels used and corresponding concs</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat_range</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">pressures</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pressures_lon</span><span class="p">[</span><span class="n">lev_i</span><span class="p">,:,:])</span>
                            <span class="n">concs</span><span class="p">[:</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,:]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">concs_lon</span><span class="p">[:,</span><span class="n">lev_i</span><span class="p">,:,:])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pressures</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,:,:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pressures_lon</span><span class="p">[</span><span class="n">lev_i</span><span class="p">,:,:])</span>
                            <span class="n">concs</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,:,:,:]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">concs_lon</span><span class="p">[:,</span><span class="n">lev_i</span><span class="p">,:,:])</span>
                
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat_range</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span>
                        <span class="n">emissions</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">emissions_lon</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">emissions</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">emissions_lon</span>
                       
               
                    
        <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sitetype</span> <span class="o">=</span> <span class="s1">&#39;TT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sitenames</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_lat</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">lat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_lon</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">lon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_alt</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">alt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_pressure</span> <span class="o">=</span> <span class="n">site_pressure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">time</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model_pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pressures</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_lat</span> <span class="o">=</span> <span class="n">matched_lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_lon</span> <span class="o">=</span> <span class="n">matched_lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_levs</span> <span class="o">=</span> <span class="n">matched_levs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">concs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conc_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">concs_sd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">emissions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concnames</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">concnames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emisnames</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">emisnames</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mzfile</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">sitefile</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">concunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">concunits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emissunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">emissunits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressureunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pressureunits</span>         </div>
        



<span class="c1"># Class to filter the data</span>
<span class="c1"># This uses an individual MOZART history file</span>
<span class="c1"># and Matt&#39;s netcdf site file which contains the lat, lon and alt for column sites</span>

<span class="c1"># mzfile: full name and path for the MOZART file of interest</span>
<span class="c1"># conc_tag: the suffix of the variable of interest that you want to read in.</span>
<span class="c1"># e.g for the variable CO2_VMR_avrg the suffix is &#39;_VMR_avrg&#39; </span>
<span class="c1"># sitefile: file listing the fixed sites</span>
<span class="c1"># singlesite: set to the three letter acronym of a single site if you just want a single site</span>

<div class="viewcode-block" id="data_filter_column"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.data_filter_column">[docs]</a><span class="k">class</span> <span class="nc">data_filter_column</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mzfile</span><span class="p">,</span> <span class="n">sitefile</span><span class="p">,</span> <span class="n">conc_tag</span> <span class="o">=</span> <span class="s1">&#39;_VMR_avrg&#39;</span><span class="p">,</span> <span class="n">singlesite</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        
        <span class="c1"># Read MOZART file name</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">mzfile</span><span class="p">,</span> <span class="n">conc_tag</span> <span class="o">=</span> <span class="n">conc_tag</span><span class="p">)</span> 
        
        <span class="c1"># Read site info file</span>
        <span class="n">species</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span>
        <span class="n">columndata</span> <span class="o">=</span> <span class="n">read_fixed_sitefile_nc</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="n">sitefile</span><span class="o">=</span><span class="n">sitefile</span><span class="p">)</span>
        
        <span class="c1"># Determine how many sites we&#39;re extracting for</span>
        <span class="k">if</span> <span class="n">singlesite</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sites</span> <span class="o">=</span> <span class="p">[</span><span class="n">singlesite</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sites</span> <span class="o">=</span> <span class="n">columndata</span><span class="o">.</span><span class="n">site</span>
        
        <span class="c1"># create parameters to store output</span>
        <span class="c1"># initialise to nans</span>
        <span class="c1"># need to determine how many tracers there are in the file</span>
        <span class="n">conc_no</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">concnames</span><span class="p">)</span>    

        <span class="n">model_pressures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sites</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lev</span><span class="p">),))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 
        <span class="n">model_concs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">conc_no</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sites</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lev</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 
        
        <span class="c1"># Lats and Lon are not going to change with time</span>
        <span class="n">matched_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sites</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 
        <span class="n">matched_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sites</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> 

        <span class="c1"># Model times will be identical for all locations        </span>
        <span class="n">model_times</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">time</span>
        

        <span class="c1"># loop through each site</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sites</span><span class="p">)):</span>
            
            <span class="c1"># Extract the index for that site in the column data file</span>
            <span class="n">CD_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">columndata</span><span class="o">.</span><span class="n">site</span> <span class="o">==</span> <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Use the match_latlon which is based on bisect</span>
            <span class="c1"># To identify the closest model point</span>
            <span class="n">latlon_index</span> <span class="o">=</span> <span class="n">match_latlon</span><span class="p">(</span><span class="n">columndata</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">CD_j</span><span class="p">],</span><span class="n">columndata</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">CD_j</span><span class="p">],</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>      

            <span class="nb">print</span> <span class="s1">&#39;Matching site &#39;</span> <span class="o">+</span> <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="nb">print</span> <span class="s1">&#39;Actual location: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columndata</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">CD_j</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columndata</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">CD_j</span><span class="p">])</span>
            <span class="nb">print</span> <span class="s1">&#39;Model matched location: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">latlon_index</span><span class="o">.</span><span class="n">closestpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">latlon_index</span><span class="o">.</span><span class="n">closestpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Extract the matched location                </span>
            <span class="n">matched_lats</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">matched_lons</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            
            <span class="c1"># Extract the column pressure at the matching time point for the matching lat/lon</span>
            <span class="c1"># Pressure and conc are time x lev x lat x lon</span>
            <span class="n">model_pressures</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pressure</span><span class="p">[:,:,</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>     
            <span class="n">model_concs</span><span class="p">[:,</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">conc</span><span class="p">[:,:,:,</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latlon_index</span><span class="o">.</span><span class="n">closestindex</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        
                    
        <span class="bp">self</span><span class="o">.</span><span class="n">sitetype</span> <span class="o">=</span> <span class="s1">&#39;Column&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_lat</span> <span class="o">=</span> <span class="n">columndata</span><span class="o">.</span><span class="n">lat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_lon</span> <span class="o">=</span> <span class="n">columndata</span><span class="o">.</span><span class="n">lon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">sites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concnames</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">concnames</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_times</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_pressure</span> <span class="o">=</span> <span class="n">model_pressures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_lat</span> <span class="o">=</span> <span class="n">matched_lats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_lon</span> <span class="o">=</span> <span class="n">matched_lons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">model_concs</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mzfile</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">sitefile</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">concunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">concunits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressureunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pressureunits</span>    </div>



<span class="c1"># Class to filter the data</span>
<span class="c1"># This uses an individual MOZART history file</span>
<span class="c1"># and a site file which contains the lat, lon, alt and time for moving sites</span>

<span class="c1"># mzfile: full name and path for the MOZART file of interest</span>
<span class="c1"># conc_tag: the suffix of the variable of interest that you want to read in.</span>
<span class="c1"># e.g for the variable CO2_VMR_avrg the suffix is &#39;_VMR_avrg&#39; </span>
<span class="c1"># sitefile: file listing the fixed sites</span>

<div class="viewcode-block" id="data_filter_mobile"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.data_filter_mobile">[docs]</a><span class="k">class</span> <span class="nc">data_filter_mobile</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mzfile</span><span class="p">,</span> <span class="n">conc_tag</span> <span class="o">=</span> <span class="s1">&#39;_VMR_avrg&#39;</span><span class="p">,</span> <span class="n">sitefile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>   
                
    
        <span class="c1"># Read MOZART file name</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">mzfile</span><span class="p">,</span> <span class="n">conc_tag</span> <span class="o">=</span> <span class="n">conc_tag</span><span class="p">)</span>
        
        <span class="n">species</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span>
        <span class="c1">#print &#39;reading site file : &#39; </span>
        <span class="nb">print</span> <span class="n">sitefile</span>
        
        <span class="c1"># Read site info file        </span>
        <span class="n">siteinfo</span> <span class="o">=</span> <span class="n">read_mobile_sitefile_nc</span><span class="p">(</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">sitefile</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="n">species</span><span class="p">,</span> <span class="n">month</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        
        <span class="c1"># only proceed if the site file exists</span>
        <span class="k">if</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">fileexists</span> <span class="p">:</span>
            
            <span class="n">matched_data</span> <span class="o">=</span> <span class="n">data_match_mobile</span><span class="p">(</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span><span class="p">,</span> \
                                            <span class="n">model_conc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">conc</span><span class="p">,</span> \
                                            <span class="n">model_lat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> \
                                            <span class="n">model_lon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> \
                                            <span class="n">model_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> \
                                            <span class="n">model_P0</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">P0</span><span class="p">,</span> \
                                            <span class="n">model_pressure</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span> \
                                            <span class="n">model_emission</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                                            <span class="n">obs_conc</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">conc</span><span class="p">,</span> \
                                            <span class="n">obs_lat</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> \
                                            <span class="n">obs_lon</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> \
                                            <span class="n">obs_time</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> \
                                            <span class="n">obs_pressure</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span> \
                                            <span class="n">obs_alt</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> \
                                            <span class="n">obs_alt_units</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">alt_units</span><span class="p">,</span> \
                                            <span class="n">quiet</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> \
                                            <span class="n">concnames</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">concnames</span><span class="p">)</span>
         
                
            <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">network</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">site</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sitetype</span> <span class="o">=</span> <span class="s1">&#39;mobile&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">case</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mzfile</span> <span class="o">=</span> <span class="n">mzfile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">sitefile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">concunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">concunits</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressureunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pressureunits</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">site_lat</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">lat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site_lon</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">lon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site_alt</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">alt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site_pressure</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">pressure</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site_conc</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">conc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site_repeat</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">repeatability</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site_units</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">units</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site_time</span> <span class="o">=</span> <span class="n">siteinfo</span><span class="o">.</span><span class="n">time</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">model_pressure</span> <span class="o">=</span> <span class="n">matched_data</span><span class="o">.</span><span class="n">matched_pressure</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_lat</span> <span class="o">=</span> <span class="n">matched_data</span><span class="o">.</span><span class="n">matched_lat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_lon</span> <span class="o">=</span> <span class="n">matched_data</span><span class="o">.</span><span class="n">matched_lon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_time</span> <span class="o">=</span> <span class="n">matched_data</span><span class="o">.</span><span class="n">matched_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_units</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">concunits</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">matched_data</span><span class="o">.</span><span class="n">matched_conc</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">fileexists</span> <span class="o">=</span> <span class="kc">True</span>

            
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;There is no matching mobile obs data for : &#39;</span> <span class="o">+</span> <span class="n">mzfile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileexists</span> <span class="o">=</span> <span class="kc">False</span></div>
 

    
<span class="c1"># Generalised code to match model 4D array (time/lat/lon/P) to given obs vector (dim = time) with associated lat, lons and P (alt) </span>
<span class="c1"># Assumes that the model and obs times are given as datetimes</span>
<span class="c1"># Set quiet = 0 to stop matched info being printed</span>
<div class="viewcode-block" id="data_match_mobile"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.data_match_mobile">[docs]</a><span class="k">class</span> <span class="nc">data_match_mobile</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">model_conc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">model_lat</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">model_lon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">model_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">model_P0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">model_pressure</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">model_emission</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">obs_conc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">obs_lat</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">obs_lon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">obs_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">obs_pressure</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">obs_alt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">obs_alt_units</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="n">quiet</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> \
                <span class="n">concnames</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>   
                
            <span class="c1"># check if the matching will be using alt or P</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obs_pressure</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obs_alt</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                    <span class="nb">print</span> <span class="s1">&#39;Not obs pressure or altitude were given&#39;</span>
                    <span class="nb">print</span> <span class="s1">&#39;Assuming ground level&#39;</span>
 
 
            <span class="c1"># Put in checks of the inputs</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_time</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;You need to give model time&#39;</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_conc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;You need to give model concentrations&#39;</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_lat</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;You need to give model lat&#39;</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_lon</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;You need to give model lon&#39;</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_pressure</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;You need to give model pressure&#39;</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_P0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;You need to give model P0&#39;</span>
                
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obs_time</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;You need to give obs time&#39;</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obs_conc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;You need to give obs conc&#39;</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obs_lat</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;You need to give obs lat&#39;</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obs_lon</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;You need to give obs lon&#39;</span>
            

            
             
            <span class="c1"># Convert the model times and the obs times to seconds</span>
            <span class="c1"># Assumes that these are given as datetimes</span>
            
            <span class="n">model_secs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="n">i</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_time</span><span class="p">])</span>
            
            <span class="n">obs_secs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="n">i</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obs_time</span><span class="p">])</span>

            <span class="c1"># need to determine how many tracers there are in the file</span>
            <span class="n">conc_no</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">concnames</span><span class="p">)</span>    

 
            <span class="c1"># create parameters to store output</span>
            <span class="n">matched_pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_time</span><span class="p">))</span>      
            <span class="n">matched_conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conc_no</span><span class="p">,</span> <span class="n">obs_time</span><span class="p">))</span>
            <span class="n">matched_time</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">matched_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_time</span><span class="p">))</span>
            <span class="n">matched_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_time</span><span class="p">))</span>
            <span class="n">matched_emissions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conc_no</span><span class="p">,</span> <span class="n">obs_time</span><span class="p">))</span>
            
            <span class="c1"># loop through each lat/lon in the same time range as the model output</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_time</span><span class="p">)):</span>
                
                <span class="c1"># Use the haverseine code to determine the closest model grid point to the obs location</span>
                <span class="n">latlon_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">match_latlon</span><span class="p">(</span><span class="n">obs_lat</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">obs_lon</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">model_lat</span><span class="p">,</span> <span class="n">model_lon</span><span class="p">))</span><span class="o">.</span><span class="n">closestindex</span>      
                <span class="n">matched_lat</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_lat</span><span class="p">[</span><span class="n">latlon_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>                
                <span class="n">matched_lon</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_lon</span><span class="p">[</span><span class="n">latlon_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> 
                
                
                <span class="c1"># Match obs timestamp to the closest model timestamp</span>
                <span class="n">time_gap</span> <span class="o">=</span> <span class="n">model_secs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">model_secs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">timeindex_j</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="n">model_secs</span> <span class="o">+</span> <span class="p">(</span><span class="n">time_gap</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">obs_secs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                
                
                <span class="c1">#pdb.set_trace()                </span>
                
                <span class="c1"># if it&#39;s AFTER the last model point then bisect returns the number of elements in the data.time array</span>
                <span class="k">if</span> <span class="n">timeindex_j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_time</span><span class="p">):</span>
                    <span class="n">timeindex_j</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_time</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="nb">print</span> <span class="s1">&#39;Switched to last element of time array&#39;</span>
                
                <span class="n">matched_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_time</span><span class="p">[</span><span class="n">timeindex_j</span><span class="p">])</span>
                
                
                <span class="c1"># Determine the closest level</span>
                <span class="c1"># if there&#39;s no alt or pressure given assuming it&#39;s the surface (which for mozart is the last one)</span>
                <span class="c1">#pdb.set_trace()  </span>

                <span class="c1"># Extract column pressure at the correct lat/lon for the  matching timestamp</span>
                <span class="n">column_P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_pressure</span><span class="p">[</span><span class="n">timeindex_j</span><span class="p">,:,</span><span class="n">latlon_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latlon_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>                
                
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obs_pressure</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">obs_alt</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                    
                    <span class="n">lev_i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># if obs pressure isn&#39;t given use alt</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obs_pressure</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">obs_pressure</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>

                        <span class="n">obs_pressure_j</span> <span class="o">=</span> <span class="n">calc_pressure</span><span class="p">(</span><span class="n">obs_alt</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">model_P0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">obs_alt_units</span><span class="p">)</span><span class="o">.</span><span class="n">pressure</span>                    
                        <span class="c1"># Match site pressure to column level</span>
                        <span class="c1"># as the pressure levels aren&#39;t evenly matched i&#39;d need to find the gap and then compare to </span>
                        <span class="c1"># the pressures  on either side which is unlikely to be much faster than this anyway</span>
                        <span class="n">lev_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">column_P</span> <span class="o">-</span> <span class="n">obs_pressure_j</span><span class="p">)</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">column_P</span> <span class="o">-</span> <span class="n">obs_pressure_j</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
                        
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># ferry P = -1</span>
                        <span class="k">if</span> <span class="n">obs_pressure</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="c1"># use surface</span>
                            <span class="n">lev_i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                            
                        <span class="k">else</span><span class="p">:</span>
                            
                            <span class="n">obs_pressure_j</span> <span class="o">=</span> <span class="n">obs_pressure</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    
                            <span class="c1"># Match site pressure to column level</span>
                            <span class="c1"># as the pressure levels aren&#39;t evenly matched i&#39;d need to find the gap and then compare to </span>
                            <span class="c1"># the pressures  on either side which is unlikely to be much faster than this anyway</span>
                            <span class="n">lev_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">column_P</span> <span class="o">-</span> <span class="n">obs_pressure_j</span><span class="p">)</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">column_P</span> <span class="o">-</span> <span class="n">obs_pressure_j</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
             
                <span class="n">matched_pressure</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">column_P</span><span class="p">[</span><span class="n">lev_i</span><span class="p">])</span>
                     
                <span class="c1"># Extract the corresponding concentrations and emission</span>
                <span class="c1"># Put data for each lat/lon (i.e. j value) into output arrays            </span>
                
                <span class="n">matched_conc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_conc</span><span class="p">[:,</span><span class="n">timeindex_j</span><span class="p">,</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">latlon_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">latlon_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_emission</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">matched_emissions</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_emission</span><span class="p">[:,</span><span class="n">timeindex_j</span><span class="p">,</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">latlon_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">latlon_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    
    
                <span class="k">if</span> <span class="n">quiet</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">obs_lat</span><span class="p">)</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">obs_lat</span><span class="p">)</span>
                    <span class="nb">print</span> <span class="s1">&#39;Obs lat: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs_lat</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="nb">print</span> <span class="s1">&#39;Model lat: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matched_lat</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="nb">print</span> <span class="s1">&#39;Obs lon: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs_lon</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="nb">print</span> <span class="s1">&#39;Model lon: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matched_lon</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                       
                    <span class="nb">print</span> <span class="s1">&#39;Obs time: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs_time</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="nb">print</span> <span class="s1">&#39;Model time: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matched_time</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    
                    <span class="k">if</span> <span class="n">lev_i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span>
                        <span class="nb">print</span> <span class="s1">&#39;Obs pressure: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obs_pressure_j</span><span class="p">)</span>
                    <span class="nb">print</span> <span class="s1">&#39;Model pressure: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matched_pressure</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_time</span> <span class="o">=</span> <span class="n">obs_time</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_lat</span> <span class="o">=</span> <span class="n">obs_lat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_lon</span> <span class="o">=</span> <span class="n">obs_lon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_alt</span> <span class="o">=</span> <span class="n">obs_alt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_pressure</span> <span class="o">=</span> <span class="n">obs_pressure</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_conc</span> <span class="o">=</span> <span class="n">obs_conc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">concnames</span> <span class="o">=</span> <span class="n">concnames</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model_time</span> <span class="o">=</span> <span class="n">model_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_lat</span> <span class="o">=</span> <span class="n">model_lat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_lon</span> <span class="o">=</span> <span class="n">model_lon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_pressure</span> <span class="o">=</span> <span class="n">model_pressure</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_conc</span> <span class="o">=</span> <span class="n">model_conc</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">matched_time</span> <span class="o">=</span> <span class="n">matched_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matched_lat</span> <span class="o">=</span> <span class="n">matched_lat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matched_lon</span> <span class="o">=</span> <span class="n">matched_lon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matched_pressure</span> <span class="o">=</span> <span class="n">matched_pressure</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matched_conc</span> <span class="o">=</span> <span class="n">matched_conc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matched_emissions</span> <span class="o">=</span> <span class="n">matched_emissions</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span></div>
          
 
 
 
 
<span class="c1"># ___________________________________________________________________________________________________________________</span>
<span class="c1"># CODE TO WRITE THE DIFFERENT DATA TYPES</span>
<span class="c1"># ___________________________________________________________________________________________________________________</span>
            
            
<span class="c1"># Class to write out the data from a moving platform</span>

<span class="c1"># filtereddata: the output of data_match_mobile</span>
<span class="c1"># outdir: the directory you wish to write the file to. Defaults to the directory containing the original MOZART file.</span>
<span class="c1"># filename: name for output file defaults to &quot;species&quot;_&quot;casename&quot;.mzt.h0.&quot;Timestamp&quot;_&quot;sitetype&quot;.nc</span>

<div class="viewcode-block" id="write_ncdf_mobile"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.write_ncdf_mobile">[docs]</a><span class="k">class</span> <span class="nc">write_ncdf_mobile</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filtereddata</span><span class="p">,</span> <span class="n">outdir</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        
        <span class="kn">import</span> <span class="nn">os</span>
        
        <span class="n">mzfile</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">mzfile</span><span class="p">)</span>
    
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mzfile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>  
                <span class="n">filetimestamp</span> <span class="o">=</span> <span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">[</span><span class="mi">0</span><span class="p">])[(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h0&#39;</span><span class="p">)</span><span class="o">+</span> <span class="mi">2</span><span class="p">:</span> <span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mzfile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">filetimestamp</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">[</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h0&#39;</span><span class="p">)</span><span class="o">+</span> <span class="mi">2</span><span class="p">:</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">case</span> <span class="o">+</span> <span class="s1">&#39;.mzt.h0&#39;</span><span class="o">+</span>  <span class="n">filetimestamp</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">sitetype</span><span class="o">+</span><span class="s1">&#39;.nc&#39;</span>
        
        <span class="nb">print</span> <span class="s1">&#39;writing file: &#39;</span> <span class="o">+</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span> <span class="n">filename</span>
        
        
        <span class="c1">#Write NetCDF file</span>
        <span class="n">ncF</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        
        <span class="c1"># Create the dimensions</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">site_time</span><span class="p">))</span>
        
        <span class="c1"># Make some global attributes</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">mzfile</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">sitefile</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">case</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">species</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">sitetype</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">sitetype</span>
        
        <span class="c1"># Create the variables</span>
        <span class="n">ncsitenames</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;sitename&#39;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">site</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>        
        
        <span class="n">ncobs_time</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;obs_time&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
        <span class="n">ncobs_lon</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;obs_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
        <span class="n">ncobs_lat</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;obs_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
        <span class="n">ncobs_alt</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;obs_alt&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
        <span class="n">ncobs_press</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;obs_pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
        <span class="n">ncobs_conc</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;obs_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
        <span class="n">ncobs_repeat</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;obs_repeatability&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
        
        <span class="n">ncmodel_time</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;model_time&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
        <span class="n">ncmodel_lon</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;model_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
        <span class="n">ncmodel_lat</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;model_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
        <span class="n">ncmodel_press</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;model_pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>


        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filterdata</span><span class="o">.</span><span class="n">concnames</span><span class="p">)):</span>
            <span class="n">ncmodel_conc</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">concnames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">))</span>
            <span class="n">ncmodel_conc</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">conc</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
            <span class="n">ncmodel_conc</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
        <span class="c1"># Fill the variables</span>
        <span class="n">ncsitenames</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">site</span>        
                
        <span class="c1"># times as seconds since 1/1/2009</span>
        <span class="n">ncobs_time</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">t</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">site_time</span><span class="p">]</span>     
    
        <span class="n">ncobs_lon</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">site_lon</span>
        <span class="n">ncobs_lat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">site_lat</span>
        <span class="n">ncobs_alt</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">site_alt</span>
        <span class="n">ncobs_press</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">site_pressure</span>
        <span class="n">ncobs_conc</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">site_conc</span>
        <span class="n">ncobs_repeat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">site_repeat</span>
        
        <span class="c1"># times as seconds since 1/1/2009</span>
        <span class="n">ncmodel_time</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">t</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_time</span><span class="p">]</span>     
    
        <span class="n">ncmodel_lon</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_lon</span>
        <span class="n">ncmodel_lat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_lat</span>
        <span class="n">ncmodel_press</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_pressure</span>

        
        
        
        <span class="c1"># Give the variables some attributes        </span>
        <span class="n">ncmodel_lon</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Degrees east&#39;</span>
        <span class="n">ncmodel_lat</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Degrees north&#39;</span>
        <span class="n">ncmodel_conc</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">concunits</span>
        <span class="n">ncobs_conc</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">site_units</span>
        <span class="n">ncmodel_press</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">pressureunits</span>
        <span class="n">ncmodel_time</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;seconds since 2009-01-01 00:00:00&#39;</span>
        
        <span class="n">ncF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span> <span class="s2">&quot;Written &quot;</span> <span class="o">+</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span> <span class="n">filename</span></div>



<span class="c1"># Class to write out the data from a stationary platform</span>

<span class="c1"># filtereddata: the output of data_match_fixed</span>
<span class="c1"># outdir: the directory you wish to write the file to. Defaults to the directory containing the original MOZART file.</span>
<span class="c1"># filename: name for output file defaults to &quot;species&quot;_&quot;casename&quot;.mzt.h0.&quot;Timestamp&quot;_&quot;sitetype&quot;.nc</span>

<div class="viewcode-block" id="write_ncdf_fixed"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.write_ncdf_fixed">[docs]</a><span class="k">class</span> <span class="nc">write_ncdf_fixed</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filtereddata</span><span class="p">,</span> <span class="n">outdir</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        
        <span class="kn">import</span> <span class="nn">os</span>
        
        <span class="n">mzfile</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">mzfile</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mzfile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>  
                <span class="n">filetimestamp</span> <span class="o">=</span> <span class="n">mzfile</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">mzfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h0&#39;</span><span class="p">)</span><span class="o">+</span> <span class="mi">2</span><span class="p">:</span> <span class="n">mzfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mzfile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">filetimestamp</span> <span class="o">=</span> <span class="n">mzfile</span><span class="p">[</span><span class="n">mzfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h0&#39;</span><span class="p">)</span><span class="o">+</span> <span class="mi">2</span><span class="p">:</span> <span class="n">mzfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">case</span> <span class="o">+</span> <span class="s1">&#39;.mzt.h0&#39;</span><span class="o">+</span>  <span class="n">filetimestamp</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">sitetype</span><span class="o">+</span><span class="s1">&#39;.nc&#39;</span>
        
        <span class="nb">print</span> <span class="s1">&#39;writing file: &#39;</span> <span class="o">+</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span> <span class="n">filename</span>
        
        <span class="c1">#Write NetCDF file</span>
        <span class="n">ncF</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        
        <span class="c1"># Create the dimensions</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;sitenames&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">site</span><span class="p">))</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        
        <span class="c1"># Make some global attributes</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">mzfile</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">sitefile</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">case</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">species</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">sitetype</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">sitetype</span>
        
        <span class="c1"># Create the variables</span>
        <span class="c1">#ncsitenames = ncF.createVariable(&#39;sitename&#39;,&#39;s&#39;, (&#39;sitenames&#39;,))</span>
        <span class="n">ncsitenames</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;sitename&#39;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">sitenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;sitenames&#39;</span><span class="p">,))</span>        
        
        <span class="n">nctime</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>

        <span class="n">nclon</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;sitenames&#39;</span><span class="p">,</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">))</span>
        <span class="n">nclat</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;sitenames&#39;</span><span class="p">,</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">))</span>
        <span class="n">ncpress</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;sitenames&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">,</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">,</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">,))</span>
        
        <span class="c1"># Fill the variables</span>
        <span class="n">ncsitenames</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">sitenames</span>        
                
        <span class="c1"># times as seconds since 1/1/2009</span>
        <span class="n">nctime</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">t</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">time</span><span class="p">]</span>     
    
   
        <span class="n">nclon</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_lon</span>
        <span class="n">nclat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_lat</span>
        <span class="n">ncpress</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_pressure</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">concnames</span><span class="p">)):</span>
            <span class="n">ncconc</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">concnames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;sitenames&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">,</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">,</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">,))</span>        
            <span class="n">ncconc</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">conc</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:,:,:,:]</span>
            <span class="n">ncconc</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">concunits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
        
            <span class="n">ncemiss</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">emisnames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;sitenames&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">,</span><span class="s1">&#39;boxwidth&#39;</span><span class="p">))</span>        
            <span class="n">ncemiss</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">emis</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
            <span class="n">ncemiss</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">emissunits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Give the variables some attributes        </span>
        <span class="n">nclon</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Degrees east&#39;</span>
        <span class="n">nclat</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Degrees north&#39;</span>
        <span class="n">ncpress</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">pressureunits</span>
        <span class="n">nctime</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;seconds since 2009-01-01 00:00:00&#39;</span>
        
        <span class="n">ncF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span> <span class="s2">&quot;Written &quot;</span> <span class="o">+</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span> <span class="n">filename</span></div>


<span class="c1"># Class to write out the data from a stationary platform</span>

<span class="c1"># filtereddata: the output of data_match_column</span>
<span class="c1"># outdir: the directory you wish to write the file to. Defaults to the directory containing the original MOZART file.</span>
<span class="c1"># filename: name for output file defaults to &quot;species&quot;_&quot;casename&quot;.mzt.h0.&quot;Timestamp&quot;_&quot;sitetype&quot;.nc</span>

<div class="viewcode-block" id="write_ncdf_column"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.write_ncdf_column">[docs]</a><span class="k">class</span> <span class="nc">write_ncdf_column</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filtereddata</span><span class="p">,</span> <span class="n">outdir</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        
        <span class="kn">import</span> <span class="nn">os</span>
        
        
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>            
                <span class="n">filetimestamp</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h0&#39;</span><span class="p">)</span><span class="o">+</span> <span class="mi">2</span><span class="p">:</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">filetimestamp</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="p">[</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h0&#39;</span><span class="p">)</span><span class="o">+</span> <span class="mi">2</span><span class="p">:</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">case</span> <span class="o">+</span> <span class="s1">&#39;.mzt.h0&#39;</span><span class="o">+</span>  <span class="n">filetimestamp</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">sitetype</span><span class="o">+</span><span class="s1">&#39;.nc&#39;</span>

        <span class="nb">print</span> <span class="s1">&#39;writing file: &#39;</span> <span class="o">+</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span> <span class="n">filename</span>
        
        <span class="c1">#Write NetCDF file</span>
        <span class="n">ncF</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        
        <span class="c1"># Create the dimensions</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">model_time</span><span class="p">))</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">model_pressure</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">site</span><span class="p">))</span>
        
        
        <span class="c1"># Make some global attributes</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">mzfile</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">mzfile</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">sitefile</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">case</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">species</span>
        <span class="n">ncF</span><span class="o">.</span><span class="n">sitetype</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">sitetype</span>
        
        <span class="c1"># Create the variables </span>
        <span class="c1"># time variable the same as the number of time points</span>
        <span class="n">nctime</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>   
        
        <span class="c1"># Lats and lons - one per site</span>
        <span class="n">nclon</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">,))</span>
        <span class="n">nclat</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">,))</span>
        
        <span class="c1"># Pressure and concs</span>
        <span class="c1"># Sites by time by lev</span>
        <span class="n">ncpress</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lev&#39;</span><span class="p">,))</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">concnames</span><span class="p">)):</span>
            <span class="n">ncconc</span> <span class="o">=</span> <span class="n">ncF</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">filtereddata</span><span class="o">.</span><span class="n">concnames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lev&#39;</span><span class="p">,))</span>
            <span class="n">ncconc</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">conc</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>    
            <span class="n">ncconc</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">concunits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
        <span class="c1"># Fill the variables               </span>
        <span class="c1"># times as seconds since 1/1/2009</span>
        <span class="n">nctime</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">t</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_time</span><span class="p">]</span>     
   
        <span class="n">nclon</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_lon</span>
        <span class="n">nclat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_lat</span>
        <span class="n">ncpress</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">model_pressure</span>
        
        
        <span class="c1"># Give the variables some attributes        </span>
        <span class="n">nclon</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Degrees east&#39;</span>
        <span class="n">nclat</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Degrees north&#39;</span>
        <span class="n">nctime</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;seconds since 2009-01-01 00:00:00&#39;</span>
        <span class="n">ncpress</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">filtereddata</span><span class="o">.</span><span class="n">pressureunits</span>

        
        <span class="n">ncF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span> <span class="s2">&quot;Written &quot;</span> <span class="o">+</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span> <span class="n">filename</span></div>


            
<span class="c1"># ___________________________________________________________________________________________________________________</span>
<span class="c1"># CODE TO READ THE DIFFERENT DATA TYPES</span>
<span class="c1"># ___________________________________________________________________________________________________________________</span>
<span class="c1"># Class to read in the filtered output</span>

<span class="c1"># filename: files you&#39;d like to read in. This overides setting the filepattern variable.</span>
<span class="c1"># filepattern: suffix on end of files that you&#39;d like to read in</span>
<span class="c1"># species: speies of interest (set this if using filepattern)</span>
<div class="viewcode-block" id="read_ncdf_fixed"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.read_ncdf_fixed">[docs]</a><span class="k">class</span> <span class="nc">read_ncdf_fixed</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filenames</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filepattern</span> <span class="o">=</span> <span class="s1">&#39;*_TT.nc&#39;</span><span class="p">,</span>  <span class="n">species</span><span class="o">=</span><span class="s1">&#39;CH4&#39;</span><span class="p">,</span> <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">filenames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">fnmatch</span>
            <span class="kn">import</span> <span class="nn">os</span>
            
            <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="n">directory</span> <span class="o">=</span> <span class="s1">&#39;/data/as13988/MOZART/&#39;</span><span class="o">+</span><span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;/output/FWDModelComparison_NewEDGAR/&#39;</span>
            
            <span class="n">filepattern</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="o">+</span><span class="n">species</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="n">filepattern</span>
            
            <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">filepattern</span><span class="p">):</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>   
                    
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">matches</span>
        <span class="c1"># need to sort the files</span>
        <span class="n">filenames</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;There are no files matching the file pattern in the given directory&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)):</span>
                
                <span class="nb">print</span> <span class="s1">&#39;Reading file : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                
                <span class="n">data</span><span class="o">=</span><span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                
                <span class="n">lon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>
                
                <span class="c1">#sitenames = data.variables[&#39;sitename&#39;][:] </span>
                <span class="n">sitenames</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;sitename&#39;</span><span class="p">][:]</span> 
                
                <span class="n">time_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:])</span>
                <span class="n">pressure_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">][:])</span>
                
                <span class="c1"># Create the time variable</span>
                <span class="n">dateunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
                <span class="n">sincedate</span> <span class="o">=</span> <span class="n">dateunits</span><span class="p">[</span><span class="n">dateunits</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;seconds since &#39;</span><span class="p">)</span> <span class="o">+</span><span class="mi">14</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># seconds since 2014-01-01 00:00:00</span>
                    
                <span class="n">dt_date_j</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">sincedate</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time_j</span><span class="p">]</span>

                <span class="k">if</span> <span class="s1">&#39;h0&#39;</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">conc_tag</span> <span class="o">=</span> <span class="s1">&#39;_VMR_avrg&#39;</span>
                
                <span class="k">if</span> <span class="s1">&#39;h1&#39;</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>        
                    <span class="n">conc_varname</span> <span class="o">=</span> <span class="s1">&#39;_13:30_LT&#39;</span>
                
                <span class="k">if</span> <span class="s1">&#39;h2&#39;</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>        
                    <span class="n">conc_varname</span> <span class="o">=</span> <span class="s1">&#39;_VMR_avrg&#39;</span>
        
                <span class="c1"># Might be multiple tracers</span>
                <span class="n">conc_varname</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">conc_tag</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>      
                <span class="n">conc_j</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">conc_units</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">conc_varname</span><span class="p">:</span>        
                    <span class="n">conc_j</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">][:])</span> 
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">conc_units</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
                    
                <span class="k">if</span> <span class="s1">&#39;h0&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                    <span class="c1"># Might be multiple tracers</span>
                    <span class="n">emis_varname</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_SRF_EMIS_avrg&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>      
                    
                    <span class="n">emis_j</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> <span class="n">emis_units</span> <span class="o">=</span> <span class="p">[]</span>
                    
                    
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">emis_varname</span><span class="p">:</span>        
                        <span class="n">emis_j</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">][:])</span> 
                        <span class="k">if</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">emis_units</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
                
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                
                    <span class="n">conc</span> <span class="o">=</span> <span class="n">conc_j</span>              
                    <span class="n">emis</span> <span class="o">=</span> <span class="n">emis_j</span>
                    <span class="n">pressure</span> <span class="o">=</span>  <span class="n">pressure_j</span>
                    <span class="n">dt_date</span> <span class="o">=</span> <span class="n">dt_date_j</span>              
                    <span class="n">case</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">sitetype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;sitetype&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">sitefile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;sitefile&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">pressureunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    
                    <span class="n">conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">conc</span><span class="p">,</span> <span class="n">conc_j</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">emis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">emis</span><span class="p">,</span> <span class="n">emis_j</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pressure</span><span class="p">,</span> <span class="n">pressure_j</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>                
                    <span class="n">dt_date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">dt_date</span><span class="p">,</span> <span class="n">dt_date_j</span><span class="p">))</span>
                
                <span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">dt_date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emis</span> <span class="o">=</span> <span class="n">emis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">conc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">pressure</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sitenames</span> <span class="o">=</span> <span class="n">sitenames</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filenames</span> <span class="o">=</span> <span class="n">filenames</span>         
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">case</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sitetype</span> <span class="o">=</span> <span class="n">sitetype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="n">sitefile</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">concnames</span> <span class="o">=</span><span class="n">conc_varname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">conc_units</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressureunits</span> <span class="o">=</span> <span class="n">pressureunits</span></div>
 

<span class="c1"># Class to read in the filtered output for mobile platforms</span>

<span class="c1"># filename: files you&#39;d like to read in this overides setting the filepattern variable</span>
<span class="c1"># filepattern: suffix on end of files that you&#39;d like to read in</span>
<span class="c1"># species: speies of interest (set this if using filepattern)</span>
<div class="viewcode-block" id="read_ncdf_mobile"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.read_ncdf_mobile">[docs]</a><span class="k">class</span> <span class="nc">read_ncdf_mobile</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">filenames</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="s1">&#39;CH4&#39;</span><span class="p">,</span> <span class="n">filepattern</span> <span class="o">=</span> <span class="s1">&#39;*_mobile.nc&#39;</span><span class="p">,</span>\
        <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">fnmatch</span>
            <span class="kn">import</span> <span class="nn">os</span>
            
            <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">directory</span> <span class="o">=</span> <span class="s1">&#39;/data/as13988/MOZART/&#39;</span><span class="o">+</span><span class="n">species</span><span class="o">+</span><span class="s1">&#39;/output/FWDModelComparison_NewEDGAR/&#39;</span>
            
            <span class="n">filepattern</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="o">+</span><span class="n">species</span><span class="o">+</span><span class="n">filepattern</span>
             
            
            <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">filepattern</span><span class="p">):</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>   
                    
            <span class="n">filenames</span> <span class="o">=</span> <span class="n">matches</span>
            
        <span class="c1"># need to sort the files</span>
        <span class="n">filenames</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>        
            <span class="nb">print</span> <span class="s2">&quot;There are no files in the given directory matching the file pattern&quot;</span>
        
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)):</span>
                
                <span class="nb">print</span> <span class="s1">&#39;Reading file : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                
                <span class="n">data</span><span class="o">=</span><span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                            
                <span class="n">model_lon_j</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;model_lon&#39;</span><span class="p">][:]</span>
                <span class="n">model_lat_j</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;model_lat&#39;</span><span class="p">][:]</span>
                <span class="n">obs_lon_j</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;obs_lon&#39;</span><span class="p">][:]</span>
                <span class="n">obs_lat_j</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;obs_lat&#39;</span><span class="p">][:]</span>
               
                <span class="c1">#sitenames = data.variables[&#39;sitename&#39;][:] </span>
                <span class="n">sitenames_j</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;sitename&#39;</span><span class="p">][:]</span> 
                
                <span class="n">model_time_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;model_time&#39;</span><span class="p">][:])</span>
                <span class="n">obs_time_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;obs_time&#39;</span><span class="p">][:])</span>

                <span class="n">model_conc_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;model_conc&#39;</span><span class="p">][:])</span>
                <span class="n">obs_conc_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;obs_conc&#39;</span><span class="p">][:])</span>

                <span class="n">model_pressure_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;model_pressure&#39;</span><span class="p">][:])</span>
                <span class="n">obs_pressure_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;obs_pressure&#39;</span><span class="p">][:])</span>
                
                <span class="c1"># Create the time variable</span>
                <span class="n">dateunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;model_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
                <span class="n">sincedate</span> <span class="o">=</span> <span class="n">dateunits</span><span class="p">[</span><span class="n">dateunits</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;seconds since &#39;</span><span class="p">)</span> <span class="o">+</span><span class="mi">14</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># seconds since 2014-01-01 00:00:00</span>
                    
                <span class="n">model_dt_date_j</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">sincedate</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_time_j</span><span class="p">]</span>
                <span class="n">obs_dt_date_j</span> <span class="o">=</span> <span class="p">[</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">sincedate</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obs_time_j</span><span class="p">]</span>
               
                
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    
                    <span class="n">sitenames</span> <span class="o">=</span> <span class="n">sitenames_j</span>            
                
                    <span class="n">model_conc</span> <span class="o">=</span> <span class="n">model_conc_j</span>      
                    <span class="n">obs_conc</span> <span class="o">=</span> <span class="n">obs_conc_j</span>                    

                    <span class="n">model_pressure</span> <span class="o">=</span>  <span class="n">model_pressure_j</span>
                    <span class="n">obs_pressure</span> <span class="o">=</span>  <span class="n">obs_pressure_j</span>
                    
                    <span class="n">model_dt_date</span> <span class="o">=</span> <span class="n">model_dt_date_j</span>         
                    <span class="n">obs_dt_date</span> <span class="o">=</span> <span class="n">obs_dt_date_j</span>         
                    
                    <span class="n">model_lat</span> <span class="o">=</span> <span class="n">model_lat_j</span>
                    <span class="n">model_lon</span> <span class="o">=</span> <span class="n">model_lon_j</span>
                    <span class="n">obs_lat</span> <span class="o">=</span> <span class="n">obs_lat_j</span>
                    <span class="n">obs_lon</span> <span class="o">=</span> <span class="n">obs_lon_j</span>
                    
    
                <span class="k">else</span><span class="p">:</span>
                    
                    <span class="n">sitenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sitenames</span><span class="p">,</span> <span class="n">sitenames_j</span><span class="p">))</span>               
                    
                    <span class="n">model_conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">model_conc</span><span class="p">,</span> <span class="n">model_conc_j</span><span class="p">))</span>
                    <span class="n">obs_conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">obs_conc</span><span class="p">,</span> <span class="n">obs_conc_j</span><span class="p">))</span>

                    <span class="n">model_pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">model_pressure</span><span class="p">,</span> <span class="n">model_pressure_j</span><span class="p">))</span>    
                    <span class="n">obs_pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">obs_pressure</span><span class="p">,</span> <span class="n">obs_pressure_j</span><span class="p">))</span> 
                    
                    <span class="n">model_dt_date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">model_dt_date</span><span class="p">,</span> <span class="n">model_dt_date_j</span><span class="p">))</span>
                    <span class="n">obs_dt_date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">obs_dt_date</span><span class="p">,</span> <span class="n">obs_dt_date_j</span><span class="p">))</span>
                    
                    <span class="n">model_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">model_lat</span><span class="p">,</span> <span class="n">model_lat_j</span><span class="p">))</span>
                    <span class="n">model_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">model_lon</span><span class="p">,</span> <span class="n">model_lon_j</span><span class="p">))</span>
                    <span class="n">obs_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">obs_lat</span><span class="p">,</span> <span class="n">obs_lat_j</span><span class="p">))</span>
                    <span class="n">obs_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">obs_lon</span><span class="p">,</span> <span class="n">obs_lon_j</span><span class="p">))</span>
    
                    
                    
            <span class="bp">self</span><span class="o">.</span><span class="n">model_time</span> <span class="o">=</span> <span class="n">model_dt_date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_time</span> <span class="o">=</span> <span class="n">obs_dt_date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_conc</span> <span class="o">=</span> <span class="n">model_conc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_conc</span> <span class="o">=</span> <span class="n">obs_conc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_pressure</span> <span class="o">=</span> <span class="n">model_pressure</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_pressure</span> <span class="o">=</span> <span class="n">obs_pressure</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_lon</span> <span class="o">=</span> <span class="n">model_lon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_lat</span> <span class="o">=</span> <span class="n">model_lat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_lon</span> <span class="o">=</span> <span class="n">obs_lon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs_lat</span> <span class="o">=</span> <span class="n">obs_lat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sitenames</span> <span class="o">=</span> <span class="n">sitenames</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filenames</span> <span class="o">=</span> <span class="n">filenames</span>         
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;species&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sitetype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;sitetype&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sitefile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;sitefile&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">concunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;model_conc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressureunits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;model_pressure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span></div>
       
<span class="c1"># ___________________________________________________________________________________________________________________</span>
<span class="c1"># CODE TO PLOT THE DIFFERENT DATA TYPES</span>
<span class="c1"># ___________________________________________________________________________________________________________________</span>

<span class="c1"># Class to plot the filtered output</span>
<span class="c1"># Plots the output of read_ncdf_fixed against the obs at the given site</span>

<span class="c1"># data: output of read_necdf_fixed</span>
<span class="c1"># sitename: 3 letter acronym of the site of interest</span>
<span class="c1"># scaling: a scaling factoras the MOZART output is in mol/mol not ppm or ppb</span>
<span class="c1"># x_range: set a fixed range for the x axis </span>
<span class="c1"># save_plot: set if you&#39;d like to save the plot. Saves the pot to a new subdirectory &#39;plots&#39; in the same location as the data file</span>
<span class="c1"># network: set the network of the obs you wish to compare to</span>
<span class="c1"># height: set the height of the intake you wish to plot</span>
<span class="c1"># speciesname: set if you wish to plot of a single species only. Otherwise default to plotting all species given in the file.</span>
<span class="c1"># diff: set to plot the difference between the MOZART output and the observations</span>

<div class="viewcode-block" id="plot_ncdf_fixed"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.plot_ncdf_fixed">[docs]</a><span class="k">class</span> <span class="nc">plot_ncdf_fixed</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">sitename</span> <span class="o">=</span> <span class="s1">&#39;mhd&#39;</span><span class="p">,</span> <span class="n">scaling</span> <span class="o">=</span> <span class="mf">1e06</span><span class="p">,</span> <span class="n">x_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_plot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">network</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">speciesname</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">diff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">import</span> <span class="nn">acrg_plottools</span> <span class="k">as</span> <span class="nn">plottools</span>
        
        <span class="c1"># Extract the model data for the given site</span>
        <span class="n">sites</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sitenames</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sites</span> <span class="o">==</span> <span class="n">sitename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
          
        <span class="nb">print</span> <span class="n">matched</span>          
          
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># This means that the site was listed twice in the site file as two measurement networks share it.</span>
            <span class="c1"># As we&#39;re pulling out model data at the same location it doesn&#39;t matter which version we use</span>
            <span class="c1"># Default to using the first one</span>
            <span class="n">matched</span> <span class="o">=</span> <span class="p">[</span><span class="n">matched</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;There is no sitename matching : &#39;</span> <span class="o">+</span> <span class="n">sitename</span>
            <span class="nb">print</span> <span class="s1">&#39;Check the sitename or try using lowercase&#39;</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">time</span>
            <span class="c1"># conc is lon x lat x lev x time x site</span>
            <span class="c1">#conc = np.squeeze(data.conc[:,:,:,:,matched])</span>
            <span class="n">pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pressure</span><span class="p">[:,:,:,:,</span><span class="n">matched</span><span class="p">])</span>
            
            <span class="c1"># Plot for the given species only at multiple gridboxes</span>
            <span class="k">if</span> <span class="n">speciesname</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">species_no</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">speciesname</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">concnames</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># conc is species x site x time x lev x lon x lat</span>
                <span class="n">conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">conc</span><span class="p">[</span><span class="n">species_no</span><span class="p">,</span><span class="n">matched</span><span class="p">,:,:,:])</span>
                <span class="n">reshapedconc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">conc</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">conc</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="mi">27</span><span class="p">))</span>
                <span class="n">reshapedpressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">pressure</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                
                <span class="n">n_colours</span> <span class="o">=</span> <span class="mi">27</span>
                
            <span class="c1"># PLot all the species/tracers at the central point only</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># conc is species x site x time x lev x lon x lat</span>
                <span class="n">conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">conc</span><span class="p">[:,</span><span class="n">matched</span><span class="p">,:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">reshapedconc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">conc</span><span class="p">)</span>
                <span class="n">reshapedpressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pressure</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:])</span>

                <span class="n">n_colours</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">concnames</span><span class="p">)</span>
            
            
             
            <span class="c1"># Indicies for lats, lons and levs</span>
            <span class="n">lat_i</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">lon_i</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">lev_i</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>  
            
                    
            
            <span class="n">colours</span> <span class="o">=</span> <span class="n">plottools</span><span class="o">.</span><span class="n">generatecolours</span><span class="p">(</span><span class="n">n_colours</span><span class="p">)</span><span class="o">.</span><span class="n">RGB</span>
            
            <span class="c1"># Plot model ooutput for fixed site data</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">)</span>
            
            <span class="n">legend_spacing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_colours</span><span class="p">)</span>   
            
                        
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_colours</span><span class="p">):</span>      
                
                <span class="n">conc_i</span> <span class="o">=</span> <span class="n">reshapedconc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>        
                <span class="n">yaxislabel</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
               
                <span class="k">if</span> <span class="n">diff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">conc_i</span> <span class="o">=</span> <span class="n">conc_i</span> <span class="o">-</span> <span class="n">reshapedconc</span><span class="p">[:,</span><span class="n">diff</span><span class="p">]</span>
                    <span class="n">yaxislabel</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;- &#39;</span><span class="o">+</span><span class="n">data</span><span class="o">.</span><span class="n">concnames</span><span class="p">[</span><span class="n">diff</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                    
                <span class="c1"># Plot the data</span>
                <span class="n">plt1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
                
                <span class="n">plt1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">conc_i</span><span class="o">*</span><span class="n">scaling</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colours</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
                    
                <span class="n">y_formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">plt1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">y_formatter</span><span class="p">)</span>
                
                <span class="n">x_tickno_formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">plt1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">x_tickno_formatter</span><span class="p">)</span>
                
                <span class="n">plt1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model output at &#39;</span><span class="o">+</span> <span class="n">sitename</span><span class="p">)</span>
                <span class="n">plt1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">yaxislabel</span><span class="p">)</span>
                <span class="n">plt1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    
                <span class="k">if</span> <span class="n">speciesname</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">legend_i</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">matched</span><span class="p">,</span> <span class="n">lat_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">matched</span><span class="p">,</span><span class="n">lon_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">speciesname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">legend_i</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">concnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    
                <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.82</span><span class="p">,</span> <span class="mf">0.85</span><span class="o">-</span><span class="p">(</span><span class="mf">0.03</span><span class="o">*</span><span class="n">legend_spacing</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">legend_i</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> \
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colours</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
                    
    
            <span class="k">if</span> <span class="n">speciesname</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">plt1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">reshapedconc</span><span class="p">[:,</span><span class="mi">13</span><span class="p">]</span><span class="o">*</span><span class="n">scaling</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.82</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">,</span> <span class="s1">&#39;Lat, Lon, Lev&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;Central point ---&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
              
            
            
            <span class="k">if</span> <span class="n">x_range</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plt1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span>            
            
            <span class="k">if</span> <span class="n">save_plot</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/plots/&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="n">sitename</span><span class="o">+</span> <span class="s1">&#39;_Model.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="nb">print</span><span class="s1">&#39;Figure saved as : &#39;</span> <span class="o">+</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/plots/&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="n">sitename</span><span class="o">+</span> <span class="s1">&#39;_Model.png&#39;</span>
            
            
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">speciesname</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                 <span class="c1"># Plot model output and obs    </span>
                <span class="c1"># Read in the obs</span>
                <span class="kn">import</span> <span class="nn">acrg_agage</span>
                <span class="kn">import</span> <span class="nn">json</span>
                
                <span class="nb">print</span> <span class="s1">&#39;Plotting site &#39;</span> <span class="o">+</span> <span class="n">sitename</span>
                <span class="nb">print</span> <span class="s1">&#39;Plotting data from /dagage2/agage/metoffice/processed_obs/&#39;</span>            
                
                <span class="c1"># check if there is UKMO data for that site</span>
                <span class="n">acrg_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">acrg_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/acrg_site_info.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">site_info</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                
                <span class="n">site</span> <span class="o">=</span> <span class="n">acrg_agage</span><span class="o">.</span><span class="n">synonyms</span><span class="p">(</span><span class="n">sitename</span><span class="p">,</span> <span class="n">site_info</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">site</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Site &quot;</span> <span class="o">+</span> <span class="n">sitename</span> <span class="o">+</span> <span class="s1">&#39; is not listed&#39;</span><span class="p">)</span>
                
                <span class="k">else</span><span class="p">:</span>
                    
                    <span class="n">obs</span> <span class="o">=</span> <span class="n">acrg_agage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sitename</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">network</span> <span class="o">=</span> <span class="n">network</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">)</span>         
                    
                                   
                    
                    <span class="c1"># Only plot model output for the same time range as the obs</span>
                    <span class="c1">#start = bisect.bisect_left(time, min(obs_time)) -1</span>
                    <span class="c1">#finish = bisect.bisect_right(time, max(obs_time))</span>
                    
                    <span class="n">model_time</span> <span class="o">=</span> <span class="n">time</span>
                    <span class="n">model_conc</span> <span class="o">=</span> <span class="n">reshapedconc</span><span class="p">[:,</span><span class="mi">13</span><span class="p">]</span>
                    
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                     
                    <span class="c1"># Plot the data</span>
                    <span class="n">plt1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
                    
                    <span class="n">plt1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">obs</span><span class="p">[</span><span class="s1">&#39;mf&#39;</span><span class="p">],</span> <span class="s2">&quot;r-&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">markeredgecolor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
                    <span class="n">plt1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_time</span><span class="p">,</span> <span class="n">model_conc</span><span class="o">*</span><span class="n">scaling</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">markeredgecolor</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
                     
                    <span class="n">y_formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">plt1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">y_formatter</span><span class="p">)</span>
                    
                    <span class="n">x_tickno_formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">plt1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">x_tickno_formatter</span><span class="p">)</span>
                    
                    <span class="n">plt1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model output and observations at &#39;</span><span class="o">+</span> <span class="n">sitename</span> <span class="p">)</span>
                    <span class="n">plt1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
                    <span class="n">plt1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        
                    <span class="k">if</span> <span class="n">x_range</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">plt1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span>
                        
                    <span class="k">if</span> <span class="n">save_plot</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/plots/&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span><span class="o">+</span> <span class="s1">&#39;_UKMO_&#39;</span><span class="o">+</span> <span class="n">sitename</span><span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                        <span class="nb">print</span><span class="s1">&#39;Figure saved as : &#39;</span> <span class="o">+</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/plots/&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span><span class="o">+</span> <span class="s1">&#39;_UKMO_&#39;</span><span class="o">+</span> <span class="n">sitename</span><span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
                    
                    
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    
                
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
                 
                                         
        
        
        
<span class="c1"># Class to plot the filtered output</span>
<span class="c1"># Plots the output of read_ncdf_mobile</span>
<span class="c1"># defaults to not plotting the obs concentrations as we only have these for CH4 at the moment</span>

<span class="c1"># data: output of read_necdf_fixed</span>
<span class="c1"># sitename: 3 letter acronym of the site of interest</span>
<span class="c1"># scaling: a scaling factoras the MOZART output is in mol/mol not ppm or ppb</span>
<span class="c1"># save_plot: set if you&#39;d like to save the plot. Saves the pot to a new subdirectory &#39;plots&#39; in the same location as the data file</span>
<span class="c1"># no_obs: set if you don&#39;t want to plot the observations</span>

<div class="viewcode-block" id="plot_ncdf_mobile"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.plot_ncdf_mobile">[docs]</a><span class="k">class</span> <span class="nc">plot_ncdf_mobile</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">sitename</span> <span class="o">=</span> <span class="s1">&#39;ferry&#39;</span><span class="p">,</span> <span class="n">save_plot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scaling</span> <span class="o">=</span> <span class="mf">1e06</span><span class="p">,</span> <span class="n">no_obs</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        
        <span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        
        <span class="c1"># Extract the data for the given site</span>
        <span class="n">sites</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sitenames</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sites</span> <span class="o">==</span> <span class="n">sitename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>        
            <span class="nb">print</span> <span class="s1">&#39;There are no sitenames matching &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sitename</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># conc is of dimension time </span>
            <span class="c1"># sitenames are also of dimension time        </span>
        
            <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">obs_time</span><span class="p">[</span><span class="n">matched</span><span class="p">])</span>
            
            <span class="n">model_conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">model_conc</span><span class="p">[</span><span class="n">matched</span><span class="p">])</span>
            <span class="n">obs_conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">obs_conc</span><span class="p">[</span><span class="n">matched</span><span class="p">])</span>
                
            
            <span class="n">model_pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">model_pressure</span><span class="p">[</span><span class="n">matched</span><span class="p">])</span>
            <span class="n">obs_pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">obs_pressure</span><span class="p">[</span><span class="n">matched</span><span class="p">])</span>
            
            <span class="n">model_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">model_lat</span><span class="p">[</span><span class="n">matched</span><span class="p">])</span>
            <span class="n">obs_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">obs_lat</span><span class="p">[</span><span class="n">matched</span><span class="p">])</span>
            
            <span class="n">model_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">model_lon</span><span class="p">[</span><span class="n">matched</span><span class="p">])</span>
            <span class="n">obs_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">obs_lon</span><span class="p">[</span><span class="n">matched</span><span class="p">])</span>
            
            <span class="n">model_GT180</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">model_lon</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">obs_GT180</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs_lon</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            
                   
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_GT180</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">model_lon</span><span class="p">[</span><span class="n">model_GT180</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_lon</span><span class="p">[</span><span class="n">model_GT180</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_GT180</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">obs_lon</span><span class="p">[</span><span class="n">obs_GT180</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs_lon</span><span class="p">[</span><span class="n">obs_GT180</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span>


            <span class="c1"># Plot of </span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            
            <span class="c1"># Plot the data</span>
            <span class="n">plt1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        
            <span class="n">plt1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">model_conc</span><span class="o">*</span><span class="n">scaling</span><span class="p">,</span> <span class="s2">&quot;bo-&quot;</span><span class="p">,</span>  <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">no_obs</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">plt1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">obs_conc</span><span class="p">,</span> <span class="s2">&quot;ro-&quot;</span><span class="p">,</span>  <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
                
            <span class="c1"># plot the model and the obs time/space matched output</span>
            <span class="n">y_formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">y_formatter</span><span class="p">)</span>
             
            <span class="n">plt1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;model output (blue) and obs (red) for &#39;</span><span class="o">+</span> <span class="n">sitename</span><span class="p">)</span>
            <span class="n">plt1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">concunits</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>

            
            <span class="c1"># plot the difference between the model and the obs</span>
            <span class="n">plt5</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                        
            <span class="n">plt5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">model_conc</span><span class="o">*</span><span class="n">scaling</span> <span class="o">-</span> <span class="n">obs_conc</span><span class="p">,</span> <span class="s2">&quot;go-&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
            
            <span class="n">y_formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt5</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">y_formatter</span><span class="p">)</span>
             
            <span class="n">plt5</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Conc diff&#39;</span><span class="p">)</span>
            
            
            <span class="c1"># plot the model and obs pressures</span>
            <span class="n">plt2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                        
            <span class="n">plt2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">model_pressure</span><span class="p">,</span> <span class="s2">&quot;bo-&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">plt2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">obs_pressure</span><span class="p">,</span> <span class="s2">&quot;ro-&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
                
            <span class="n">y_formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">y_formatter</span><span class="p">)</span>
             
            <span class="n">plt2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure (Pa)&#39;</span><span class="p">)</span>


            <span class="c1"># plot the model and obs pressure difference</span>
            <span class="n">plt6</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                        
            <span class="n">plt6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">model_pressure</span><span class="o">-</span> <span class="n">obs_pressure</span><span class="p">,</span> <span class="s2">&quot;go-&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
                
            <span class="n">y_formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt6</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">y_formatter</span><span class="p">)</span>
             
            <span class="n">plt6</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure diff (Pa)&#39;</span><span class="p">)</span>
            
            
            <span class="c1"># plot the model and obs lats</span>
            <span class="n">plt3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
                        
            <span class="n">plt3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">model_lat</span><span class="p">,</span> <span class="s2">&quot;bo-&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">plt3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">obs_lat</span><span class="p">,</span> <span class="s2">&quot;ro-&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
                
            <span class="n">y_formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">y_formatter</span><span class="p">)</span>
             
            <span class="n">plt3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>


            <span class="c1"># plot the model and obs lons</span>
            <span class="n">plt4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
                        
            <span class="n">plt4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">model_lon</span><span class="p">,</span> <span class="s2">&quot;bo-&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">plt4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">obs_lon</span><span class="p">,</span> <span class="s2">&quot;ro-&quot;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
                
            <span class="n">y_formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt4</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">y_formatter</span><span class="p">)</span>
             
            <span class="n">plt4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">save_plot</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/plots/&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="n">sitename</span><span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="nb">print</span><span class="s1">&#39;Figure saved as : &#39;</span> <span class="o">+</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s1">&#39;/plots/&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="n">sitename</span><span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
            
            
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>      </div>



<span class="c1"># Code to set up input for contour plotting</span>
<div class="viewcode-block" id="plot_map_setup"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.plot_map_setup">[docs]</a><span class="k">class</span> <span class="nc">plot_map_setup</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> 
                 <span class="n">lon_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lat_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">lon_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lon_range</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">lon</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">lon</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">lat_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lat_range</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span>
        
        <span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;gall&#39;</span><span class="p">,</span>
            <span class="n">llcrnrlat</span><span class="o">=</span><span class="n">lat_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">urcrnrlat</span><span class="o">=</span><span class="n">lat_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">llcrnrlon</span><span class="o">=</span><span class="n">lon_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">urcrnrlon</span><span class="o">=</span><span class="n">lon_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>

        <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span></div>

<span class="c1"># data: output of read</span>
<span class="c1"># lat: 1D array of latitudes (optinal)</span>
<span class="c1"># lon: 1D array of longitudes (optinal)</span>
<span class="c1"># time: 1D array of time values (optinal)</span>
<span class="c1"># timestep: which timestep you want to plot e.g. set to 3 to plot the third timestep either a pandas time variable or a string &#39;%d/%m/%y</span>
<span class="c1"># out_filename: name of output file defaults to &#39;MZT_&#39; + species + &#39;_L&#39;+str(level)+ &#39;_&#39;+time.strftime(&#39;%y%m%d_%H%M&#39;)+&#39;.png&#39; (optinal)</span>
<span class="c1"># range_all: base the range of the contour colours on all the data rather than just the data for that timestep (optinal)</span>
<span class="c1"># lon_range : set lon range (optinal)</span>
<span class="c1"># lat_range: set lat_range (optinal)</span>
<span class="c1"># species: set to species or defaults to data.species (optinal)</span>
<span class="c1"># scale: set optional scaling factor (optinal)</span>
<span class="c1"># rangescale: scaling factor for range (optinal)</span>
<span class="c1"># colourbar_label: label for colourbar  defaults to  species + &#39; [&#39; + units + &#39;]&#39; (optinal)</span>
<span class="c1"># savefig: set if you want to save the figure(optinal)</span>
<span class="c1"># map_data: precalculated output of acrg_plottools.plot_map_setup instead of calculating it each time(optinal)</span>
<span class="c1"># nlevels: set to the number of levels you want to use in the contours defaults to 10 (optinal)</span>
<span class="c1"># levels: imput specific contour levels to use (optinal)</span>
<span class="c1"># minconc: minimum concentration used to calculate the levels (optinal)</span>
<span class="c1"># maxconc: maximim concentration used to calculate the levels (optinal)</span>
<span class="c1"># title: plot title</span>
<span class="c1"># outdir: where the plots are saved    </span>
<span class="c1"># Plot a filled contour map of a given MZT output</span>
<span class="c1"># Defaults to plotting the first timestep at ground level</span>
<div class="viewcode-block" id="plotlevel_MZT"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.plotlevel_MZT">[docs]</a><span class="k">def</span> <span class="nf">plotlevel_MZT</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">timestep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">range_all</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">lon_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">species_choice</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rangescale</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">colourbar_label</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">savefig</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">map_data</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nlevels</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">minconc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">maxconc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">outdir</span> <span class="o">=</span> <span class="s1">&#39;/home/as16992/MOZART/plots/&#39;</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">map_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lat</span>
        
        <span class="k">if</span> <span class="n">lon</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lon</span>

        <span class="n">map_data</span> <span class="o">=</span> <span class="n">plot_map_setup</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> 
                                  <span class="n">lon_range</span> <span class="o">=</span> <span class="n">lon_range</span><span class="p">,</span>
                                  <span class="n">lat_range</span> <span class="o">=</span> <span class="n">lat_range</span><span class="p">)</span>
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>

    <span class="n">map_data</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>
<span class="c1">#    map_data.m.drawstates()</span>
<span class="c1">#    map_data.m.drawcountries()</span>
<span class="c1">#    map_data.m.shadedrelief()</span>
    
    <span class="k">if</span> <span class="n">species</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>           
        <span class="n">species</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span>
    
    <span class="n">species_options</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;CO2&#39;</span><span class="p">,</span> <span class="s1">&#39;CH4&#39;</span><span class="p">,</span> <span class="s1">&#39;N2O&#39;</span><span class="p">,</span> <span class="s1">&#39;C2H6&#39;</span><span class="p">,</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Flux&#39;</span><span class="p">])</span> 
    <span class="n">scale_options</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e6</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">unit_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">,</span> <span class="s1">&#39;ppb&#39;</span><span class="p">,</span> <span class="s1">&#39;ppb&#39;</span><span class="p">,</span> <span class="s1">&#39;ppb&#39;</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>    
    
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">species_options</span><span class="p">)</span> <span class="o">==</span> <span class="n">species</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">scale_options</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">unit_options</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>    
    
    <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">56</span><span class="p">)[</span><span class="n">level</span><span class="p">]</span>
    
    <span class="c1"># make range for conc contours</span>
    <span class="c1"># Rounds to the nearest 100</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">conc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">timestep</span><span class="p">,</span> <span class="p">:,:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">conc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">conc</span><span class="p">[</span><span class="n">species_choice</span><span class="p">]</span>
        <span class="n">conc</span> <span class="o">=</span> <span class="n">conc</span><span class="p">[</span><span class="n">timestep</span><span class="p">,</span><span class="n">level</span><span class="p">,:,:]</span>
        
    <span class="n">conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">conc</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span>
    
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">conc</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">map_data</span><span class="o">.</span><span class="n">x</span><span class="p">):</span>
        <span class="n">conc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">conc</span><span class="p">)</span>
    
    
    <span class="c1">#pdb.set_trace()</span>
    
    <span class="k">if</span> <span class="n">minconc</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">range_all</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">minconc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">conc</span><span class="p">)</span><span class="o">/</span><span class="n">rangescale</span><span class="p">)</span><span class="o">*</span><span class="n">rangescale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minconc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="n">rangescale</span><span class="p">)</span><span class="o">*</span><span class="n">rangescale</span>
            
    <span class="k">if</span> <span class="n">maxconc</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">range_all</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxconc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">conc</span><span class="p">)</span><span class="o">/</span><span class="n">rangescale</span><span class="p">)</span><span class="o">*</span><span class="n">rangescale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxconc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="n">rangescale</span><span class="p">)</span><span class="o">*</span><span class="n">rangescale</span>
    
    
    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxconc</span> <span class="o">-</span> <span class="n">minconc</span><span class="p">)</span><span class="o">/</span><span class="n">nlevels</span>
    
    <span class="k">if</span> <span class="n">levels</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minconc</span><span class="p">,</span> <span class="n">maxconc</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
   

    <span class="c1">#Plot map</span>
    <span class="c1">#cs = map_data.m.contourf(map_data.x, map_data.y, conc, levels, cmap = plt.cm.Spectral_r    </span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">map_data</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">map_data</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">map_data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">conc</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;     </span>
<span class="sd">    # Alter this at some point to plot the tall tower sites ?</span>
<span class="sd">                       </span>
<span class="sd">    #Plot release location</span>
<span class="sd">    if &quot;release_lat&quot; in dir(fp_data):</span>
<span class="sd">        rplons, rplats = np.meshgrid(fp_data.release_lon[time_index],</span>
<span class="sd">                                     fp_data.release_lat[time_index])</span>
<span class="sd">        rpx, rpy = map_data.m(rplons, rplats)</span>
<span class="sd">        rp = map_data.m.scatter(rpx, rpy, 100, color = &#39;black&#39;)</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>    
        <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">time</span>
        
    <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">timestep</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">tslib</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
       <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%y&#39;</span><span class="p">)</span>
       
    <span class="c1"># Determine the average pressure at that level in kPa</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">P</span> <span class="o">=</span> <span class="s1">&#39;Ground&#39;</span>
    <span class="k">else</span><span class="p">:</span>        
        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pressure</span><span class="p">[</span><span class="n">timestep</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="p">:,:]))</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;MOZART output P = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;kPa at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="n">cb</span> <span class="o">=</span> <span class="n">map_data</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">)</span>
    
    <span class="n">tick_locator</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">tick_locator</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>
 
    <span class="k">if</span> <span class="n">colourbar_label</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colourbar_label</span> <span class="o">=</span> <span class="n">species</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span> 
 
    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colourbar_label</span><span class="p">,</span> 
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span> 
    
    <span class="k">if</span> <span class="n">out_filename</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out_filename</span> <span class="o">=</span> <span class="s1">&#39;MZT_&#39;</span> <span class="o">+</span> <span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;_L&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%y%m</span><span class="si">%d</span><span class="s1">_%H%M&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span>
        
    <span class="k">if</span> <span class="n">savefig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">out_filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>        
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">map_data</span><span class="p">,</span> <span class="n">conc</span><span class="p">,</span> <span class="n">levels</span></div>
    
<span class="c1"># Plot multiple profile plots for a given MZT output file at a given lon against lat and then at a given lat against lon</span>
<span class="c1"># Defaults to plotting the first timestep at lat = 0.94 and lon = 0</span>

<span class="c1"># data: output of read</span>
<span class="c1"># timestep: the number of the timestep you want to plot</span>
<span class="c1"># latindex: the index of the latitude you want to plot. Defaults to 48 = 0.947 degrees North</span>
<span class="c1"># lonindex: the index of the longitude you want to plot. Defaults to 0 = 0 degrees</span>
<span class="c1"># out_filename: outfile name</span>
<span class="c1"># outdir: where to save output file</span>
<div class="viewcode-block" id="plotprofiles_MZT"><a class="viewcode-back" href="../api/acrg_MOZART.html#acrg_MOZART.plotprofiles_MZT">[docs]</a><span class="k">def</span> <span class="nf">plotprofiles_MZT</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">timestep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">latindex</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">lonindex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="s1">&#39;/home/as13988/Plots/&#39;</span><span class="p">):</span>

    <span class="n">species</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">species</span>
    
    <span class="n">species_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CO2&#39;</span><span class="p">,</span> <span class="s1">&#39;CH4&#39;</span><span class="p">,</span> <span class="s1">&#39;N2O&#39;</span><span class="p">]</span>    
    <span class="n">scale_options</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e6</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">]</span>
    <span class="n">unit_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ppm&#39;</span><span class="p">,</span> <span class="s1">&#39;ppb&#39;</span><span class="p">,</span> <span class="s1">&#39;ppb&#39;</span><span class="p">]</span>    
    
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">species_options</span><span class="p">)</span> <span class="o">==</span> <span class="n">species</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">scale_options</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">unit_options</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>    


    <span class="c1"># extract the conc at the given timestep for all levels and lons</span>
    <span class="c1"># extract the corresponding pressures</span>
    <span class="n">conc_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">conc</span><span class="p">[</span><span class="n">timestep</span><span class="p">,</span> <span class="p">:,</span> <span class="n">latindex</span><span class="p">,:])</span><span class="o">*</span><span class="n">scale</span>
    <span class="n">conc_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">conc</span><span class="p">[</span><span class="n">timestep</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span><span class="n">lonindex</span><span class="p">])</span><span class="o">*</span><span class="n">scale</span>
    <span class="n">p_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pressure</span><span class="p">[</span><span class="n">timestep</span><span class="p">,</span> <span class="p">:,</span> <span class="n">latindex</span><span class="p">,:])</span><span class="o">/</span><span class="mi">1000</span>
    <span class="n">p_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pressure</span><span class="p">[</span><span class="n">timestep</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span><span class="n">lonindex</span><span class="p">])</span><span class="o">/</span><span class="mi">1000</span>
    <span class="n">lon_lons</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">56</span><span class="p">))</span>
    <span class="n">lat_lats</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">56</span><span class="p">))</span>
    
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">conc_lons</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">p_lons</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lon_lons</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
   
    <span class="n">ax</span><span class="o">.</span><span class="n">invert_zaxis</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">azim</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="c1">#ax.set_ylim3d(1800,2100)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">species</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>   
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Pressure (kPa)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;MOZART output Lat = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">latindex</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39; at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">timestep</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">out_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out_filename</span> <span class="o">=</span> <span class="s1">&#39;MZT_&#39;</span> <span class="o">+</span> <span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;_Lat&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">latindex</span><span class="p">]))</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">timestep</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%y%m</span><span class="si">%d</span><span class="s1">_%H%M&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">out_filename</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">)):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">conc_lats</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">p_lats</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lat_lats</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
   
    <span class="n">ax</span><span class="o">.</span><span class="n">invert_zaxis</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">azim</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">species</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>   
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Pressure (kPa)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;MOZART output Lon = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">lonindex</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39; at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">timestep</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    
    <span class="c1">#ax.set_ylim3d(1800,2100)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">out_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out_filename</span> <span class="o">=</span> <span class="s1">&#39;MZT_&#39;</span> <span class="o">+</span> <span class="n">species</span> <span class="o">+</span> <span class="s1">&#39;_Lon&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">lonindex</span><span class="p">]))</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">timestep</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%y%m</span><span class="si">%d</span><span class="s1">_%H%M&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">out_filename</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, mrghg.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>