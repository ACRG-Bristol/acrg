; --- Updated December 2022 ----
; Configuration file for OpenGHG_HBMCMC code
; Required inputs are marked as such.
; All other inputs are optional (defaults will be used)

[INPUT.MEASUREMENTS]
; Input values for extracting observations
;   species (str) - species name (see acrg_species_info.json for options) e.g. "ch4"
;   sites (list) - site codes as a list (see acrg_site_info.json for options) e.g. ["MHD"]
;   meas_period (list) - Time periods for measurements as a list (must match length of sites)
;   start_date (str) - Start of observations to extract (format YYYY-MM-DD)
;   end_date (str) - End of observations to extract (format YYYY-MM-DD) (non-inclusive)

species = 'sf6'      ; (required)
use_tracer = False
sites = ['BIR','BSD','CBW','CMN','GAT',
        'HEI','HEL','HFD','HPB','HTM',
        'HUN','JFJ','KIT','KRE','LIN',
        'LUT','MHD','NOR','OPE','OXK',
        'PAL','RGL','SAC','STE','TAC',
         'TOH','TRN','UTO','WAO']        ; (required)

averaging_period = ['4H','4H','4H','4H','4H','4H',
               '4H','4H','4H','4H','4H',
               '4H','4H','4H','4H','4H',
               '4H','4H','4H','4H','4H',
               '4H','4H','4H','4H',
               '4H','4H','4H','4H']  ; (required)
start_date = '2021-01-01'   ; (required - but can be specified on command line instead)
end_date = '2021-02-01'     ; (required - but can be specified on command line instead)

save_merged_data = True
reload_merged_data = False
merged_data_dir = '/user/work/bm13805/paris_runs/merged_data/'

; inlet (list/None) - Specific inlet height for the site (list - must match number of sites)
; instrument (list/None) - Specific instrument for the site (list - must match number of sites)
; filters (list/None) - Specify any data filtering to apply to observations 

inlet = ['75magl','248magl','207magl','8magl','341magl','30magl',
         '110magl','100magl','131magl','150magl','115magl',
         None,'200magl','250magl','98magl','60magl',
         '24magl','100magl','120magl','163magl','12magl',
         '90magl','100magl','252magl','185magl',
         '147magl','180magl','57magl','10magl']
instrument = [None,None,None,None,None,None,None,None,None,None,
            None,None,None,None,None,None,None,None,None,None,
            None,None,None,None,None,None,None,None,None]
;filters = ['pblh']

bc_store="user"       
obs_store="european_obs"
footprint_store="user"  
emissions_store = "user"

[INPUT.PRIORS]
; Input values for extracting footprints, emissions and boundary conditions files (also uses values from INPUT.MEASUREMENTS)
;   domain (str) - Name of inversion spatial domain e.g. 'EUROPE'
;   met_model (dict/str/None) - either dict corresponding to sites, str. e.g., 'UKV' or None if applies to all sites
;   fp_model (str) - Name of LPDM used for footprints e.g. 'NAME'
;   fp_height (list) - Inlet height used for footprints (sometimes differs from measurement inlet height e.g. Cabauw)
;   emissions_name (list) - List of the source keywords used for retrieving flux files from the object store

domain = 'EUROPE'           ; (required)
met_model = 'UKV'
fp_model = 'NAME'
fp_height = ['75magl','248magl','200magl','500magl','341magl','30magl',
             '110magl','100magl','130magl','150magl','115magl',
             '1000magl','200magl','250magl','98magl','60magl',
             '10magl','100magl','120magl','163magl','10magl',
             '90magl','100magl','252magl','185magl',
             '147magl','180magl','57magl','20magl']

emissions_name = ['edgar-annual-total']
bc_input = 'cams'

[INPUT.BASIS_CASE]
; Input values to extract the basis cases to use within the inversion for boundary conditions and emissions
;   bc_basis_case (str) - boundary conditions basis, defaults to "NESW" (looks for file format {bc_basis_case}_{domain}_*.nc)
;   fp_basis_case (str/None) - emissions bases:
;     - if specified, looks for file format {fp_basis_case}_{domain}_*.nc
;     - if None, creates basis function using quadtree algorithm and associated parameters
;   nbasis - Number of basis functions to use for quadtree derived basis function (rounded to %4)
;   basis_directory (str/None) - Directory containing the basis functions (with domain name as subdirectories)
;   bc_basis_directory (str/None) - Directory containing the boundary condition basis functions NB. Defaults to dir in OpenGHG_Inversions
;   country_file (str/None) - Directory to the country definitions file

basis_algorithm = "quadtree"
bc_basis_case = "NESW"
bc_basis_directory = '/group/chemistry/acrg/LPDM/bc_basis_functions/'
fp_basis_case = None
nbasis = 100
basis_directory = '/group/chemistry/acrg/paris_total_methane_inversion/basis_functions/'
country_file = '/group/chemistry/acrg/LPDM/countries/country-ukmo_EUROPE.nc'

[MCMC.TYPE]
; Which MCMC setup to use. This defines the function which will be called and the expected inputs.
; Options include:
;   "fixed_basis"

mcmc_type = "fixed_basis"

[MCMC.PDF]
; Definitions of PDF shape and parameters for inputs
;   xprior (dict) - emissions
;   bcprior (dict) - boundary conditions
;   sigprior (dict) - model error
; Each of these inputs should be dictionary with the name of probability distribution and shape parameters.
; See https://docs.pymc.io/api/distributions/continuous.html
; Current options for the "pdf" parameter include:
; - "lognormal" - Log-normal log-likelihood.
;   o "mu" (float) - Location parameter
;   o "sd" or "sigma" (float) - Standard deviation (> 0)
; e.g. {"pdf":"lognormal", "mu":1, "sd":1}
;
; - "uniform" - Continuous uniform log-likelihood.
;   o "lower" (float) - Lower limit
;   o "upper" (float) - Upper limit
; e.g. {"pdf":"uniform", "lower":0.5, "upper":3}
;
; - "halfflat" - Improper flat prior over the positive reals. (no additional parameters necessary)
; e.g. {"pdf":"halfflat"}

xprior   = {"pdf":"truncatednormal", "mu":1., "sigma":1., "lower":0.}
bcprior  = {"pdf":"truncatednormal", "mu":1., "sigma":0.1, "lower": 0.}
sigprior = {"pdf":"uniform", "lower":0.1, "upper":1.0}

[MCMC.BC_SPLIT]
; Boundary conditions setup
;   bc_freq - The period over which the baseline is estimated. e.g.
;    - None - one scaling for the whole inversion
;    - "monthly" - per calendar monthly
;    - "*D" (e.g. "30D") - per number of days (e.g. 30 days)

bc_freq = '5D'
sigma_freq = '5D'
sigma_per_site = True

[MCMC.ITERATIONS]
; Iteration parameters
;   nit (int) - Number of iterations for MCMC
;   burn (int) - Number of iterations to burn in MCMC
;   tune (int) - Number of iterations to use to tune step size

nit = 20000
burn = 10000
tune = 10000

[MCMC.NCHAIN]
; Number of chains to run simultaneously. Must be >=2 to allow convergence to be checked.

nchain = 4

[MCMC.ADD_ERROR]
; Add variability in averaging period to the measurement error

averaging_error = True

[MCMC.OUTPUT]
; Details of where to write the output
; outputpath (str) - directory to write output
; outputname (str) - unique identifier for output/run name.

outputpath = '/user/work/bm13805/paris_runs/sf6/hbmcmc_input_output'
outputname = 'paris_sf6_test'
