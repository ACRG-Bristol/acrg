<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>grib_api: grib_filter</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
  </ul>
</div>
<h1><a class="anchor" name="grib_filter">grib_filter</a></h1><h2><a class="anchor" name="DESCRIPTION">
DESCRIPTION</a></h2>
Apply the rules defined in rules_file to each grib message in the grib files provided as arguments.<h2><a class="anchor" name="USAGE">
USAGE</a></h2>
grib_filter [options] rules_file grib_file grib_file ...<h2><a class="anchor" name="OPTIONS">
OPTIONS</a></h2>
-f <br>
 Force. Force the execution not to fail on error. <br>
 <br>
 -o output_grib_file <br>
 Output grib is written to ouput_grib_file. If an ouput grib file is required and -o is not used, theouput grib is written to filtered.out <br>
 <br>
 -M <br>
 Multi-grib support off. Turn off support for multiple fields in single grib message <br>
 <br>
 -V <br>
 Version. <br>
 <br>
 -g <br>
 Copy GTS header. <br>
 <br>
 -G <br>
 GRIBEX compatibility mode. <br>
 <br>
 -7 <br>
 Does not fail when the message has wrong length <br>
 <br>
 -v <br>
 Verbose. <br>
 <br>
 <h2><a class="anchor" name="grib_filter_examples">
grib_filter examples</a></h2>
<ol type=1>
<li>The rules accepted by grib_filter are different from the grib_convert rules due to the kind of work grib_filter it is supposed to do.<br>
 The main difference between grib_filter and grib_convert is that the convert is a 1 field in input 1 field in output tool, while the filter is a 1 field in input as many field you need in output. At this aim the filter syntax allows a write in the form: write "filename". So that it is possible repeating as many write you need or using a parametrised write to send the output to many files. <br>
 The grib_filter processes sequentially all the grib messages contained in the input file and it applies the rules to each one. <br>
 Since the filename used in the write statement can contain some key values, taken from the grib processed when applying the "write rule", several files are produced in output containing fields with the same value of the keys used in the file name. <br>
 Indeed if we write a rules_file containing the only statement:<br>
 <br>
 <div class="fragment"><pre class="fragment">
write "../data/split/[centre]_[date]_[dataType]_[levelType].grib[editionNumber]";
</pre></div><br>
 Applying this rules_file to the ../data/tigge_pf_ecmwf.grib2 grib file we obtain several files in the ../data/split directory containting fields splitted according their keys values<br>
 <div class="fragment"><pre class="fragment">
&gt;grib_filter rules_file ../data/tigge_pf_ecmwf.grib2
&gt;ls ../data/split
ecmf_20060619_pf_sfc.grib2
ecmf_20060630_pf_sfc.grib2
ecmf_20070122_pf_pl.grib2
ecmf_20070122_pf_pt.grib2
ecmf_20070122_pf_pv.grib2
ecmf_20070122_pf_sfc.grib2
</pre></div><br>
</li><li>The key values in the file name can also be obtained in a different format by indicating explicitly the type required after a colon.<ul>
<li>:l for long</li><li>:d for double</li><li>:s for string</li></ul>
The following statement works in a slightly different way from the previous example, including in the output file name the long values for centre and dataType.<br>
 <div class="fragment"><pre class="fragment">
write "../data/split/[centre:l]_[date]_[dataType:l]_[levelType].grib[editionNumber]";
</pre></div><br>
 Running the same command again we obtain a different list of files.<br>
 <div class="fragment"><pre class="fragment">
&gt;grib_filter rules_file ../data/tigge_pf_ecmwf.grib2
&gt;ls ../data/split
98_20060619_4_sfc.grib2
98_20060630_4_sfc.grib2
98_20070122_4_pl.grib2
98_20070122_4_pt.grib2
98_20070122_4_pv.grib2
98_20070122_4_sfc.grib2
</pre></div><br>
</li><li>Other statements are allowed in the grib_filter syntax:<ul>
<li>if ( condition ) { statement;}<br>
 The condition can be made using ==,!= and joining single block conditions with || and &amp;&amp; <br>
 The statement can be any valid statement also another nested condition<br>
</li><li>set keyname = keyvalue;</li><li>print "string to print also with key values like in the file name"</li><li>transient keyname1 = keyname2;</li><li>comments beginning with #</li></ul>
A complex example of grib_filter rules is the following to change temperature in a grib edition 1 file. <div class="fragment"><pre class="fragment">
# Temperature
if ( level == 850 &amp;&amp; indicatorOfParameter == 11 ) {
    print "found indicatorOfParameter=[indicatorOfParameter] level=[level] date=[date]";
    transient oldtype = type ;
    set identificationOfOriginatingGeneratingSubCentre=98;
    set gribTablesVersionNo = 128;
    set indicatorOfParameter = 130;
    set localDefinitionNumber=1;
    set marsClass="od";
    set marsStream="kwbc";
    # Negatively/Positively Perturbed Forecast
    if ( oldtype == 2 || oldtype == 3 ) {
      set marsType="pf";
      set experimentVersionNumber="4001";
    }
    # Control Forecast
    if ( oldtype == 1 ) {
      set marsType="cf";
      set experimentVersionNumber="0001";
    }
    set numberOfForecastsInEnsemble=11;
    write;
    print "indicatorOfParameter=[indicatorOfParameter] level=[level] date=[date]";
    print;
}
</pre></div><br>
 </li></ol>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Sep 22 15:18:22 2009 for grib_api by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
